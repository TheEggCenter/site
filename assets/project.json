{"extensionStorage":{"SPmbpCST":{"loaded":true,"imgStorage":{}}},"targets":[{"isStage":true,"name":"Stage","variables":{",fh=L473_%ENPq9[IXB.":["currentbgm","silent"],"rBo~VN3dn::)/w6.I/b$":["song:lastframesong","silent"],"VT[+TX9sYaIHJbvs|+SH":["song:startingtime",9375.586204953705],"3i~(llyAZ]j8XJ,LbY.?":["song:timr",0.016000057803466916],"A*-r)IxIuYB/DN~I6#6b":["song:bpm","0"],"#|53H,/Lk{l=a]!Ws`[7":["song:beat",0],"cwdN]EJ%7Kqk-jQ^,-/h":["song:beatchanged","0"],"MOob`8Xm.7@!;ZGr8)V9":["song:lastframebeat",0],"[+p!#d5.+6~IF(85}_;a":["DELTATIME",0.45000133104622364],"KFpix-!7SB]_S*P?_@jj":["FPS",67],"3~XMnni$=KYs%32-:{u4":["savetime",".2"],"zXvED(W1KgL`U0CtNOGY":["currentmenu","site_placeholder"]},"lists":{"::wr.O5%:..~s,x3VcVQ":["songnames",["silent"]],"5r=g@f8v%F|FF$g9yn?3":["songbpms",["0"]],"tPy8=;qAJYiw,^fiS:_2":["songinfo",["song name - artist(s)"]],"SaE:nrOnkyk[52_JB^av":["INFO_project",["yolkengine","1.0.0"]],"dVgaAG+h}b8Kv{:M2:x:":["settings",["14",".2"]]},"broadcasts":{"8JGqy+^Aa=y|vQM@CdCK":"startloops","1|?96Hm04x-#?-1jh6Q%":"loadall","pOJ?q^R-{|ltBh(bZd+d":"loadplaceholder","2|w2]|W{LYrYXuWp!sYL":"loadsettings","n0e/6krql@$$XwZq+T/n":"hotreload","QKQ1k*mHwjARPXaUE~8N":"resetsettings"},"blocks":{"dr":{"opcode":"SPmbpCST_$-,.___SPmbpCST_TEMP_BLOCK","next":null,"parent":null,"inputs":{},"fields":{},"shadow":true}},"comments":{"bA":{"blockId":null,"x":50,"y":50,"width":350,"height":170,"minimized":false,"text":"Configuration for https://turbowarp.org/\nYou can move, resize, and minimize this comment, but don't edit it by hand. This comment can be deleted to remove the stored settings.\n{\"framerate\":60,\"runtimeOptions\":{\"maxClones\":Infinity,\"miscLimits\":false,\"fencing\":false},\"hq\":true,\"width\":640} // _twconfig_"},"dt":{"blockId":null,"x":47,"y":235,"width":350,"height":150,"minimized":false,"text":"This comment contains configuration for gamepad support in third-party tools or websites such as https://turbowarp.org/\nDo not edit by hand\n{\"axes\":[{\"type\":\"virtual_cursor\",\"high\":\"+x\",\"low\":\"-x\",\"sensitivity\":0.6,\"deadZone\":0.2},{\"type\":\"virtual_cursor\",\"high\":\"-y\",\"low\":\"+y\",\"sensitivity\":0.6,\"deadZone\":0.2},{\"type\":\"virtual_cursor\",\"high\":\"+x\",\"low\":\"-x\",\"sensitivity\":0.6,\"deadZone\":0.2},{\"type\":\"virtual_cursor\",\"high\":\"-y\",\"low\":\"+y\",\"sensitivity\":0.6,\"deadZone\":0.2}],\"buttons\":[{\"type\":\"key\",\"high\":null,\"button\":0},{\"type\":\"key\",\"high\":null,\"button\":2},{\"type\":\"key\",\"high\":null,\"button\":0},{\"type\":\"key\",\"high\":null,\"button\":0},{\"type\":\"mousedown\",\"button\":0,\"high\":null},{\"type\":\"mousedown\",\"button\":0,\"high\":null},{\"type\":\"mousedown\",\"button\":2,\"high\":null},{\"type\":\"mousedown\",\"button\":2,\"high\":null},{\"type\":\"key\",\"high\":null},{\"type\":\"key\",\"high\":null},{\"type\":\"key\",\"high\":null,\"button\":0},{\"type\":\"key\",\"high\":null,\"button\":0},{\"type\":\"key\",\"high\":null},{\"type\":\"key\",\"high\":null},{\"type\":\"key\",\"high\":null},{\"type\":\"key\",\"high\":null},{\"type\":\"key\",\"high\":\"1\"},{\"type\":\"key\",\"high\":null}]} // _gamepad_"}},"currentCostume":0,"costumes":[{"name":"backdrop1","bitmapResolution":1,"dataFormat":"svg","assetId":"Stage/backdrop1","md5ext":"Stage/backdrop1.svg","rotationCenterX":320,"rotationCenterY":180}],"sounds":[],"volume":100,"layerOrder":0,"tempo":60,"videoTransparency":50,"videoState":"on","textToSpeechLanguage":null},{"isStage":false,"name":"systems//functions","variables":{"lVSiP`K#Z5S-!A4nGa5y":["dtimestamp",0],"#M_|*2iTqoy7rpB`6+AG":["speed",0]},"lists":{},"broadcasts":{},"blocks":{"#":{"opcode":"procedures_definition","next":"%","parent":null,"inputs":{"custom_block":[1,"a"]},"fields":{},"topLevel":true},"a":{"opcode":"procedures_prototype","next":null,"parent":"#","inputs":{"6jQwgzz;a$iwO65$jp68":[1,"bA"],"s=)#a!I(CwVEQ7mZ9BJ~":[1,"bB"],"O^#;(;83h^w6cpJz[[Y:":[1,"bC"],"X{KQphh1[:Fi(gwui}G*":[1,"bD"]},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"return sprite at start %s total frames %s fps %s stamp %s","argumentids":"[\"6jQwgzz;a$iwO65$jp68\",\"s=)#a!I(CwVEQ7mZ9BJ~\",\"O^#;(;83h^w6cpJz[[Y:\",\"X{KQphh1[:Fi(gwui}G*\"]","argumentnames":"[\"s\",\"t\",\"f\",\"s\"]","argumentdefaults":"[\"\",\"\",\"\",\"\",\"\"]","warp":"true"}},"bA":{"opcode":"argument_reporter_string_number","next":null,"parent":"a","inputs":{},"fields":{"VALUE":["s",null]},"shadow":true},"bB":{"opcode":"argument_reporter_string_number","next":null,"parent":"a","inputs":{},"fields":{"VALUE":["t",null]},"shadow":true},"bC":{"opcode":"argument_reporter_string_number","next":null,"parent":"a","inputs":{},"fields":{"VALUE":["f",null]},"shadow":true},"bD":{"opcode":"argument_reporter_string_number","next":null,"parent":"a","inputs":{},"fields":{"VALUE":["s",null]},"shadow":true},"%":{"opcode":"procedures_return","next":null,"parent":"#","inputs":{"VALUE":[3,"n",[10,""]]},"fields":{}},"n":{"opcode":"operator_add","next":null,"parent":"%","inputs":{"NUM1":[3,"bE",[4,""]],"NUM2":[3,"o",[4,"1"]]},"fields":{}},"bE":{"opcode":"argument_reporter_string_number","next":null,"parent":"n","inputs":{},"fields":{"VALUE":["s",null]}},"o":{"opcode":"operator_mod","next":null,"parent":"n","inputs":{"NUM1":[3,"(",[4,""]],"NUM2":[3,"bF",[4,""]]},"fields":{}},"(":{"opcode":"operator_mathop","next":null,"parent":"o","inputs":{"NUM":[3,"p",[4,""]]},"fields":{"OPERATOR":["floor",null]}},"p":{"opcode":"operator_multiply","next":null,"parent":"(","inputs":{"NUM1":[3,")",[4,""]],"NUM2":[3,"bG",[4,""]]},"fields":{}},")":{"opcode":"operator_multiply","next":null,"parent":"p","inputs":{"NUM1":[3,"q",[4,""]],"NUM2":[1,[4,"86400"]]},"fields":{}},"q":{"opcode":"operator_subtract","next":null,"parent":")","inputs":{"NUM1":[3,"bH",[4,""]],"NUM2":[3,"bI",[4,""]]},"fields":{}},"bH":{"opcode":"sensing_dayssince2000","next":null,"parent":"q","inputs":{},"fields":{}},"bI":{"opcode":"argument_reporter_string_number","next":null,"parent":"q","inputs":{},"fields":{"VALUE":["s",null]}},"bG":{"opcode":"argument_reporter_string_number","next":null,"parent":"p","inputs":{},"fields":{"VALUE":["f",null]}},"bF":{"opcode":"argument_reporter_string_number","next":null,"parent":"o","inputs":{},"fields":{"VALUE":["t",null]}},"*":{"opcode":"procedures_definition","next":"r","parent":null,"inputs":{"custom_block":[1,"s"]},"fields":{},"topLevel":true},"s":{"opcode":"procedures_prototype","next":null,"parent":"*","inputs":{"%^U,pV1q.efcS,P:ab=H":[1,"bJ"],"XeyAbf7C*-(P1ofh(._%":[1,"bK"]},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"bounce to size %s force %s","argumentids":"[\"%^U,pV1q.efcS,P:ab=H\",\"XeyAbf7C*-(P1ofh(._%\"]","argumentnames":"[\"target size\",\"force\"]","argumentdefaults":"[\"\",\"\"]","warp":"false"}},"bJ":{"opcode":"argument_reporter_string_number","next":null,"parent":"s","inputs":{},"fields":{"VALUE":["target size",null]},"shadow":true},"bK":{"opcode":"argument_reporter_string_number","next":null,"parent":"s","inputs":{},"fields":{"VALUE":["force",null]},"shadow":true},"r":{"opcode":"data_setvariableto","next":"t","parent":"*","inputs":{"VALUE":[3,"u",[10,"0"]]},"fields":{"VARIABLE":["speed","#M_|*2iTqoy7rpB`6+AG"]}},"u":{"opcode":"operator_add","next":null,"parent":"r","inputs":{"NUM1":[3,"bL",[4,""]],"NUM2":[3,"bM",[4,""]]},"fields":{}},"bL":{"opcode":"operator_multiply","next":null,"parent":"u","inputs":{"NUM1":[3,[12,"speed","#M_|*2iTqoy7rpB`6+AG"],[4,""]],"NUM2":[1,[4,"0.9"]]},"fields":{}},"bM":{"opcode":"argument_reporter_string_number","next":null,"parent":"u","inputs":{},"fields":{"VALUE":["force",null]}},"t":{"opcode":"looks_changesizeby","next":"v","parent":"r","inputs":{"CHANGE":[3,"bN",[4,"10"]]},"fields":{}},"bN":{"opcode":"operator_multiply","next":null,"parent":"t","inputs":{"NUM1":[3,[12,"speed","#M_|*2iTqoy7rpB`6+AG"],[4,""]],"NUM2":[3,[12,"DELTATIME","[+p!#d5.+6~IF(85}_;a"],[4,""]]},"fields":{}},"v":{"opcode":"control_if","next":null,"parent":"t","inputs":{"CONDITION":[2,"w"],"SUBSTACK":[2,"x"]},"fields":{}},"w":{"opcode":"operator_equals","next":null,"parent":"v","inputs":{"OPERAND1":[3,"y",[10,""]],"OPERAND2":[3,"+",[10,"50"]]},"fields":{}},"y":{"opcode":"operator_gt","next":null,"parent":"w","inputs":{"OPERAND1":[3,"bO",[10,""]],"OPERAND2":[3,"bP",[10,"50"]]},"fields":{}},"bO":{"opcode":"looks_size","next":null,"parent":"y","inputs":{},"fields":{}},"bP":{"opcode":"argument_reporter_string_number","next":null,"parent":"y","inputs":{},"fields":{"VALUE":["target size",null]}},"+":{"opcode":"operator_gt","next":null,"parent":"w","inputs":{"OPERAND1":[3,"bQ",[10,""]],"OPERAND2":[1,[10,"0"]]},"fields":{}},"bQ":{"opcode":"argument_reporter_string_number","next":null,"parent":"+","inputs":{},"fields":{"VALUE":["force",null]}},"x":{"opcode":"looks_setsizeto","next":"z","parent":"v","inputs":{"SIZE":[3,"bR",[4,"100"]]},"fields":{}},"bR":{"opcode":"argument_reporter_string_number","next":null,"parent":"x","inputs":{},"fields":{"VALUE":["target size",null]}},"z":{"opcode":"data_setvariableto","next":"A","parent":"x","inputs":{"VALUE":[3,"bS",[10,"0"]]},"fields":{"VARIABLE":["speed","#M_|*2iTqoy7rpB`6+AG"]}},"bS":{"opcode":"operator_multiply","next":null,"parent":"z","inputs":{"NUM1":[1,[4,"-0.8"]],"NUM2":[3,[12,"speed","#M_|*2iTqoy7rpB`6+AG"],[4,""]]},"fields":{}},"A":{"opcode":"control_if","next":null,"parent":"z","inputs":{"CONDITION":[2,","],"SUBSTACK":[2,"bT"]},"fields":{}},",":{"opcode":"operator_equals","next":null,"parent":"A","inputs":{"OPERAND1":[3,"bU",[10,""]],"OPERAND2":[1,[10,"4"]]},"fields":{}},"bU":{"opcode":"operator_mathop","next":null,"parent":",","inputs":{"NUM":[3,[12,"speed","#M_|*2iTqoy7rpB`6+AG"],[4,""]]},"fields":{"OPERATOR":["abs",null]}},"bT":{"opcode":"data_setvariableto","next":null,"parent":"A","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["speed","#M_|*2iTqoy7rpB`6+AG"]}}},"comments":{},"currentCostume":0,"costumes":[{"name":"costume1","bitmapResolution":1,"dataFormat":"svg","assetId":"systems/functions/costume1","md5ext":"systems/functions/costume1.svg","rotationCenterX":0,"rotationCenterY":0}],"sounds":[],"volume":100,"layerOrder":5,"visible":true,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around","extensionStorage":{"SPmbpCST":{"bounce to size %s force %s":{"color":"#FF6680","global":true,"isTerminal":false},"return sprite at start %s total frames %s fps %s stamp %s":{"color":"#FF6680","global":true,"return":1}}}},{"isStage":false,"name":"systems//internal","variables":{"Qno6zX:5b/L;ZTccUroY":["speed",0],"QJeFyUcctZaKM5abJg11":["dtimestamp",0],"ln.{^s[~Xb!UCsqRxVvJ":["fpsVIZ",0],"gHzut!oAc2vUkFX;rdgY":["variableTest","123ABC"]},"lists":{"~$pI.of7LMt#4@TH+]*W":["keybinddesc",[]],"-NCA~NP$@K63dY8CgfC=":["listTest",["1","2","3","A","B","C"]]},"broadcasts":{},"blocks":{"-":{"opcode":"procedures_definition","next":"B","parent":null,"inputs":{"custom_block":[1,"C"]},"fields":{},"topLevel":true},"C":{"opcode":"procedures_prototype","next":null,"parent":"-","inputs":{".NH|AjLiV}bES!:L`(;J":[1,"bV"],"5(oC#dMvsDbr9DV;j}rv":[1,"bW"],"Z,Vtc+*-fM#ydR?ln8b|":[3,null,"bX"]},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"get data from save file %s in project %s","argumentids":"[\".NH|AjLiV}bES!:L`(;J\",\"5(oC#dMvsDbr9DV;j}rv\"]","argumentnames":"[\"#\",\"p\"]","argumentdefaults":"[\"\",\"\",\"\"]","warp":"false"}},"bV":{"opcode":"argument_reporter_string_number","next":null,"parent":"C","inputs":{},"fields":{"VALUE":["#",null]},"shadow":true},"bW":{"opcode":"argument_reporter_string_number","next":null,"parent":"C","inputs":{},"fields":{"VALUE":["p",null]},"shadow":true},"bX":{"opcode":"argument_reporter_string_number","next":null,"parent":null,"inputs":{},"fields":{"VALUE":["b",null]},"shadow":true,"topLevel":true},"B":{"opcode":"localstorage_setProjectId","next":"bY","parent":"-","inputs":{"ID":[3,"D",[10,"eggland//save1"]]},"fields":{}},"D":{"opcode":"operator_join","next":null,"parent":"B","inputs":{"STRING1":[3,"bZ",[10,""]],"STRING2":[3,".",[10,""]]},"fields":{}},"bZ":{"opcode":"argument_reporter_string_number","next":null,"parent":"D","inputs":{},"fields":{"VALUE":["p",null]}},".":{"opcode":"operator_join","next":null,"parent":"D","inputs":{"STRING1":[1,[10,"//"]],"STRING2":[3,"/",[10,"banana"]]},"fields":{}},"/":{"opcode":"operator_join","next":null,"parent":".","inputs":{"STRING1":[1,[10,"save"]],"STRING2":[3,"b!",[10,""]]},"fields":{}},"b!":{"opcode":"argument_reporter_string_number","next":null,"parent":"/","inputs":{},"fields":{"VALUE":["#",null]}},"b#":{"opcode":"event_whenflagclicked","next":":","parent":null,"inputs":{},"fields":{},"topLevel":true},";":{"opcode":"looks_hide","next":"b(","parent":"b%","inputs":{},"fields":{}},"b(":{"opcode":"procedures_call","next":null,"parent":";","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"REFRESH","argumentids":"[]","warp":"true"}},"=":{"opcode":"procedures_definition","next":"?","parent":null,"inputs":{"custom_block":[1,"E"]},"fields":{},"topLevel":true},"E":{"opcode":"procedures_prototype","next":null,"parent":"=","inputs":{"|gUy{z6U}[/r:DBqIejp":[1,"b)"],"kkizHE].kT;as8M7mwF`":[1,"b*"]},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"calculate DT and FPS with last frame %s and base fps %s","argumentids":"[\"|gUy{z6U}[/r:DBqIejp\",\"kkizHE].kT;as8M7mwF`\"]","argumentnames":"[\"lf\",\"fps\"]","argumentdefaults":"[\"\",\"\"]","warp":"false"}},"b)":{"opcode":"argument_reporter_string_number","next":null,"parent":"E","inputs":{},"fields":{"VALUE":["lf",null]},"shadow":true},"b*":{"opcode":"argument_reporter_string_number","next":null,"parent":"E","inputs":{},"fields":{"VALUE":["fps",null]},"shadow":true},"?":{"opcode":"control_wait","next":"F","parent":"=","inputs":{"DURATION":[1,[5,"0"]]},"fields":{}},"F":{"opcode":"data_setvariableto","next":"@","parent":"?","inputs":{"VALUE":[3,"G",[10,"0"]]},"fields":{"VARIABLE":["DELTATIME","[+p!#d5.+6~IF(85}_;a"]}},"G":{"opcode":"operator_multiply","next":null,"parent":"F","inputs":{"NUM1":[3,"[",[4,""]],"NUM2":[3,"H",[4,""]]},"fields":{}},"[":{"opcode":"operator_multiply","next":null,"parent":"G","inputs":{"NUM1":[3,"b+",[4,""]],"NUM2":[1,[4,"86400"]]},"fields":{}},"b+":{"opcode":"argument_reporter_string_number","next":null,"parent":"[","inputs":{},"fields":{"VALUE":["fps",null]}},"H":{"opcode":"operator_subtract","next":null,"parent":"G","inputs":{"NUM1":[3,"b,",[4,""]],"NUM2":[3,"b-",[4,""]]},"fields":{}},"b,":{"opcode":"sensing_dayssince2000","next":null,"parent":"H","inputs":{},"fields":{}},"b-":{"opcode":"argument_reporter_string_number","next":null,"parent":"H","inputs":{},"fields":{"VALUE":["lf",null]}},"@":{"opcode":"data_setvariableto","next":null,"parent":"F","inputs":{"VALUE":[3,"]",[10,"60"]]},"fields":{"VARIABLE":["FPS","KFpix-!7SB]_S*P?_@jj"]}},"]":{"opcode":"operator_round","next":null,"parent":"@","inputs":{"NUM":[3,"^",[4,""]]},"fields":{}},"^":{"opcode":"operator_divide","next":null,"parent":"]","inputs":{"NUM1":[3,"b.",[4,""]],"NUM2":[3,[12,"DELTATIME","[+p!#d5.+6~IF(85}_;a"],[4,""]]},"fields":{}},"b.":{"opcode":"argument_reporter_string_number","next":null,"parent":"^","inputs":{},"fields":{"VALUE":["fps",null]}},"_":{"opcode":"procedures_definition","next":"`","parent":null,"inputs":{"custom_block":[1,"b/"]},"fields":{},"topLevel":true},"b/":{"opcode":"procedures_prototype","next":null,"parent":"_","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"reset all data in storage","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"`":{"opcode":"localstorage_removeAll","next":"{","parent":"_","inputs":{},"fields":{}},"b:":{"opcode":"procedures_call","next":null,"parent":"{","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"save all data in storage","argumentids":"[]","warp":"true"}},"|":{"opcode":"procedures_definition","next":"}","parent":null,"inputs":{"custom_block":[1,"b;"]},"fields":{},"topLevel":true},"b;":{"opcode":"procedures_prototype","next":null,"parent":"|","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"save all data in storage","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"}":{"opcode":"localstorage_set","next":null,"parent":"|","inputs":{"KEY":[1,[10,"settings"]],"VALUE":[3,"~",[10,"0"]]},"fields":{}},"~":{"opcode":"lmsData_getListArray","next":null,"parent":"}","inputs":{"LIST":[1,"b="]},"fields":{}},"b=":{"opcode":"lmsData_menu_lists","next":null,"parent":"~","inputs":{},"fields":{"lists":["settings",null]},"shadow":true},"aa":{"opcode":"procedures_definition","next":"I","parent":null,"inputs":{"custom_block":[1,"b?"]},"fields":{},"topLevel":true},"b?":{"opcode":"procedures_prototype","next":null,"parent":"aa","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"load all data from storage","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"I":{"opcode":"lmsData_setListArray","next":null,"parent":"aa","inputs":{"LIST":[1,"b@"],"ARRAY":[3,"b[",[10,"[\"apple\",\"banana\"]"]]},"fields":{}},"b@":{"opcode":"lmsData_menu_lists","next":null,"parent":"I","inputs":{},"fields":{"lists":["settings",null]},"shadow":true},"b[":{"opcode":"localstorage_get","next":null,"parent":"I","inputs":{"KEY":[1,[10,"keybinds"]]},"fields":{}},"ds":{"opcode":"event_whenbroadcastreceived","next":null,"parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["startloops","8JGqy+^Aa=y|vQM@CdCK"]},"topLevel":true},"b]":{"opcode":"control_forever","next":null,"parent":null,"inputs":{"SUBSTACK":[2,"ab"]},"fields":{},"topLevel":true},"ab":{"opcode":"control_wait","next":"b^","parent":"b]","inputs":{"DURATION":[3,[12,"savetime","3~XMnni$=KYs%32-:{u4"],[5,".2"]]},"fields":{}},"b^":{"opcode":"procedures_call","next":null,"parent":"ab","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"save all data in storage","argumentids":"[]","warp":"true"}},"b_":{"opcode":"event_whenbroadcastreceived","next":"ac","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["startloops","8JGqy+^Aa=y|vQM@CdCK"]},"topLevel":true},"ac":{"opcode":"lmscomments_commentCommand","next":"ad","parent":"b_","inputs":{"COMMENT":[1,[10,"deltatime calculation"]]},"fields":{}},"ad":{"opcode":"control_forever","next":null,"parent":"ac","inputs":{"SUBSTACK":[2,"ae"]},"fields":{}},"ae":{"opcode":"procedures_call","next":null,"parent":"ad","inputs":{"|gUy{z6U}[/r:DBqIejp":[3,"b`",[10,""]],"kkizHE].kT;as8M7mwF`":[1,[10,"30"]]},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"calculate DT and FPS with last frame %s and base fps %s","argumentids":"[\"|gUy{z6U}[/r:DBqIejp\",\"kkizHE].kT;as8M7mwF`\"]","warp":"false"}},"b`":{"opcode":"sensing_dayssince2000","next":null,"parent":"ae","inputs":{},"fields":{}},"af":{"opcode":"procedures_definition","next":"ag","parent":null,"inputs":{"custom_block":[1,"b{"]},"fields":{},"topLevel":true},"b{":{"opcode":"procedures_prototype","next":null,"parent":"af","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"REFRESH","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"ag":{"opcode":"procedures_call","next":"b|","parent":"af","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"REFRESH//internal variables and lists","argumentids":"[]","warp":"true"}},"b|":{"opcode":"procedures_call","next":null,"parent":"ag","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"REFRESH//regular variables and lists","argumentids":"[]","warp":"true"}},"ah":{"opcode":"procedures_definition","next":"ai","parent":null,"inputs":{"custom_block":[1,"b}"]},"fields":{},"topLevel":true},"b}":{"opcode":"procedures_prototype","next":null,"parent":"ah","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"REFRESH//regular variables and lists","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"ai":{"opcode":"event_broadcast","next":"aj","parent":"ah","inputs":{"BROADCAST_INPUT":[1,[11,"resetsettings","QKQ1k*mHwjARPXaUE~8N"]]},"fields":{}},"aj":{"opcode":"data_deletealloflist","next":"ak","parent":"ai","inputs":{},"fields":{"LIST":["listTest","-NCA~NP$@K63dY8CgfC="]}},"ak":{"opcode":"lmscomments_commentCommand","next":"al","parent":"aj","inputs":{"COMMENT":[1,[10,"showcase stuff"]]},"fields":{}},"al":{"opcode":"data_addtolist","next":"am","parent":"ak","inputs":{"ITEM":[1,[10,"1"]]},"fields":{"LIST":["listTest","-NCA~NP$@K63dY8CgfC="]}},"am":{"opcode":"data_addtolist","next":"an","parent":"al","inputs":{"ITEM":[1,[10,"2"]]},"fields":{"LIST":["listTest","-NCA~NP$@K63dY8CgfC="]}},"an":{"opcode":"data_addtolist","next":"ao","parent":"am","inputs":{"ITEM":[1,[10,"3"]]},"fields":{"LIST":["listTest","-NCA~NP$@K63dY8CgfC="]}},"ao":{"opcode":"data_addtolist","next":"ap","parent":"an","inputs":{"ITEM":[1,[10,"A"]]},"fields":{"LIST":["listTest","-NCA~NP$@K63dY8CgfC="]}},"ap":{"opcode":"data_addtolist","next":"aq","parent":"ao","inputs":{"ITEM":[1,[10,"B"]]},"fields":{"LIST":["listTest","-NCA~NP$@K63dY8CgfC="]}},"aq":{"opcode":"data_addtolist","next":"ar","parent":"ap","inputs":{"ITEM":[1,[10,"C"]]},"fields":{"LIST":["listTest","-NCA~NP$@K63dY8CgfC="]}},"ar":{"opcode":"data_setvariableto","next":"b~","parent":"aq","inputs":{"VALUE":[1,[10,"123ABC"]]},"fields":{"VARIABLE":["variableTest","gHzut!oAc2vUkFX;rdgY"]}},"b~":{"opcode":"data_setvariableto","next":null,"parent":"ar","inputs":{"VALUE":[1,[10,".2"]]},"fields":{"VARIABLE":["savetime","3~XMnni$=KYs%32-:{u4"]}},"as":{"opcode":"procedures_definition","next":"at","parent":null,"inputs":{"custom_block":[1,"ca"]},"fields":{},"topLevel":true},"ca":{"opcode":"procedures_prototype","next":null,"parent":"as","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"REFRESH//internal variables and lists","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"at":{"opcode":"lmscomments_commentCommand","next":"au","parent":"as","inputs":{"COMMENT":[1,[10,"project"]]},"fields":{}},"au":{"opcode":"data_deletealloflist","next":"J","parent":"at","inputs":{},"fields":{"LIST":["INFO_project","SaE:nrOnkyk[52_JB^av"]}},"J":{"opcode":"data_addtolist","next":"av","parent":"au","inputs":{"ITEM":[3,"cb",[10,"thing"]]},"fields":{"LIST":["INFO_project","SaE:nrOnkyk[52_JB^av"]}},"cb":{"opcode":"lmscomments_commentReporter","next":null,"parent":"J","inputs":{"INPUT":[1,[10,"yolkengine"]],"COMMENT":[1,[10,"project title"]]},"fields":{}},"av":{"opcode":"data_addtolist","next":null,"parent":"J","inputs":{"ITEM":[3,"cc",[10,"thing"]]},"fields":{"LIST":["INFO_project","SaE:nrOnkyk[52_JB^av"]}},"cc":{"opcode":"lmscomments_commentReporter","next":null,"parent":"av","inputs":{"INPUT":[1,[10,"1.0.0"]],"COMMENT":[1,[10,"project internal version"]]},"fields":{}},"cd":{"opcode":"event_whenbroadcastreceived","next":"ce","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadplaceholder","pOJ?q^R-{|ltBh(bZd+d"]},"topLevel":true},"ce":{"opcode":"data_setvariableto","next":null,"parent":"cd","inputs":{"VALUE":[1,[10,"site_placeholder"]]},"fields":{"VARIABLE":["currentmenu","zXvED(W1KgL`U0CtNOGY"]}},"cf":{"opcode":"event_whenbroadcastreceived","next":"cg","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadsettings","2|w2]|W{LYrYXuWp!sYL"]},"topLevel":true},"cg":{"opcode":"data_setvariableto","next":null,"parent":"cf","inputs":{"VALUE":[1,[10,"game_settings"]]},"fields":{"VARIABLE":["currentmenu","zXvED(W1KgL`U0CtNOGY"]}},"ch":{"opcode":"event_whenbroadcastreceived","next":"aw","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["hotreload","n0e/6krql@$$XwZq+T/n"]},"topLevel":true},"aw":{"opcode":"lmscomments_commentCommand","next":"ax","parent":"ch","inputs":{"COMMENT":[1,[10,"HOT RELOADING!!!!"]]},"fields":{}},"ci":{"opcode":"procedures_call","next":null,"parent":"ax","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"REFRESH","argumentids":"[]","warp":"true"}},"ay":{"opcode":"procedures_definition","next":"K","parent":null,"inputs":{"custom_block":[1,"cj"]},"fields":{},"topLevel":true},"cj":{"opcode":"procedures_prototype","next":null,"parent":"ay","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"save data info check","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"bY":{"opcode":"procedures_call","next":null,"parent":"B","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"save data info check","argumentids":"[]","warp":"true"}},"K":{"opcode":"control_if","next":null,"parent":"ay","inputs":{"CONDITION":[2,"az"],"SUBSTACK":[2,"aA"]},"fields":{}},"ax":{"opcode":"lmscomments_commentCommand","next":"ci","parent":"aw","inputs":{"COMMENT":[1,[10,"used for quickly testing features and \"reloading\" common things in debug mode!!"]]},"fields":{}},"az":{"opcode":"operator_equals","next":null,"parent":"K","inputs":{"OPERAND1":[3,"ck",[10,""]],"OPERAND2":[1,[10,""]]},"fields":{}},"ck":{"opcode":"localstorage_get","next":null,"parent":"az","inputs":{"KEY":[1,[10,"settings"]]},"fields":{}},"aA":{"opcode":"data_deletealloflist","next":"aB","parent":"K","inputs":{},"fields":{"LIST":["settings","dVgaAG+h}b8Kv{:M2:x:"]}},"aB":{"opcode":"data_addtolist","next":null,"parent":"aA","inputs":{"ITEM":[3,"cl",[10,"thing"]]},"fields":{"LIST":["settings","dVgaAG+h}b8Kv{:M2:x:"]}},"cl":{"opcode":"lmscomments_commentReporter","next":null,"parent":"aB","inputs":{"INPUT":[1,[10,"14"]],"COMMENT":[1,[10,"test"]]},"fields":{}},"{":{"opcode":"procedures_call","next":"b:","parent":"`","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"save data info check","argumentids":"[]","warp":"true"}},":":{"opcode":"event_broadcastandwait","next":"aC","parent":"b#","inputs":{"BROADCAST_INPUT":[1,[11,"loadall","1|?96Hm04x-#?-1jh6Q%"]]},"fields":{}},"cm":{"opcode":"lmscomments_commentCommand","next":"L","parent":null,"inputs":{"COMMENT":[1,[10,"load the save data"]]},"fields":{},"topLevel":true},"L":{"opcode":"procedures_call","next":"aD","parent":"cm","inputs":{".NH|AjLiV}bES!:L`(;J":[1,[10,"1"]],"5(oC#dMvsDbr9DV;j}rv":[3,"cn",[10,"yolkengine"]]},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"get data from save file %s in project %s","argumentids":"[\".NH|AjLiV}bES!:L`(;J\",\"5(oC#dMvsDbr9DV;j}rv\"]","warp":"false"}},"cn":{"opcode":"data_itemoflist","next":null,"parent":"L","inputs":{"INDEX":[1,[7,"1"]]},"fields":{"LIST":["INFO_project","SaE:nrOnkyk[52_JB^av"]}},"aD":{"opcode":"procedures_call","next":"co","parent":"L","inputs":{"arg0":[1,[10,"save data loaded"]]},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"​​log​​ %s","argumentids":"[\"arg0\"]","warp":"false"}},"co":{"opcode":"control_wait","next":null,"parent":"aD","inputs":{"DURATION":[1,[5,"1.5"]]},"fields":{}},"aC":{"opcode":"procedures_call","next":"aE","parent":":","inputs":{"arg0":[1,[10,"starting project"]]},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"​​log​​ %s","argumentids":"[\"arg0\"]","warp":"false"}},"aE":{"opcode":"event_broadcast","next":"cp","parent":"aC","inputs":{"BROADCAST_INPUT":[1,[11,"startloops","8JGqy+^Aa=y|vQM@CdCK"]]},"fields":{}},"cp":{"opcode":"event_broadcast","next":null,"parent":"aE","inputs":{"BROADCAST_INPUT":[1,[11,"loadplaceholder","pOJ?q^R-{|ltBh(bZd+d"]]},"fields":{}},"b%":{"opcode":"event_whenbroadcastreceived","next":";","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadall","1|?96Hm04x-#?-1jh6Q%"]},"topLevel":true}},"comments":{},"currentCostume":0,"costumes":[{"name":"costume1","bitmapResolution":1,"dataFormat":"svg","assetId":"systems/internal/costume1","md5ext":"systems/internal/costume1.svg","rotationCenterX":0,"rotationCenterY":0}],"sounds":[],"volume":100,"layerOrder":3,"visible":false,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around","extensionStorage":{"SPmbpCST":{"get data from save file %s in project %s":{"color":"#FF6680"},"save data info check":{"color":"#FF6680"}}}},{"isStage":false,"name":"systems//soundsys","variables":{"YP(7Zd.iXzDBHKS-B,?B":["soundint",1],"jd5C{5Qd:$,a0N{xm*y_":["id",0]},"lists":{},"broadcasts":{},"blocks":{"aF":{"opcode":"procedures_definition","next":"e","parent":null,"inputs":{"custom_block":[1,"cq"]},"fields":{},"topLevel":true},"cq":{"opcode":"procedures_prototype","next":null,"parent":"aF","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"switch song","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"e":{"opcode":"lmsSoundExpanded_stopSound","next":"M","parent":"aF","inputs":{"SOUND":[3,"cr","cs"]},"fields":{}},"cr":{"opcode":"operator_join","next":null,"parent":"e","inputs":{"STRING1":[1,[10,"music//"]],"STRING2":[3,[12,"song:lastframesong","rBo~VN3dn::)/w6.I/b$"],[10,""]]},"fields":{}},"cs":{"opcode":"sound_sounds_menu","next":null,"parent":"e","inputs":{},"fields":{"SOUND_MENU":["choose2",null]},"shadow":true},"M":{"opcode":"data_setvariableto","next":"N","parent":"e","inputs":{"VALUE":[3,"aG",[10,"0"]]},"fields":{"VARIABLE":["song:bpm","A*-r)IxIuYB/DN~I6#6b"]}},"aG":{"opcode":"data_itemoflist","next":null,"parent":"M","inputs":{"INDEX":[3,"ct",[7,"1"]]},"fields":{"LIST":["songbpms","5r=g@f8v%F|FF$g9yn?3"]}},"ct":{"opcode":"data_itemnumoflist","next":null,"parent":"aG","inputs":{"ITEM":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,"thing"]]},"fields":{"LIST":["songnames","::wr.O5%:..~s,x3VcVQ"]}},"N":{"opcode":"data_setvariableto","next":"aH","parent":"M","inputs":{"VALUE":[3,"cu",[10,"0"]]},"fields":{"VARIABLE":["song:startingtime","VT[+TX9sYaIHJbvs|+SH"]}},"cu":{"opcode":"sensing_dayssince2000","next":null,"parent":"N","inputs":{},"fields":{}},"aH":{"opcode":"data_setvariableto","next":"f","parent":"N","inputs":{"VALUE":[1,[10,"12345"]]},"fields":{"VARIABLE":["song:lastframebeat","MOob`8Xm.7@!;ZGr8)V9"]}},"f":{"opcode":"sound_play","next":"O","parent":"aH","inputs":{"SOUND_MENU":[3,"cv","cw"]},"fields":{}},"cv":{"opcode":"operator_join","next":null,"parent":"f","inputs":{"STRING1":[1,[10,"music//"]],"STRING2":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,""]]},"fields":{}},"cw":{"opcode":"sound_sounds_menu","next":null,"parent":"f","inputs":{},"fields":{"SOUND_MENU":["music//silent",null]},"shadow":true},"O":{"opcode":"control_if","next":null,"parent":"f","inputs":{"CONDITION":[2,"aI"],"SUBSTACK":[2,"aJ"]},"fields":{}},"aI":{"opcode":"operator_not","next":null,"parent":"O","inputs":{"OPERAND":[2,"cx"]},"fields":{}},"cx":{"opcode":"operator_equals","next":null,"parent":"aI","inputs":{"OPERAND1":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,""]],"OPERAND2":[1,[10,"silent"]]},"fields":{}},"aJ":{"opcode":"lmsclonesplus_deleteCloneWithVar","next":"cy","parent":"O","inputs":{"INPUTB":[1,[10,"snddis"]]},"fields":{"INPUTA":["jd5C{5Qd:$,a0N{xm*y_",null]}},"cy":{"opcode":"lmsclonesplus_createCloneWithVar","next":null,"parent":"aJ","inputs":{"INPUTB":[1,[10,"snddis"]]},"fields":{"INPUTA":["jd5C{5Qd:$,a0N{xm*y_",null]}},"aK":{"opcode":"procedures_definition","next":"g","parent":null,"inputs":{"custom_block":[1,"cz"]},"fields":{},"topLevel":true},"cz":{"opcode":"procedures_prototype","next":null,"parent":"aK","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"music calculator","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"g":{"opcode":"control_if","next":"P","parent":"aK","inputs":{"CONDITION":[2,"aL"],"SUBSTACK":[2,"cA"]},"fields":{}},"aL":{"opcode":"operator_not","next":null,"parent":"g","inputs":{"OPERAND":[2,"cB"]},"fields":{}},"cB":{"opcode":"operator_equals","next":null,"parent":"aL","inputs":{"OPERAND1":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,""]],"OPERAND2":[3,[12,"song:lastframesong","rBo~VN3dn::)/w6.I/b$"],[10,"50"]]},"fields":{}},"cA":{"opcode":"procedures_call","next":null,"parent":"g","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"switch song","argumentids":"[]","warp":"true"}},"P":{"opcode":"data_setvariableto","next":"Q","parent":"g","inputs":{"VALUE":[3,"aM",[10,"0"]]},"fields":{"VARIABLE":["song:timr","3i~(llyAZ]j8XJ,LbY.?"]}},"aM":{"opcode":"operator_multiply","next":null,"parent":"P","inputs":{"NUM1":[3,"aN",[4,""]],"NUM2":[1,[4,"86400"]]},"fields":{}},"aN":{"opcode":"operator_subtract","next":null,"parent":"aM","inputs":{"NUM1":[3,"cC",[4,""]],"NUM2":[3,[12,"song:startingtime","VT[+TX9sYaIHJbvs|+SH"],[4,""]]},"fields":{}},"cC":{"opcode":"sensing_dayssince2000","next":null,"parent":"aN","inputs":{},"fields":{}},"Q":{"opcode":"data_setvariableto","next":"h","parent":"P","inputs":{"VALUE":[3,"aO",[10,"0"]]},"fields":{"VARIABLE":["song:beat","#|53H,/Lk{l=a]!Ws`[7"]}},"aO":{"opcode":"operator_multiply","next":null,"parent":"Q","inputs":{"NUM1":[3,[12,"song:timr","3i~(llyAZ]j8XJ,LbY.?"],[4,""]],"NUM2":[3,"cD",[4,"86400"]]},"fields":{}},"cD":{"opcode":"operator_divide","next":null,"parent":"aO","inputs":{"NUM1":[3,[12,"song:bpm","A*-r)IxIuYB/DN~I6#6b"],[4,""]],"NUM2":[1,[4,"60"]]},"fields":{}},"h":{"opcode":"control_if","next":"aP","parent":"Q","inputs":{"CONDITION":[2,"aQ"],"SUBSTACK":[2,"i"]},"fields":{}},"aQ":{"opcode":"operator_gt","next":null,"parent":"h","inputs":{"OPERAND1":[3,[12,"song:timr","3i~(llyAZ]j8XJ,LbY.?"],[10,""]],"OPERAND2":[3,"R",[10,"50"]]},"fields":{}},"R":{"opcode":"lmsSoundExpanded_attributeOfSound","next":null,"parent":"aQ","inputs":{"SOUND":[3,"cE","cF"]},"fields":{"ATTRIBUTE":["length",null]}},"cE":{"opcode":"data_itemnumoflist","next":null,"parent":"R","inputs":{"ITEM":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,"thing"]]},"fields":{"LIST":["songnames","::wr.O5%:..~s,x3VcVQ"]}},"cF":{"opcode":"sound_sounds_menu","next":null,"parent":"R","inputs":{},"fields":{"SOUND_MENU":["music//silent",null]},"shadow":true},"i":{"opcode":"sound_play","next":"aR","parent":"h","inputs":{"SOUND_MENU":[3,"cG","cH"]},"fields":{}},"cG":{"opcode":"operator_join","next":null,"parent":"i","inputs":{"STRING1":[1,[10,"music//"]],"STRING2":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,""]]},"fields":{}},"cH":{"opcode":"sound_sounds_menu","next":null,"parent":"i","inputs":{},"fields":{"SOUND_MENU":["music//silent",null]},"shadow":true},"aR":{"opcode":"data_setvariableto","next":null,"parent":"i","inputs":{"VALUE":[3,"cI",[10,"0"]]},"fields":{"VARIABLE":["song:startingtime","VT[+TX9sYaIHJbvs|+SH"]}},"cI":{"opcode":"sensing_dayssince2000","next":null,"parent":"aR","inputs":{},"fields":{}},"aP":{"opcode":"data_setvariableto","next":"b","parent":"h","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["song:beatchanged","cwdN]EJ%7Kqk-jQ^,-/h"]}},"b":{"opcode":"control_if_else","next":"aS","parent":"aP","inputs":{"CONDITION":[2,"S"],"SUBSTACK":[2,"cJ"],"SUBSTACK2":[2,"cK"]},"fields":{}},"S":{"opcode":"operator_lt","next":null,"parent":"b","inputs":{"OPERAND1":[3,"cL",[10,""]],"OPERAND2":[3,"cM",[10,"50"]]},"fields":{}},"cL":{"opcode":"operator_mod","next":null,"parent":"S","inputs":{"NUM1":[3,[12,"song:beat","#|53H,/Lk{l=a]!Ws`[7"],[4,""]],"NUM2":[1,[4,"1"]]},"fields":{}},"cM":{"opcode":"operator_mod","next":null,"parent":"S","inputs":{"NUM1":[3,[12,"song:lastframebeat","MOob`8Xm.7@!;ZGr8)V9"],[4,""]],"NUM2":[1,[4,"1"]]},"fields":{}},"cJ":{"opcode":"data_setvariableto","next":null,"parent":"b","inputs":{"VALUE":[1,[10,"1"]]},"fields":{"VARIABLE":["song:beatchanged","cwdN]EJ%7Kqk-jQ^,-/h"]}},"cK":{"opcode":"data_setvariableto","next":null,"parent":"b","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["song:beatchanged","cwdN]EJ%7Kqk-jQ^,-/h"]}},"aS":{"opcode":"data_setvariableto","next":"cN","parent":"b","inputs":{"VALUE":[3,[12,"song:beat","#|53H,/Lk{l=a]!Ws`[7"],[10,"0"]]},"fields":{"VARIABLE":["song:lastframebeat","MOob`8Xm.7@!;ZGr8)V9"]}},"cN":{"opcode":"data_setvariableto","next":null,"parent":"aS","inputs":{"VALUE":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,"0"]]},"fields":{"VARIABLE":["song:lastframesong","rBo~VN3dn::)/w6.I/b$"]}},"aT":{"opcode":"procedures_definition","next":"aU","parent":null,"inputs":{"custom_block":[1,"cO"]},"fields":{},"topLevel":true},"cO":{"opcode":"procedures_prototype","next":null,"parent":"aT","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"load soundtrack","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"aU":{"opcode":"data_setvariableto","next":"aV","parent":"aT","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["song:timr","3i~(llyAZ]j8XJ,LbY.?"]}},"aV":{"opcode":"data_setvariableto","next":"aW","parent":"aU","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["song:beat","#|53H,/Lk{l=a]!Ws`[7"]}},"aW":{"opcode":"data_setvariableto","next":"aX","parent":"aV","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["song:beatchanged","cwdN]EJ%7Kqk-jQ^,-/h"]}},"aX":{"opcode":"data_setvariableto","next":"aY","parent":"aW","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["song:lastframebeat","MOob`8Xm.7@!;ZGr8)V9"]}},"aY":{"opcode":"data_setvariableto","next":"aZ","parent":"aX","inputs":{"VALUE":[1,[10,"0"]]},"fields":{"VARIABLE":["song:lastframesong","rBo~VN3dn::)/w6.I/b$"]}},"aZ":{"opcode":"lmscomments_commentCommand","next":"a!","parent":"aY","inputs":{"COMMENT":[1,[10,"refresh"]]},"fields":{}},"a!":{"opcode":"data_deletealloflist","next":"a#","parent":"aZ","inputs":{},"fields":{"LIST":["songnames","::wr.O5%:..~s,x3VcVQ"]}},"a#":{"opcode":"data_deletealloflist","next":"a%","parent":"a!","inputs":{},"fields":{"LIST":["songinfo","tPy8=;qAJYiw,^fiS:_2"]}},"a%":{"opcode":"data_deletealloflist","next":"a(","parent":"a#","inputs":{},"fields":{"LIST":["songbpms","5r=g@f8v%F|FF$g9yn?3"]}},"a(":{"opcode":"procedures_call","next":"a)","parent":"a%","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"song names","argumentids":"[]","warp":"true"}},"a)":{"opcode":"procedures_call","next":"cP","parent":"a(","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"song bpms","argumentids":"[]","warp":"true"}},"cP":{"opcode":"procedures_call","next":null,"parent":"a)","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"song infos","argumentids":"[]","warp":"true"}},"a*":{"opcode":"procedures_definition","next":"j","parent":null,"inputs":{"custom_block":[1,"cQ"]},"fields":{},"topLevel":true},"cQ":{"opcode":"procedures_prototype","next":null,"parent":"a*","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"music check","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"false"}},"j":{"opcode":"control_if_else","next":null,"parent":"a*","inputs":{"CONDITION":[2,"cR"],"SUBSTACK":[2,"a+"],"SUBSTACK2":[2,"a,"]},"fields":{}},"cR":{"opcode":"data_listcontainsitem","next":null,"parent":"j","inputs":{"ITEM":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,"thing"]]},"fields":{"LIST":["songnames","::wr.O5%:..~s,x3VcVQ"]}},"a+":{"opcode":"sound_playuntildone","next":null,"parent":"j","inputs":{"SOUND_MENU":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],"cS"]},"fields":{}},"cS":{"opcode":"sound_sounds_menu","next":null,"parent":"a+","inputs":{},"fields":{"SOUND_MENU":["startmenu",null]},"shadow":true},"a,":{"opcode":"sound_playuntildone","next":null,"parent":"j","inputs":{"SOUND_MENU":[1,"cT"]},"fields":{}},"cT":{"opcode":"sound_sounds_menu","next":null,"parent":"a,","inputs":{},"fields":{"SOUND_MENU":["test",null]},"shadow":true},"cU":{"opcode":"event_whenbroadcastreceived","next":"a-","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["startloops","8JGqy+^Aa=y|vQM@CdCK"]},"topLevel":true},"a-":{"opcode":"data_setvariableto","next":"a.","parent":"cU","inputs":{"VALUE":[1,[10,"silent"]]},"fields":{"VARIABLE":["currentbgm",",fh=L473_%ENPq9[IXB."]}},"a.":{"opcode":"control_forever","next":null,"parent":"a-","inputs":{"SUBSTACK":[2,"cV"]},"fields":{}},"cV":{"opcode":"procedures_call","next":null,"parent":"a.","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"music calculator","argumentids":"[]","warp":"true"}},"cW":{"opcode":"lmsclonesplus_whenCloneStartsWithVar","next":"a/","parent":null,"inputs":{"INPUTB":[1,[10,"snddis"]]},"fields":{"INPUTA":["jd5C{5Qd:$,a0N{xm*y_",null]},"topLevel":true},"a/":{"opcode":"looks_setsizeto","next":"a:","parent":"cW","inputs":{"SIZE":[1,[4,"65"]]},"fields":{}},"a:":{"opcode":"looks_cleargraphiceffects","next":"a;","parent":"a/","inputs":{},"fields":{}},"a;":{"opcode":"text_setFont","next":"a=","parent":"a:","inputs":{},"fields":{"FONT":["Pixel",null]}},"a=":{"opcode":"text_setOutlineWidth","next":"a?","parent":"a;","inputs":{"WIDTH":[1,[4,"4"]]},"fields":{}},"a?":{"opcode":"text_setOutlineColor","next":"a@","parent":"a=","inputs":{"COLOR":[1,[9,"#ffffff"]]},"fields":{}},"a@":{"opcode":"text_setColor","next":"T","parent":"a?","inputs":{"COLOR":[1,[9,"#000000"]]},"fields":{}},"T":{"opcode":"text_setAlignment","next":"a[","parent":"a@","inputs":{"ALIGN":[1,"cX"]},"fields":{}},"cX":{"opcode":"text_menu_twAlign","next":null,"parent":"T","inputs":{},"fields":{"twAlign":["right",null]},"shadow":true},"a[":{"opcode":"looks_gotofrontback","next":"a]","parent":"T","inputs":{},"fields":{"FRONT_BACK":["front",null]}},"a]":{"opcode":"looks_show","next":"U","parent":"a[","inputs":{},"fields":{}},"U":{"opcode":"text_setText","next":"a^","parent":"a]","inputs":{"TEXT":[3,"a_",[10,""]]},"fields":{}},"a_":{"opcode":"operator_join","next":null,"parent":"U","inputs":{"STRING1":[1,[10,"𝅘𝅥𝅮   "]],"STRING2":[3,"a`",[10,""]]},"fields":{}},"a`":{"opcode":"data_itemoflist","next":null,"parent":"a_","inputs":{"INDEX":[3,"cY",[7,"4"]]},"fields":{"LIST":["songinfo","tPy8=;qAJYiw,^fiS:_2"]}},"cY":{"opcode":"data_itemnumoflist","next":null,"parent":"a`","inputs":{"ITEM":[3,[12,"currentbgm",",fh=L473_%ENPq9[IXB."],[10,"120"]]},"fields":{"LIST":["songnames","::wr.O5%:..~s,x3VcVQ"]}},"a^":{"opcode":"motion_gotoxy","next":"c","parent":"U","inputs":{"X":[1,[4,"200"]],"Y":[1,[4,"-164"]]},"fields":{}},"c":{"opcode":"jeremygamerTweening_tweenProperty","next":"a{","parent":"a^","inputs":{"PROPERTY":[1,"cZ"],"VALUE":[1,[4,"0"]],"SEC":[1,[4,"1"]],"MODE":[1,"c!"],"DIRECTION":[1,"c#"]},"fields":{}},"cZ":{"opcode":"jeremygamerTweening_menu_properties","next":null,"parent":"c","inputs":{},"fields":{"properties":["x position",null]},"shadow":true},"c!":{"opcode":"jeremygamerTweening_menu_modes","next":null,"parent":"c","inputs":{},"fields":{"modes":["expo",null]},"shadow":true},"c#":{"opcode":"jeremygamerTweening_menu_direction","next":null,"parent":"c","inputs":{},"fields":{"direction":["in out",null]},"shadow":true},"a{":{"opcode":"control_wait","next":"d","parent":"c","inputs":{"DURATION":[1,[5,"2"]]},"fields":{}},"d":{"opcode":"jeremygamerTweening_tweenProperty","next":"c%","parent":"a{","inputs":{"PROPERTY":[1,"c("],"VALUE":[1,[4,"200"]],"SEC":[1,[4,"1"]],"MODE":[1,"c)"],"DIRECTION":[1,"c*"]},"fields":{}},"c(":{"opcode":"jeremygamerTweening_menu_properties","next":null,"parent":"d","inputs":{},"fields":{"properties":["x position",null]},"shadow":true},"c)":{"opcode":"jeremygamerTweening_menu_modes","next":null,"parent":"d","inputs":{},"fields":{"modes":["expo",null]},"shadow":true},"c*":{"opcode":"jeremygamerTweening_menu_direction","next":null,"parent":"d","inputs":{},"fields":{"direction":["in out",null]},"shadow":true},"c%":{"opcode":"control_delete_this_clone","next":null,"parent":"d","inputs":{},"fields":{}},"a|":{"opcode":"procedures_definition","next":"c+","parent":null,"inputs":{"custom_block":[1,"c,"]},"fields":{},"topLevel":true},"c,":{"opcode":"procedures_prototype","next":null,"parent":"a|","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"song names","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"c+":{"opcode":"data_addtolist","next":null,"parent":"a|","inputs":{"ITEM":[1,[10,"silent"]]},"fields":{"LIST":["songnames","::wr.O5%:..~s,x3VcVQ"]}},"a}":{"opcode":"procedures_definition","next":"c-","parent":null,"inputs":{"custom_block":[1,"c."]},"fields":{},"topLevel":true},"c.":{"opcode":"procedures_prototype","next":null,"parent":"a}","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"song bpms","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"c-":{"opcode":"data_addtolist","next":null,"parent":"a}","inputs":{"ITEM":[1,[10,"0"]]},"fields":{"LIST":["songbpms","5r=g@f8v%F|FF$g9yn?3"]}},"a~":{"opcode":"procedures_definition","next":"c/","parent":null,"inputs":{"custom_block":[1,"c:"]},"fields":{},"topLevel":true},"c:":{"opcode":"procedures_prototype","next":null,"parent":"a~","inputs":{},"fields":{},"shadow":true,"mutation":{"tagName":"mutation","children":[],"proccode":"song infos","argumentids":"[]","argumentnames":"[]","argumentdefaults":"[]","warp":"true"}},"c/":{"opcode":"data_addtolist","next":null,"parent":"a~","inputs":{"ITEM":[1,[10,"song name - artist(s)"]]},"fields":{"LIST":["songinfo","tPy8=;qAJYiw,^fiS:_2"]}},"c;":{"opcode":"event_whenbroadcastreceived","next":"ba","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadall","1|?96Hm04x-#?-1jh6Q%"]},"topLevel":true},"ba":{"opcode":"procedures_call","next":"bb","parent":"c;","inputs":{},"fields":{},"mutation":{"tagName":"mutation","children":[],"proccode":"load soundtrack","argumentids":"[]","warp":"true"}},"bb":{"opcode":"sound_cleareffects","next":"bc","parent":"ba","inputs":{},"fields":{}},"bc":{"opcode":"sound_setvolumeto","next":"bd","parent":"bb","inputs":{"VOLUME":[1,[4,"55"]]},"fields":{}},"bd":{"opcode":"looks_hide","next":"be","parent":"bc","inputs":{},"fields":{}},"be":{"opcode":"data_setvariableto","next":null,"parent":"bd","inputs":{"VALUE":[3,"c=",[10,"0"]]},"fields":{"VARIABLE":["song:startingtime","VT[+TX9sYaIHJbvs|+SH"]}},"c=":{"opcode":"sensing_dayssince2000","next":null,"parent":"be","inputs":{},"fields":{}}},"comments":{},"currentCostume":0,"costumes":[{"name":"costume1","bitmapResolution":2,"dataFormat":"png","assetId":"systems/soundsys/costume1","md5ext":"systems/soundsys/costume1.png","rotationCenterX":0,"rotationCenterY":0}],"sounds":[{"name":"music//silent","assetId":"systems/soundsys/music/silent","dataFormat":"wav","format":"","rate":48000,"sampleCount":1,"md5ext":"systems/soundsys/music/silent.wav"}],"volume":55,"layerOrder":4,"visible":false,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"},{"isStage":false,"name":"systems//bgsys","variables":{"jd5C{5Qd:$,a0N{xm*y_":["id","sub2click"],"tdjW1l5~Q13ss}n;w-h5":["speed",0],"y?Tepx7Wg@B(`RR+NLJw":["id",0],"X~w+{U27kr7ID=?u[2y.":["clickable",0],"lVSiP`K#Z5S-!A4nGa5y":["dtimestamp",0]},"lists":{},"broadcasts":{},"blocks":{"c?":{"opcode":"event_whenbroadcastreceived","next":"bf","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["startloops","8JGqy+^Aa=y|vQM@CdCK"]},"topLevel":true},"bg":{"opcode":"looks_show","next":"V","parent":"bh","inputs":{},"fields":{}},"bf":{"opcode":"control_forever","next":null,"parent":"c?","inputs":{"SUBSTACK":[2,"bi"]},"fields":{}},"bi":{"opcode":"motion_gotoxy","next":"c@","parent":"bf","inputs":{"X":[1,[4,"0"]],"Y":[1,[4,"0"]]},"fields":{}},"c@":{"opcode":"looks_gotofrontback","next":null,"parent":"bi","inputs":{},"fields":{"FRONT_BACK":["back",null]}},"c[":{"opcode":"event_whenbroadcastreceived","next":"bj","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadall","1|?96Hm04x-#?-1jh6Q%"]},"topLevel":true},"bj":{"opcode":"looks_hide","next":"bk","parent":"c[","inputs":{},"fields":{}},"bk":{"opcode":"looks_setsizeto","next":"c]","parent":"bj","inputs":{"SIZE":[1,[4,"100"]]},"fields":{}},"c]":{"opcode":"looks_cleargraphiceffects","next":null,"parent":"bk","inputs":{},"fields":{}},"c^":{"opcode":"event_whenbroadcastreceived","next":"bh","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadplaceholder","pOJ?q^R-{|ltBh(bZd+d"]},"topLevel":true},"V":{"opcode":"looks_switchcostumeto","next":"bl","parent":"bg","inputs":{"COSTUME":[1,"c_"]},"fields":{}},"c_":{"opcode":"looks_costume","next":null,"parent":"V","inputs":{},"fields":{"COSTUME":["bg",null]},"shadow":true},"bl":{"opcode":"control_repeat","next":null,"parent":"V","inputs":{"TIMES":[1,[6,"100"]],"SUBSTACK":[2,"c`"]},"fields":{}},"bh":{"opcode":"looks_seteffectto","next":"bg","parent":"c^","inputs":{"VALUE":[1,[4,"100"]]},"fields":{"EFFECT":["GHOST",null]}},"c`":{"opcode":"looks_changeeffectby","next":null,"parent":"bl","inputs":{"CHANGE":[1,[4,"-5"]]},"fields":{"EFFECT":["GHOST",null]}}},"comments":{},"currentCostume":0,"costumes":[{"name":"bg","bitmapResolution":2,"dataFormat":"png","assetId":"systems/bgsys/bg","md5ext":"systems/bgsys/bg.png","rotationCenterX":640,"rotationCenterY":360}],"sounds":[],"volume":100,"layerOrder":1,"visible":true,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around","extensionStorage":{"SPmbpCST":{}}},{"isStage":false,"name":"placeholder","variables":{"a)RiR)TJK6@k~O[DT:QQ":["id",0],"w~^rQ-J3zaG4]d)E9vO9":["clickable",0]},"lists":{},"broadcasts":{},"blocks":{"c{":{"opcode":"lmsclonesplus_whenCloneStartsWithVar","next":"bm","parent":null,"inputs":{"INPUTB":[1,[10,"logo"]]},"fields":{"INPUTA":["a)RiR)TJK6@k~O[DT:QQ",null]},"topLevel":true},"bm":{"opcode":"motion_gotoxy","next":"W","parent":"c{","inputs":{"X":[1,[4,"0"]],"Y":[1,[4,"400"]]},"fields":{}},"W":{"opcode":"looks_switchcostumeto","next":"bn","parent":"bm","inputs":{"COSTUME":[1,"c|"]},"fields":{}},"c|":{"opcode":"looks_costume","next":null,"parent":"W","inputs":{},"fields":{"COSTUME":["logo",null]},"shadow":true},"bn":{"opcode":"looks_show","next":"k","parent":"W","inputs":{},"fields":{}},"k":{"opcode":"jeremygamerTweening_tweenProperty","next":null,"parent":"bn","inputs":{"PROPERTY":[1,"c}"],"VALUE":[1,[4,"54"]],"SEC":[1,[4,"2"]],"MODE":[1,"c~"],"DIRECTION":[1,"da"]},"fields":{}},"c}":{"opcode":"jeremygamerTweening_menu_properties","next":null,"parent":"k","inputs":{},"fields":{"properties":["y position",null]},"shadow":true},"c~":{"opcode":"jeremygamerTweening_menu_modes","next":null,"parent":"k","inputs":{},"fields":{"modes":["quart",null]},"shadow":true},"da":{"opcode":"jeremygamerTweening_menu_direction","next":null,"parent":"k","inputs":{},"fields":{"direction":["out",null]},"shadow":true},"db":{"opcode":"lmsclonesplus_whenCloneStartsWithVar","next":"bo","parent":null,"inputs":{"INPUTB":[1,[10,"text"]]},"fields":{"INPUTA":["a)RiR)TJK6@k~O[DT:QQ",null]},"topLevel":true},"bo":{"opcode":"motion_gotoxy","next":"X","parent":"db","inputs":{"X":[1,[4,"0"]],"Y":[1,[4,"-400"]]},"fields":{}},"X":{"opcode":"looks_switchcostumeto","next":"bp","parent":"bo","inputs":{"COSTUME":[1,"dc"]},"fields":{}},"dc":{"opcode":"looks_costume","next":null,"parent":"X","inputs":{},"fields":{"COSTUME":["text",null]},"shadow":true},"bp":{"opcode":"looks_show","next":"bq","parent":"X","inputs":{},"fields":{}},"bq":{"opcode":"control_wait","next":"l","parent":"bp","inputs":{"DURATION":[1,[5,"1.2"]]},"fields":{}},"l":{"opcode":"jeremygamerTweening_tweenProperty","next":null,"parent":"bq","inputs":{"PROPERTY":[1,"dd"],"VALUE":[1,[4,"-106"]],"SEC":[1,[4,"2"]],"MODE":[1,"de"],"DIRECTION":[1,"df"]},"fields":{}},"dd":{"opcode":"jeremygamerTweening_menu_properties","next":null,"parent":"l","inputs":{},"fields":{"properties":["y position",null]},"shadow":true},"de":{"opcode":"jeremygamerTweening_menu_modes","next":null,"parent":"l","inputs":{},"fields":{"modes":["quart",null]},"shadow":true},"df":{"opcode":"jeremygamerTweening_menu_direction","next":null,"parent":"l","inputs":{},"fields":{"direction":["out",null]},"shadow":true},"dg":{"opcode":"lmsclonesplus_whenCloneStartsWithVar","next":"br","parent":null,"inputs":{"INPUTB":[1,[10,"chara"]]},"fields":{"INPUTA":["a)RiR)TJK6@k~O[DT:QQ",null]},"topLevel":true},"br":{"opcode":"motion_gotoxy","next":"Y","parent":"dg","inputs":{"X":[1,[4,"0"]],"Y":[1,[4,"-620"]]},"fields":{}},"Y":{"opcode":"looks_switchcostumeto","next":"bs","parent":"br","inputs":{"COSTUME":[1,"dh"]},"fields":{}},"dh":{"opcode":"looks_costume","next":null,"parent":"Y","inputs":{},"fields":{"COSTUME":["characters",null]},"shadow":true},"bs":{"opcode":"looks_show","next":"m","parent":"Y","inputs":{},"fields":{}},"m":{"opcode":"jeremygamerTweening_tweenProperty","next":null,"parent":"bs","inputs":{"PROPERTY":[1,"di"],"VALUE":[1,[4,"0"]],"SEC":[1,[4,"2"]],"MODE":[1,"dj"],"DIRECTION":[1,"dk"]},"fields":{}},"di":{"opcode":"jeremygamerTweening_menu_properties","next":null,"parent":"m","inputs":{},"fields":{"properties":["y position",null]},"shadow":true},"dj":{"opcode":"jeremygamerTweening_menu_modes","next":null,"parent":"m","inputs":{},"fields":{"modes":["quart",null]},"shadow":true},"dk":{"opcode":"jeremygamerTweening_menu_direction","next":null,"parent":"m","inputs":{},"fields":{"direction":["out",null]},"shadow":true},"dl":{"opcode":"event_whenbroadcastreceived","next":"bt","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadall","1|?96Hm04x-#?-1jh6Q%"]},"topLevel":true},"bt":{"opcode":"lmscomments_commentCommand","next":"Z","parent":"dl","inputs":{"COMMENT":[1,[10,"refresh all"]]},"fields":{}},"Z":{"opcode":"lmsclonesplus_deleteClonesInSprite","next":"bu","parent":"bt","inputs":{"INPUT":[1,"dm"]},"fields":{}},"dm":{"opcode":"lmsclonesplus_menu_spriteMenu","next":null,"parent":"Z","inputs":{},"fields":{"spriteMenu":["menutemplate2",null]},"shadow":true},"bu":{"opcode":"motion_pointindirection","next":"bv","parent":"Z","inputs":{"DIRECTION":[1,[8,"90"]]},"fields":{}},"bv":{"opcode":"motion_gotoxy","next":"bw","parent":"bu","inputs":{"X":[1,[4,"0"]],"Y":[1,[4,"0"]]},"fields":{}},"bw":{"opcode":"looks_setsizeto","next":"dn","parent":"bv","inputs":{"SIZE":[1,[4,"100"]]},"fields":{}},"dn":{"opcode":"looks_hide","next":null,"parent":"bw","inputs":{},"fields":{}},"do":{"opcode":"event_whenbroadcastreceived","next":"!","parent":null,"inputs":{},"fields":{"BROADCAST_OPTION":["loadplaceholder","pOJ?q^R-{|ltBh(bZd+d"]},"topLevel":true},"!":{"opcode":"lmsclonesplus_deleteClonesInSprite","next":"bx","parent":"do","inputs":{"INPUT":[1,"dp"]},"fields":{}},"dp":{"opcode":"lmsclonesplus_menu_spriteMenu","next":null,"parent":"!","inputs":{},"fields":{"spriteMenu":["placeholder",null]},"shadow":true},"bx":{"opcode":"control_wait","next":"by","parent":"!","inputs":{"DURATION":[1,[5,".5"]]},"fields":{}},"by":{"opcode":"lmsclonesplus_createCloneWithVar","next":"bz","parent":"bx","inputs":{"INPUTB":[1,[10,"logo"]]},"fields":{"INPUTA":["a)RiR)TJK6@k~O[DT:QQ",null]}},"bz":{"opcode":"lmsclonesplus_createCloneWithVar","next":"dq","parent":"by","inputs":{"INPUTB":[1,[10,"text"]]},"fields":{"INPUTA":["a)RiR)TJK6@k~O[DT:QQ",null]}},"dq":{"opcode":"lmsclonesplus_createCloneWithVar","next":null,"parent":"bz","inputs":{"INPUTB":[1,[10,"chara"]]},"fields":{"INPUTA":["a)RiR)TJK6@k~O[DT:QQ",null]}}},"comments":{},"currentCostume":0,"costumes":[{"name":"logo","bitmapResolution":2,"dataFormat":"png","assetId":"placeholder/logo","md5ext":"placeholder/logo.png","rotationCenterX":206,"rotationCenterY":191},{"name":"characters","bitmapResolution":2,"dataFormat":"png","assetId":"placeholder/characters","md5ext":"placeholder/characters.png","rotationCenterX":640,"rotationCenterY":360},{"name":"text","bitmapResolution":2,"dataFormat":"png","assetId":"placeholder/text","md5ext":"placeholder/text.png","rotationCenterX":125,"rotationCenterY":55}],"sounds":[],"volume":100,"layerOrder":2,"visible":false,"x":0,"y":0,"size":100,"direction":90,"draggable":false,"rotationStyle":"all around"}],"monitors":[{"id":",fh=L473_%ENPq9[IXB.","mode":"default","opcode":"data_variable","params":{"VARIABLE":"currentbgm"},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":34,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"A*-r)IxIuYB/DN~I6#6b","mode":"default","opcode":"data_variable","params":{"VARIABLE":"song:bpm"},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":34,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"YP(7Zd.iXzDBHKS-B,?B","mode":"default","opcode":"data_variable","params":{"VARIABLE":"soundint"},"spriteName":"soundsys","value":0,"width":0,"height":0,"x":0,"y":46,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"::wr.O5%:..~s,x3VcVQ","mode":"list","opcode":"data_listcontents","params":{"LIST":"songnames"},"spriteName":null,"value":[],"width":0,"height":0,"x":0,"y":1,"visible":false},{"id":"5r=g@f8v%F|FF$g9yn?3","mode":"list","opcode":"data_listcontents","params":{"LIST":"songbpms"},"spriteName":null,"value":[],"width":0,"height":0,"x":144,"y":0,"visible":false},{"id":"KFpix-!7SB]_S*P?_@jj","mode":"large","opcode":"data_variable","params":{"VARIABLE":"FPS"},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":3,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"cwdN]EJ%7Kqk-jQ^,-/h","mode":"default","opcode":"data_variable","params":{"VARIABLE":"song:beatchanged"},"spriteName":null,"value":0,"width":0,"height":0,"x":97,"y":145,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"tPy8=;qAJYiw,^fiS:_2","mode":"list","opcode":"data_listcontents","params":{"LIST":"songinfo"},"spriteName":null,"value":[],"width":105,"height":202,"x":254,"y":0,"visible":false},{"id":"sensing_mousedown","mode":"default","opcode":"sensing_mousedown","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":5,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"[+p!#d5.+6~IF(85}_;a","mode":"default","opcode":"data_variable","params":{"VARIABLE":"DELTATIME"},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":5,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"undefined_direction","mode":"default","opcode":"motion_direction","params":{},"spriteName":"titlemenu","value":0,"width":0,"height":0,"x":0,"y":5,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"undefined_volume","mode":"default","opcode":"sound_volume","params":{},"spriteName":"titlemenu","value":0,"width":0,"height":0,"x":0,"y":5,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"timer","mode":"large","opcode":"sensing_timer","params":{},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":5,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"3~XMnni$=KYs%32-:{u4","mode":"default","opcode":"data_variable","params":{"VARIABLE":"savetime"},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":64,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"#|53H,/Lk{l=a]!Ws`[7","mode":"default","opcode":"data_variable","params":{"VARIABLE":"song:beat"},"spriteName":null,"value":0,"width":0,"height":0,"x":0,"y":5,"visible":false,"sliderMin":0,"sliderMax":100,"isDiscrete":true},{"id":"SaE:nrOnkyk[52_JB^av","mode":"list","opcode":"data_listcontents","params":{"LIST":"INFO_project"},"spriteName":null,"value":[],"width":0,"height":0,"x":0,"y":70,"visible":false},{"id":"dVgaAG+h}b8Kv{:M2:x:","mode":"list","opcode":"data_listcontents","params":{"LIST":"settings"},"spriteName":null,"value":[],"width":0,"height":0,"x":0,"y":5,"visible":false}],"extensions":["SPmbpCST","localstorage","lmsData","lmscomments","lmsSoundExpanded","lmsclonesplus","text","jeremygamerTweening"],"extensionURLs":{"SPmbpCST":"data:text/javascript;base64,Ly8gTmFtZTogTXkgQmxvY2tzKwovLyBJRDogU1BtYnBDU1QKLy8gRGVzY3JpcHRpb246IENyZWF0ZSBCZXR0ZXIgQ3VzdG9tIEJsb2NrcwovLyBCeTogU2hhcmtQb29sCi8vIEJ5OiBDU1QxMjI5IDxodHRwczovL3NjcmF0Y2gubWl0LmVkdS91c2Vycy9DU1QxMjI5Lz4KLy8gQnk6IDB6bnp3IDxodHRwczovL3NjcmF0Y2gubWl0LmVkdS91c2Vycy8wem56dy8+Ci8vIExpY2Vuc2U6IE1JVAoKLy8gVmVyc2lvbiBWLjEuMi41CgooZnVuY3Rpb24oU2NyYXRjaCkgewogICJ1c2Ugc3RyaWN0IjsKICBpZiAoIVNjcmF0Y2guZXh0ZW5zaW9ucy51bnNhbmRib3hlZCkgdGhyb3cgbmV3IEVycm9yKCJNeSBCbG9ja3MrIG11c3QgcnVuIHVuc2FuZGJveGVkISIpOwoKICBjb25zdCBtZW51SWNvblVSSSA9CiAgICAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0kwTnk0NU5EZ2lJR2hsYVdkb2REMGlORGN1T1RRNElpQjJhV1YzUW05NFBTSXdJREFnTkRjdU9UUTRJRFEzTGprME9DSStQSEJoZEdnZ1pEMGlUVEFnTWpNdU9UYzBRekFnTVRBdU56TTBJREV3TGpjek15QXdJREl6TGprM05DQXdjekl6TGprM05DQXhNQzQzTXpNZ01qTXVPVGMwSURJekxqazNOQzB4TUM0M016TWdNak11T1RjMExUSXpMamszTkNBeU15NDVOelJUTUNBek55NHlNVFVnTUNBeU15NDVOelFpSUdacGJHdzlJaU5qWXpVeU5qWWlMejQ4Y0dGMGFDQmtQU0pOTWk0eU1URWdNak11T1RjMFl6QXRNVEl1TURJZ09TNDNORFF0TWpFdU56WXpJREl4TGpjMk15MHlNUzQzTmpOek1qRXVOell6SURrdU56UTBJREl4TGpjMk15QXlNUzQzTmpNdE9TNDNORFFnTWpFdU56WXpMVEl4TGpjMk15QXlNUzQzTmpOVE1pNHlNVEVnTXpVdU9Ua3pJREl1TWpFeElESXpMamszTkNJZ1ptbHNiRDBpSTJabU5qWTRNQ0l2UGp4d1lYUm9JR1E5SWswek9TNHhOVElnTVRRdU5EVTFkakU1TGpBek9HRXhMakV5SURFdU1USWdNQ0F3SURFdExqWTFJREV1TURFNWJDMHhOQzQxTlRnZ05pNDNNVGxoTVM0eE1pQXhMakV5SURBZ01DQXhMUzQ1TkNBd2JDMHhOQzQxTlRndE5pNDNNbUV4TGpFeUlERXVNVElnTUNBd0lERXRMalkxTFRFdU1ERTRWakUwTGpRMU5HRXhMakV5SURFdU1USWdNQ0F3SURFZ0xqWTFMVEV1TURFNWJERTBMalUxT0MwMkxqY3hPV0V4TGpFeUlERXVNVElnTUNBd0lERWdMamswSURCc01UUXVOVFU0SURZdU56SmpMak01Tnk0eE9ETXVOalV4TGpVNExqWTFJREV1TURFNGJTMHlOeTQxTmlBd0lERXhMamc0TWlBMUxqUTRPQ0F4TVM0NE9ESXROUzQwT0RndE1URXVPRGd5TFRVdU5EZzNlbTB0TVM0MU5UWWdNVGd1TXpJeElERXlMak14T0NBMUxqWTRPVll5TVM0NE9Xd3RNVEl1TXpFNExUVXVOamc1ZW0weU5pNDROellnTUZZeE5pNHlNREZzTFRFeUxqTXhPQ0ExTGpZNWRqRTJMalUzTTNvaUlHWnBiR3c5SWlObVptWWlMejQ4Y0dGMGFDQmtQU0pOTXpJdU16UTJJRE0yTGpFMk9YWXRNaTQyTnpob0xUSXVOamM0WXkweExqTTJOU0F3TFRJdU5EY3lMUzQ1TlRNdE1pNDBOekl0TWk0eE1qaHpNUzR4TURjdE1pNHhNamdnTWk0ME56SXRNaTR4TWpob01pNDJOemgyTFRJdU5qYzRZekF0TVM0ek5qVXVPVFV6TFRJdU5EY3lJREl1TVRJNExUSXVORGN5Y3pJdU1USTRJREV1TVRBM0lESXVNVEk0SURJdU5EY3lkakl1TmpjNGFESXVOamM0WXpFdU16WTFJREFnTWk0ME56SXVPVFV5SURJdU5EY3lJREl1TVRJNElEQWdNUzR4TnpVdE1TNHhNRGNnTWk0eE1qZ3RNaTQwTnpJZ01pNHhNamhvTFRJdU5qYzRkakl1TmpjNFl6QWdNUzR6TmpVdExqazFNeUF5TGpRM01pMHlMakV5T0NBeUxqUTNNbk10TWk0eE1qZ3RNUzR4TURjdE1pNHhNamd0TWk0ME56SjZJaUJtYVd4c1BTSnViMjVsSWlCemRISnZhMlU5SWlObVpqWTJPREFpSUhOMGNtOXJaUzEzYVdSMGFEMGlOQ0l2UGp4d1lYUm9JR1E5SWswek1pNHpORFlnTXpZdU1UWTVkaTB5TGpZM09HZ3RNaTQyTnpoakxURXVNelkxSURBdE1pNDBOekl0TGprMU15MHlMalEzTWkweUxqRXlPSE14TGpFd055MHlMakV5T1NBeUxqUTNNaTB5TGpFeU9XZ3lMalkzT0hZdE1pNDJOemRqTUMweExqTTJOUzQ1TlRNdE1pNDBOeklnTWk0eE1qZ3RNaTQwTnpKek1pNHhNamdnTVM0eE1EY2dNaTR4TWpnZ01pNDBOekoyTWk0Mk56ZG9NaTQyTnpoak1TNHpOalVnTUNBeUxqUTNNaTQ1TlRNZ01pNDBOeklnTWk0eE1qa2dNQ0F4TGpFM05TMHhMakV3TnlBeUxqRXlPQzB5TGpRM01pQXlMakV5T0dndE1pNDJOemgyTWk0Mk56aGpNQ0F4TGpNMk5TMHVPVFV5SURJdU5EY3lMVEl1TVRJNElESXVORGN5TFRFdU1UYzFJREF0TWk0eE1qZ3RNUzR4TURjdE1pNHhNamd0TWk0ME56SWlJR1pwYkd3OUlpTm1abVlpTHo0OEwzTjJaejQ9IjsKCiAgY29uc3QgZ3VpVVJJcyA9IChuYW1lKSA9PiB7CiAgICBjb25zdCBzdGFydCA9ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSSI7CiAgICByZXR1cm4gc3RhcnQgKyB7CiAgICAgICJkcm9wZHduIjogIjFOeUlnYUdWcFoyaDBQU0kwT1NJZ2RtbGxkMEp2ZUQwaU1DQXdJRFUzSURRNUlqNDhaeUJ6ZEhKdmEyVXRiV2wwWlhKc2FXMXBkRDBpTVRBaVBqeHdZWFJvSUdROUlrMDBMalVnTkRndU5XRTBJRFFnTUNBd0lERXROQzAwZGkwME1HRTBJRFFnTUNBd0lERWdOQzAwYURRNFlUUWdOQ0F3SURBZ01TQTBJRFIyTkRCaE5DQTBJREFnTUNBeExUUWdOSG9pSUdacGJHdzlJaU5tWmpZMk9EQWlJSE4wY205clpUMGlJMll6TlNJdlBqeHdZWFJvSUdROUlrMHhNaTR4TWpNZ016a3VPRE5qTFRFdU5UQTNJREF0TWk0M015MHhMakUwTkMweUxqY3pMVEl1TlRVMWRpMHlOUzQxTldNd0xURXVOREV4SURFdU1qSXpMVEl1TlRVMUlESXVOek10TWk0MU5UVm9Nekl1TnpVMFl6RXVOVEEzSURBZ01pNDNNeUF4TGpFME5DQXlMamN6SURJdU5UVTFkakkxTGpVMVl6QWdNUzQwTVRFdE1TNHlNak1nTWk0MU5UVXRNaTQzTXlBeUxqVTFOWG9pSUdacGJHdzlJaU5tWmpSa05tRWlJSE4wY205clpUMGlJMll6TlNJdlBqeHdZWFJvSUdROUlrMHpOaTR3T0RRZ01qSXVNVFkzWVRJdU9EZ2dNaTQ0T0NBd0lEQWdNUzB1T0RRNElESXVNRFV6YkMwMExqWTNOeUEwTGpZM04yRXlMamt5TkNBeUxqa3lOQ0F3SURBZ01TMDBMakV4T0NBd2JDMDBMalkyTlMwMExqWTNOMkV5TGprZ01pNDVJREFnTUNBeExTNDROaTB5TGpBMU15QXlMamsySURJdU9UWWdNQ0F3SURFZ0xqZzBPQzB5TGpBMk5HTXVNelEyTFM0eU9EY3VPRFU1TFM0NE5EZ2dOaTQzTkRJdExqZzBPSE0yTGpRek1pNDFOU0EyTGpjekxqZzBPR011TlRRMkxqVTBPQzQ0TlNBeExqSTVMamcwT0NBeUxqQTJOQ0lnWm1sc2JEMGlJMll6TlNJdlBqeHdZWFJvSUdROUlrMHlPQzQxTURZZ01qZ3VOVFV4WVRFdU55QXhMamNnTUNBd0lERXRNUzR4T1RNdExqVnNMVFF1TnpBeUxUUXVOamM1WVRFdU56SWdNUzQzTWlBd0lEQWdNU0F3TFRJdU16ZzJZeTQyTmpndExqWTJPU0F4TVM0eE1TMHVOalk1SURFeExqYzNPQ0F3SUM0Mk5ETXVOalkxTGpZME15QXhMamN5SURBZ01pNHpPRFpzTFRRdU5qYzRJRFF1TmpjNFl5MHVNekl1TXpJdExqYzFNeTQxTFRFdU1qQTFMalV3TVNJZ1ptbHNiRDBpSTJabVppSXZQand2Wno0OEwzTjJaejQ9IiwKICAgICAgImNvbG9yUGtyIjogInlNQ0lnYUdWcFoyaDBQU0l5TUNJZ2RtbGxkMEp2ZUQwaUxUSWdMVE1nTWpBZ01qQWlQanh3WVhSb0lHUTlJazB4TVM0d05qUWdOUzQxTmpJZ09TNDBNRGtnTXk0NU1EaHNMVE11T1RRZ015NDVNbU10TGpFeUxqRXpOeTB1TWpBMUxqSTNOQzB1TWpRdU5ERXRMakU0Tnk0NE5USXRMamd4T0NBeExqVXRNUzQxTVRjZ01TNDNNakpoTVNBeElEQWdNQ0F3TFM0MU9DNDFNVEZzTFM0NE16WWdNUzQzT1dNdExqQTFNUzR4TWkwdU1EVXhMakU0T0MwdU1EVXhMakl3Tld3dU1qY3pMakkxTldFdU5pNDJJREFnTUNBd0lDNHhPRGN0TGpBMWJERXVOemMwTFM0NE16WmpMakkwTFM0eE1pNDBOaTB1TXpVNExqVXpMUzQxT0M0eU1EUXRMalk1T1M0NE55MHhMak16SURFdU5UWTRMVEV1TkRnekxqSTNNeTB1TURZNExqUXlOeTB1TVRVekxqVTBOaTB1TWpsNmJUSXVNRE10TVM0M09TNHhNell1TVRNMkxqVTRMalU0WVM0NE9EUXVPRGcwSURBZ01DQXhJREFnTVM0eU5EUnNMUzQyTmpVdU5qUTRZUzQ0TkRjdU9EUTNJREFnTUNBeExURXVNVFl1TURZNGJDMHpMamsxT0NBekxqa3pPR0V5TGpBM0lESXVNRGNnTUNBd0lERXRNUzR3TURZdU5UazNZeTB1TkRFdU1EZzFMUzQzTVRZdU16YzFMUzQzT0RVdU5qUTNMUzR4Tnk0MU5qTXRMalkwT0NBeExqQTVNUzB4TGpJeElERXVNelkwYkMweExqYzVNaTQ0TXpaakxTNHlNemt1TVRBeUxTNDBPVFV1TVRjdExqY3hOaTR4TjJFeExqSWdNUzR5SURBZ01DQXhMUzQ0TnkwdU16UnNMUzR6TkRFdExqTTBNbU10TGpNM05pMHVNemt5TFM0ME5EUXRNUzR3TURZdExqRTNNUzB4TGpZd01td3VPRE0yTFRFdU56Y3pZeTR5TlRZdExqVTJNeTQ0TURJdE1TNHdOQ0F4TGpNMk5DMHhMakl4TGpJM015MHVNRGcyTGpVMk15MHVNemMyTGpZeE5TMHVOak14TGpFeE9TMHVOVEV5TGpNeU5DMHVPRGN1TmpFMExURXVNVGMzYkRNdU9UVTNMVE11T1RNM1l5MHVNamt0TGpNME1TMHVNamN6TFM0NE16WXVNRFV4TFRFdU1UYzNiQzQyTmpVdExqWTBPR0V1T0RnMkxqZzROaUF3SURBZ01TQXhMakkwTmlBd2JDNDFORFl1TlRRMkxqRTNMakUzVERFeUxqWTROQzR6T1RaaE1TNHpNeUF4TGpNeklEQWdNQ0F4SURFdU9EazBJREJqTGpJMU5pNHlOVFl1TXpreUxqVTVOeTR6T1RJdU9UTTRjeTB1TVRNMkxqWTVPUzB1TXpreUxqazFOWG9pSUdacGJHdzlJbTV2Ym1VaUlITjBjbTlyWlMxdmNHRmphWFI1UFNJdU1qVWlJSE4wY205clpUMGlJekF3TUNJZ2MzUnliMnRsTFhkcFpIUm9QU0l6SWk4K1BIQmhkR2dnWkQwaVRURXhMakEyTkNBMUxqVTJNaUE1TGpRd09TQXpMamt3T0d3dE15NDVOQ0F6TGpreVl5MHVNVEl1TVRNM0xTNHlNRFV1TWpjMExTNHlOQzQwTVMwdU1UZzNMamcxTWkwdU9ERTRJREV1TlMweExqVXhOeUF4TGpjeU1tRXhJREVnTUNBd0lEQXRMalU0TGpVeE1Xd3RMamd6TmlBeExqYzVZeTB1TURVeExqRXlMUzR3TlRFdU1UZzRMUzR3TlRFdU1qQTFiQzR5TnpNdU1qVTFZUzQyTGpZZ01DQXdJREFnTGpFNE55MHVNRFZzTVM0M056UXRMamd6Tm1NdU1qUXRMakV5TGpRMkxTNHpOVGd1TlRNdExqVTRMakl3TkMwdU5qazVMamczTFRFdU16TWdNUzQxTmprdE1TNDBPRE11TWpjeUxTNHdOamd1TkRJMkxTNHhOVE11TlRRMUxTNHlPWHB0TWk0d015MHhMamM1TGpFek5pNHhNell1TlRndU5UaGhMamc0TkM0NE9EUWdNQ0F3SURFZ01DQXhMakkwTkd3dExqWTJOUzQyTkRoaExqZzBOeTQ0TkRjZ01DQXdJREV0TVM0eE5pNHdOamhzTFRNdU9UVTRJRE11T1RNNFlUSXVNRGNnTWk0d055QXdJREFnTVMweExqQXdOaTQxT1RkakxTNDBNUzR3T0RVdExqY3hOaTR6TnpVdExqYzROUzQyTkRjdExqRTNMalUyTXkwdU5qUTRJREV1TURreExURXVNakVnTVM0ek5qUnNMVEV1TnpreUxqZ3pObU10TGpJek9TNHhNREl0TGpRNU5TNHhOeTB1TnpFMkxqRTNZVEV1TWlBeExqSWdNQ0F3SURFdExqZzNMUzR6TkRGc0xTNHpOREV0TGpNMFl5MHVNemMyTFM0ek9UTXRMalEwTkMweExqQXdOeTB1TVRjeExURXVOakF6YkM0NE16WXRNUzQzTnpOakxqSTFOaTB1TlRZekxqZ3dNaTB4TGpBMElERXVNelkwTFRFdU1qRXVNamN6TFM0d09EWXVOVFl6TFM0ek56WXVOakUxTFM0Mk16RXVNVEU1TFM0MU1USXVNekkwTFM0NE55NDJNVFF0TVM0eE56ZHNNeTQ1TlRjdE15NDVNemhqTFM0eU9TMHVNelF0TGpJM015MHVPRE0xTGpBMU1TMHhMakUzTm13dU5qWTJMUzQyTkRoaExqZzROaTQ0T0RZZ01DQXdJREVnTVM0eU5EVWdNR3d1TlRRMkxqVTBOaTR4Tnk0eE4wd3hNaTQyT0RRdU16azJZVEV1TXpNZ01TNHpNeUF3SURBZ01TQXhMamc1TkNBd1l5NHlOVFl1TWpVMkxqTTVNaTQxT1RjdU16a3lMamt6T0hNdExqRXpOaTQyT1RrdExqTTVNaTQ1TlRWNklpQm1hV3hzUFNJalptWm1JaTgrUEM5emRtYysiLAogICAgICAiYnJhbmNoU3RhcnQiOiAieU1DNHpPVGtpSUdobGFXZG9kRDBpTWpFdU5ESXlJaUIyYVdWM1FtOTRQU0l3SURBZ01qQXVNems1SURJeExqUXlNaUkrUEhCaGRHZ2daRDBpVFRFekxqWTFJREUyTGpjME5tTXRMalkxTlMwdU1qZ3RNUzB1T1MweExURXVOWFl0TVM0Mll5MHhMak10TGpFdE1pNDFMUzQxTFRNdU5pMHhMakZzTFM0eE5EWXRMakEzT0dNdU1EVTBMalkwTmk0d09EY2dNUzR3T0M0d09UWWdNUzR5TURSb01TNDJZeTQySURBZ01TNHlNVGd1TXpRZ01TNDFJREZ6TGpBNU5pQXhMakU0TmkwdU15QXhMamhqTFM0d05qTXVNRGs0TFRRdU5TQTBMalV0TkM0MUlEUXVOUzB1Tnk0MkxURXVOeTQyTFRJdU5DQXdiQzAwTGpRdE5DNDBZeTB1TXkwdU15MHVOUzB1T0MwdU5TMHhMaklnTUMweElDNDRMVEV1TnlBeExqY3RNUzQzYURFdU5XTXdMUzR4T0RNdU1qVTRMVE11T1RnekxqUTRMVGN1TkRFMkxqRXlNeTB4TGprd09DNHlNelV0TXk0M056SXVNamcxTFRRdU56WTVMakF4TXkwdU1EWTJMakF6TFM0eU1ERXVNRFV5TFM0eU5qUXVNVFkwTFM0M01EWXVPREl5TFRFdU1qRWdNUzQyTnkweExqSXhMamc0TFM0eE1qSWdNUzQ0T0RFdU5qRTBJREV1T1NBeExqWTBjUzR3TWpJdU1EUXlMakF5T0M0d05qVmpMakUyTlM0NE5UWXVNeklnTVM0NE5UTXVORFl5SURJdU9TNHlOeTQxTURjdU5qUTRMams0TXk0NU9ERWdNUzQwTWpndU9DQXhMakVnTWk0eE9URWdNUzQ0SURNdU5Ua3hJREV1T0hZdE1TNDFZekF0TGprdU55MHhMamNnTVM0M0xURXVOeTQwSURBZ0xqa3VNaUF4TGpJdU5XdzBMalFnTkM0MFl5NDJMamN1TmlBeExqY2dNQ0F5TGpSc0xUUXVOU0EwTGpWekxURXVNVFExTGpVNExURXVPQzR6SWlCbWFXeHNMVzl3WVdOcGRIazlJaTR5SWk4K1BIQmhkR2dnWkQwaVRUUXVOalk1SURJdU1EYzVRelF1TlRnMUlERXVORGd5SURVdU1EazNMamt3TlNBMUxqZ3dOeTQ1TURaakxqVTVOaTB1TURnMElERXVNamMyTGpReU9DQXhMakkzTlNBeExqRXpPQ0F3SUM0d01UTXVNVEUwSURFdU1EWTNMakkySURJdU5UZ3pZVGNnTnlBd0lEQWdNQ0F1T1RJMUlERXVOemN4WXk0Mkxqa2dNUzQxT1RJZ01TNDJJREl1TmpreUlESWdMamt1TXlBeExqZ3VOQ0F5TGpndU1uWXRNaTQwWXpBdExqUXVNeTB1Tnk0M0xTNDNMaklnTUNBdU15NHhMalF1TW13MExqUWdOQzQwWXk0ekxqTXVNeTQzSURBZ0xqbHNMVFF1TkNBMExqUmpMUzR6TGpNdExqUTFPQzQwTXpFdExqZ3pNaTR6TmpsekxTNHpOamd0TGpVMk9TMHVNelk0TFM0MU5qbDJMVEl1Tm1NdE1TNDFJREF0TWk0NUxTNHpMVFF1TWkweFlUZ3VNeUE0TGpNZ01DQXdJREV0TVM0MU55MHhMakF5TkdNdU1UVXhJREl1TVRnNExqSTFOQ0F6TGpnNE1pNHlOVFFnTkM0eE5EaG9NaTQyY3k0ME5qSXVNRGMyTGpVdU15QXdJQzQyTFM0ekxqbHNMVFF1TkNBMExqUmpMUzR5TGpNdExqWXVNeTB1T1NBd2JDMDBMalF0TkM0MFl5MHVNUzB1TVMwdU1pMHVNaTB1TWkwdU5DQXdMUzQwTGpNdExqY3VOeTB1TjJneUxqTTVPR011TURVMExURXVOVGszTGpFME5TMDBMakl5TGpJek9TMDJMalkyTkM0d01pMHVOVGt1TURReExURXVNVGcyTGpBMk15MHhMamMzTm5FdU1EQXpMUzR3T1RrdU1ERTFMUzR4T1RKakxqQTFMVEV1TVRnekxqSXhMVFF1TVRFeExqSXhMVFF1TVRFeElpQm1hV3hzUFNJalptWm1JaTgrUEM5emRtYysiLAogICAgICAiYWRkSW1nIjogInlNQ0lnYUdWcFoyaDBQU0l5TUNJZ2RtbGxkMEp2ZUQwaU1DQXdJREl3SURJd0lqNDhaeUJtYVd4c1BTSnViMjVsSWlCbWFXeHNMWEoxYkdVOUltVjJaVzV2WkdRaVBqeG5JSE4wY205clpUMGlJMFpHUmlJZ2MzUnliMnRsTFd4cGJtVmpZWEE5SW5KdmRXNWtJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqRXVOU0krUEhCaGRHZ2daRDBpYlRFMkxqRTBOQ0F4TWk0M09DMHlMalExT0MweUxqVXpNV0V1T1RjdU9UY2dNQ0F3SURBdE1TNHpORGN0TGpBMlREa3VNamsxSURFeUxqWTJZeTB1TkRZNUxqTTJNaTB4TGpFeE15NHpNREl0TVM0ME5qUXRMakU0YkMwdU1qa3pMUzR6TmpOakxTNHpOUzB1TkRneUxURXVNRFV6TFM0MU5ETXRNUzQwTmpNdExqRTRURE11T0RVZ01UTXVPREExYURCak1DQXVPRFV5TGpZNUlERXVOVFF6SURFdU5UUXpJREV1TlRRemFEZ3VPREZoTWlBeUlEQWdNQ0F3SURJdE1uWXRMalUyT0hvaUlHWnBiR3c5SWlOR1JrWWlJSE4wY205clpTMXNhVzVsYW05cGJqMGljbTkxYm1RaUx6NDhjR0YwYUNCa1BTSk5NVFl1TWpBeklEZ3VNVGgyTlM0eU9UUmpNQ0F1T1RjMExTNDNPU0F4TGpjMk5DMHhMamMyTlNBeExqYzJORWcxTGpZeE5XTXRMamszTlNBd0xURXVOelkxTFM0M09TMHhMamMyTlMweExqYzJOSFl0Tnk0d05tTXdMUzQ1TnpRdU56a3RNUzQzTmpRZ01TNDNOalV0TVM0M05qUm9OeTR3TlRraUx6NDhMMmMrUEhCaGRHZ2daRDBpVFRFMkxqZzVOeUF6TGprNE5XZ3VOall5WVM0Mk5qSXVOall5SURBZ01TQXhJREFnTVM0ek1qUm9MUzQyTmpKMkxqWTJNbUV1TmpZeUxqWTJNaUF3SURFZ01TMHhMak15TXlBd2RpMHVOall5YUMwdU5qWXlZUzQyTmpJdU5qWXlJREFnTUNBeElEQXRNUzR6TWpSb0xqWTJNbll0TGpZMk1XRXVOall5TGpZMk1pQXdJREFnTVNBeExqTXlNeUF3ZWlJZ1ptbHNiRDBpSTBaR1JpSXZQanh3WVhSb0lITjBjbTlyWlQwaUkwWkdSaUlnYzNSeWIydGxMWGRwWkhSb1BTSXVNaUlnWkQwaVRURTJMamswTnlBekxqa3pOV2d1TmpFeVlTNDNNVEl1TnpFeUlEQWdNU0F4SURBZ01TNDBNalJzTFM0Mk1USXRMakExZGk0Mk5qSmhMamN4TWk0M01USWdNQ0F4SURFdE1TNDBNak1nTUd3dU1EVXRMall4TW1ndExqWTJNbUV1TnpFeUxqY3hNaUF3SURFZ01TQXdMVEV1TkRJMGJDNDJNVEl1TURWMkxTNDJOakZoTGpjeE1pNDNNVElnTUNBeElERWdNUzQwTWpNZ01Ib2lMejQ4TDJjK1BDOXpkbWMrIgogICAgfVtuYW1lXTsKICB9OwogIGNvbnN0IGlucHV0VVJJcyA9IChuYW1lKSA9PiB7CiAgICBsZXQgc3RhcnQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWoiOwogICAgaWYgKG5hbWUgPT09ICJicmMiKSByZXR1cm4gc3RhcnQgKyAiSXhNUzQxSURFMU5TNDFJRFUzSURRNUlqNDhjR0YwYUNCa1BTSk5NakUySURJd05HRTBJRFFnTUNBd0lERXROQzAwZGkwME1HRTBJRFFnTUNBd0lERWdOQzAwYkRRNExqWTFNUzR3TlROQk5DQTBJREFnTUNBeElESTJPQ0F4TmpCMk9DNHhNamhqTUNBeExqTXRNaTR4T0RRZ015NHpPRE10TXk0NE56Y2dNeTR6T0ROb0xURXpMams0TW1NdE1TNHhNRFVnTUMweExqWTFOeTQxTlRJdE1pNHlNU0F4TGpFd05Xd3RNaTR5TURrZ01pNHlNRGxqTFM0MU5USXVOVFV5TFRFdU1UQTFJREV1TVRBMUxUSXVNakVnTVM0eE1EVm9MVFl1TmpJM1l5MHhMakV3TlNBd0xURXVOalUzTFM0MU5UTXRNaTR5TVMweExqRXdOV3d0TWk0eU1Ea3RNaTR5TVdNdExqVTFNaTB1TlRVeUxURXVNVEExTFRFdU1UQTBMVEl1TWpFdE1TNHhNRFJvTFRRdU5ERTRZeTB4TGpJeUlEQXRNaTR5TVM0NU9TMHlMakl4SURJdU1qRjJNVEl1TlRVMFl6QWdNUzR5TWk0NU9TQXlMakl3T0NBeUxqSXhJREl1TWpBNGFEUXVOREU1WXpFdU1UQTBJREFnTVM0Mk5UY3VOVFV6SURJdU1qRWdNUzR4TURWc01pNHlNRGdnTWk0eU1XTXVOVFV6TGpVMU1pQXhMakV3TlNBeExqRXdOQ0F5TGpJeElERXVNVEEwYURZdU5qSTRZekV1TVRBMElEQWdNUzQyTlRjdExqVTFNaUF5TGpJd09TMHhMakV3Tld3eUxqSXhMVEl1TWpBNVl5NDFOVEl0TGpVMU1pQXhMakV3TkMweExqRXdOU0F5TGpJd09TMHhMakV3TldneE15NDVPREpqTVM0Mk9UTWdNQ0F6TGpnM055QXlMakV3TkNBekxqZzNOeUF6TGpVd01sWXlNREJoTkNBMElEQWdNQ0F4TFRRZ05Ib2lJSE4wZVd4bFBTSm1hV3hzT2lObVpqWTJPREE3YzNSeWIydGxPaU5tTXpVaUx6NDhMM04yWno0PSI7CiAgICBlbHNlIGlmIChuYW1lID09PSAiaW1nIikgcmV0dXJuIHN0YXJ0ICsgIkFnTUNBMU55QTBPU0krUEhCaGRHZ2daRDBpVFRRdU5TQTBPQzQxWVRRZ05DQXdJREFnTVMwMExUUjJMVFF3WVRRZ05DQXdJREFnTVNBMExUUm9ORGhoTkNBMElEQWdNQ0F4SURRZ05IWTBNR0UwSURRZ01DQXdJREV0TkNBMGVpSWdabWxzYkQwaUkyWm1Oalk0TUNJZ2MzUnliMnRsUFNJalpqTTFJaTgrUEhCaGRHZ2daRDBpVFRNNUxqTXlJREUyTGpNME1uWXhNQzQwTWpSak1DQXVORFV6TFM0eE1UTXVOemt6TFM0ME5UTWdNUzR3TWkwekxqRTNNaUF5TGpZd05pMDNMamd4T0NBeUxqWXdOaTB4TVM0eE1ETWdNR0UyTGpFMUlEWXVNVFVnTUNBd0lEQXRNeTQ0TlRNdE1TNHpObU10TVM0ME56TXVNVEV6TFRJdU56RTVMalk0TFRNdU9EVXlJREV1TkRjemRqY3VNalV4WXpBZ0xqVTJOeTB1TlRZM0lERXVNVE16TFRFdU1UTXpJREV1TVRNemFDMHVNVEV6WXkwdU5UWTNJREF0TVM0eE16TXRMalUyTmkweExqRXpNeTB4TGpFek0zWXRNakV1TTJNd0xTNDJPQzQxTmpZdE1TNHhNelFnTVM0eE16TXRNUzR4TXpRdU5UWTJJREFnTVM0eE16TXVORFUwSURFdU1UTXpJREV1TVRNMGRpNDBOVE5qTXk0d05Ua3RNUzQwTnpNZ05pNDNPVGd0TVM0d01pQTVMalF3TkNBeExqRXpNMkUyTGpFMElEWXVNVFFnTUNBd0lEQWdOeTQzTURRZ01HTXVNelF0TGpNMExqa3dOeTB1TkRVeklERXVNell0TGpJeU55NDFOall1TVRFekxqa3dOaTQxTmpjdU9UQTJJREV1TVRNemJTMHhMakV6TXlBd0xTNHhNVE10TGpFeE0yZ3RMakl5TjJNdE1pNDNNVGtnTWk0eE5UTXROaTQwTlRnZ01pNHhOVE10T1M0eE56Y2dNQzB5TGpRNU15MHhMamt5TmkwMUxqZzVNaTB5TGpJMk5pMDRMamN5TkMwdU5qaDJNVEF1T1Rsak1TNHlORFl0TGpZNElESXVORGt5TFRFdU1UTXpJRE11T0RVeUxURXVNalEySURFdU55QXdJRE11TWpnMkxqVTJOeUEwTGpVek1pQXhMalU0Tm1FM0xqWTROU0EzTGpZNE5TQXdJREFnTUNBNUxqYzBOQzB1TVRFemVpSWdabWxzYkQwaUl6UTFPVGt6WkNJdlBqeHdZWFJvSUdROUltMHpPQzR4T0RjZ01UWXVORFUxTFM0eE1UTWdNVEF1TXpFeGRpNHhNVE5qTFRJdU9ETXlJREl1TWpZMkxUWXVPVEV4SURJdU1qWTJMVGt1TnpRMElEQXRNUzR5TkRZdE1TNHdNaTB5TGpnek15MHhMalU0TmkwMExqVXpNaTB4TGpVNE5pMHhMak0yTGpFeE15MHlMall3Tmk0MU5qY3RNeTQ0TlRJZ01TNHlORFoyTFRFd0xqazVZekl1T0RNeUxURXVOVGcySURZdU1qTXhMVEV1TWpRMklEZ3VOekkwTGpZNElESXVOeklnTWk0eE5UTWdOaTQwTlRnZ01pNHhOVE1nT1M0eE56Y2dNR2d1TWpJM1l6QWdMakV4TXk0eE1UTXVNVEV6TGpFeE15NHlNallpSUdacGJHdzlJaU0wWTJKbU5UWWlMejQ4TDNOMlp6ND0iOwoKICAgIHN0YXJ0ICs9ICJBZ01DQTFOeUEwT1NJK1BISmxZM1FnZUQwaUxqVWlJSGs5SWk0MUlpQjNhV1IwYUQwaU5UWWlJR2hsYVdkb2REMGlORGdpSUhKNFBTSTBJaUJ5ZVQwaU5DSWdjM1I1YkdVOUltWnBiR3c2STJabU5qWTRNRHR6ZEhKdmEyVXRiV2wwWlhKc2FXMXBkRG94TUR0emRISnZhMlU2STJZek5TSXZQanh5WldOMElIZzlJamd1TlNJZ2VUMGlPQzQxSWlCM2FXUjBhRDBpTkRBaUlHaGxhV2RvZEQwaU16SWlJSEo0UFNJeE5pSWdjbms5SWpFMklpQnpkSGxzWlQwaWMzUnliMnRsT2lObSI7CiAgICByZXR1cm4gc3RhcnQgKyB7CiAgICAgICJub3JtIjogIk16VTdabWxzYkRvalptWm1PM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpDSXZQangwWlhoMElITjBlV3hsUFNKbWIyNTBMWE5wZW1VNk1USndlRHRtYVd4c09pTTJaVGMwT0RnN1ptOXVkQzFtWVcxcGJIazZTR1ZzZG1WMGFXTmhUbVYxWlMxQ2IyeGtMQ0JJWld4MlpYUnBZMkVnVG1WMVpTd2djMkZ1Y3kxelpYSnBaanRtYjI1MExYZGxhV2RvZERvM01EQTdiR1YwZEdWeUxYTndZV05wYm1jNk1HVnRPeUlnZEhKaGJuTm1iM0p0UFNKMGNtRnVjMnhoZEdVb01UY3VOU0F5T1NraVBuUmxlSFE4TDNSbGVIUStQQzl6ZG1jKyIsCiAgICAgICJudW0iOiAiTXpVN1ptbHNiRG9qWm1abU8zTjBjbTlyWlMxc2FXNWxZMkZ3T25KdmRXNWtPM04wY205clpTMXNhVzVsYW05cGJqcHliM1Z1WkNJdlBqeDBaWGgwSUhOMGVXeGxQU0ptYjI1MExYTnBlbVU2TVRKd2VEdG1hV3hzT2lNMlpUYzBPRGc3Wm05dWRDMW1ZVzFwYkhrNlNHVnNkbVYwYVdOaFRtVjFaUzFDYjJ4a0xFaGxiSFpsZEdsallTQk9aWFZsTEhOaGJuTXRjMlZ5YVdZN1ptOXVkQzEzWldsbmFIUTZOekF3TzJ4bGRIUmxjaTF6Y0dGamFXNW5PakFpSUhSeVlXNXpabTl5YlQwaWRISmhibk5zWVhSbEtESTFJREk1S1NJK01Ed3ZkR1Y0ZEQ0OEwzTjJaejQ9IiwKICAgICAgImNvbCI6ICJabVk3Wm1sc2JEb2pNR1l3TzNOMGNtOXJaUzFzYVc1bFkyRndPbkp2ZFc1a08zTjBjbTlyWlMxc2FXNWxhbTlwYmpweWIzVnVaQ0l2UGp3dmMzWm5QZz09IiwKICAgICAgImFuZyI6ICJabVk3Wm1sc2JEb2pORFE0T0dVMk8zTjBjbTlyWlMxc2FXNWxZMkZ3T25KdmRXNWtPM04wY205clpTMXNhVzVsYW05cGJqcHliM1Z1WkNJdlBqeHdZWFJvSUdROUlrMHhOaTR4TlRRZ01qUXVOV013TFRZdU56Z2dOUzQwT1RZdE1USXVNamMySURFeUxqSTNOaTB4TWk0eU56WlROREF1TnpBMUlERTNMamN5SURRd0xqY3dOU0F5TkM0MUlETTFMakl4SURNMkxqYzNOaUF5T0M0ME15QXpOaTQzTnpZZ01UWXVNVFUwSURNeExqSTRJREUyTGpFMU5DQXlOQzQxZWlJZ1ptbHNiRDBpSXpReU9EQmtOeUlnYzNSeWIydGxQU0lqTXpNM00yTmpJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlpNDFJaTgrUEhCaGRHZ2daRDBpVFRJNExqUXpJREkwTGpWV01USXVOVEEwWXpZdU5qSTFJREFnTVRFdU9UazJJRFV1TXpjZ01URXVPVGsySURFeExqazVObm9pSUdacGJHd3RiM0JoWTJsMGVUMGlMaklpSUdacGJHdzlJaU5tWm1ZaUx6NDhjR0YwYUNCa1BTSk5Namd1TkRNZ01qUXVOV2d4TWk0eU56VWlJSE4wY205clpUMGlJMlptWmlJZ2MzUnliMnRsTFhkcFpIUm9QU0l1TlNJZ2MzUnliMnRsTFd4cGJtVmpZWEE5SW5KdmRXNWtJaTgrUEhCaGRHZ2daRDBpVFRJNExqUXpJREkwTGpWV01USXVORFE0SWlCemRISnZhMlU5SWlObVptWWlJSE4wY205clpTMTNhV1IwYUQwaUxqVWlMejQ4Y0dGMGFDQmtQU0pOTXpjdU16RWdNalF1TldneExqVTJOMjB0TGpNMU5pQXlMamN3TkMweExqVXhNeTB1TkRBMmJTMHVPRGc0SURJdU1UUXlJREV1TXpVNExqYzRORTB6TkM0M01TQXpNQzQzT0d3eExqRXdOeUF4TGpFd04yMHRNaTQ1TkRjdU16QXpMamM0TkNBeExqTTFPRzB0TWk0NU1qWXRMalEzTGpRd05pQXhMalV4TTIwdE1pNDNNRFF1TXpVMlZqTXpMak00YlMweUxqSTVPQzB1TXpBeUxTNDBNRFlnTVM0MU1UTnRMVEl1TlRJdE1TNHdORE11TnpnMExURXVNelU0YlMweExqZzBMVEV1TkRFdE1TNHhNRGNnTVM0eE1EZHRMUzR6TURNdE1pNDVORGN0TVM0ek5UZ3VOemcwYlM0ME55MHlMamt5TmkweExqVXhNeTQwTURaTk1Ua3VOVFVnTWpRdU5XZ3RNUzQxTmpkdE1TNDROamt0TWk0eU9UZ3RNUzQxTVRNdExqUXdObTB4TGpBME15MHlMalV5SURFdU16VTNMamM0TkcweExqUXhNUzB4TGpnMExURXVNVEEzTFRFdU1UQTNiVEl1T1RRM0xTNHpNRE10TGpjNE5DMHhMak0xT0cweUxqa3lOaTQwTnkwdU5EQTJMVEV1TlRFemJUSXVOekEwSURFdU1qRXhkaTB4TGpVMk4yMHlMamN3TkM0ek5UWXRMalF3TmlBeExqVXhNMjB5TGpreU5pMHVORGN0TGpjNE5DQXhMak0xT0cweExqZzBJREV1TkRFZ01TNHhNRGN0TVM0eE1EZHRNUzQyTmpFZ01pNHhOak10TVM0ek5UZ3VOemcwYlM0NE9EZ2dNaTR4TkRJZ01TNDFNVE10TGpRd05pSWdjM1J5YjJ0bExXOXdZV05wZEhrOUlpNDFJaUJ6ZEhKdmEyVTlJaU5tWm1ZaUlITjBjbTlyWlMxM2FXUjBhRDBpTGpJMUlpOCtQSEJoZEdnZ1pEMGlUVEkzTGprd09DQXlOQzQxWVM0MU1qSXVOVEl5SURBZ01TQXhJREV1TURRMElEQWdMalV5TWk0MU1qSWdNQ0F3SURFdE1TNHdORFFnTUhvaUlHWnBiR3c5SWlObVptWWlJSE4wY205clpUMGlJMlptWmlJZ2MzUnliMnRsTFhkcFpIUm9QU0l1TlNJdlBqeHdZWFJvSUdROUlrMHpPQzQxTlRVZ01qUXVOV0V5TGpZeE1pQXlMall4TWlBd0lERWdNU0ExTGpJeU15QXdJREl1TmpFeUlESXVOakV5SURBZ01DQXhMVFV1TWpJeklEQjZJaUJtYVd4c1BTSWpabVptSWlCemRISnZhMlV0YjNCaFkybDBlVDBpTGpJMUlpQnpkSEp2YTJVOUlpTm1abVlpSUhOMGNtOXJaUzEzYVdSMGFEMGlNaUl2UGp4bklIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLQzB5TVRFdU5TQXRNVFUxTGpVcElpQm1hV3hzUFNJak5HTTVOMlptSWlCbWFXeHNMWEoxYkdVOUltVjJaVzV2WkdRaUx6NDhjR0YwYUNCa1BTSk5OREV1TVRjeElESXpMamN4TldNd0xTNHhORFF1TURrekxTNHhPUzR5TVMwdU1UQXpiREVnTGpjME9XTXVNVEUyTGpBNE5pNHhNVGN1TWpJMExTNHdNRE11TXpGc0xTNDVPVFF1TnpKakxTNHhNVGd1TURnMExTNHlNVE11TURNMUxTNHlNVE10TGpFd04zWXRMalF6Tm13dE1TNHhOemd0TGpFNU5tRXVNVFl1TVRZZ01DQXdJREV0TGpFeU9DMHVNVFV5WXpBdExqQTNNeTR3TmkwdU1UUXVNVEk0TFM0eE5USnNNUzR4TnpndExqRTVOM29pSUdacGJHdzlJaU0wWXprM1ptWWlJR1pwYkd3dGNuVnNaVDBpWlhabGJtOWtaQ0l2UGp3dmMzWm5QZz09IiwKICAgICAgIm5vdGUiOiAiTXpVN1ptbHNiRG9qWm1abUlpOCtQSEJoZEdnZ1pEMGlUVE0xTGpjMElESTRMak13TkdNdU1qazJJREV1TkRjNUxURXVNRGdnTWk0Mk56TXRNeTR3TnpNZ01pNDJOek10TVM0NU9Ea2dNQzB6TGpnek5pMHhMakU1TkMwMExqRXlOeTB5TGpZM015MHVNamszTFRFdU5EZ2dNUzR3TnpndE1pNDJOemdnTXk0d056SXRNaTQyTnpndU5ERTVJREFnTGpnekxqQTFOQ0F4TGpJeU5DNHhOVEV1TWpFNUxqQTFOaTQwTVRJdU1URTNMall3Tnk0eE9UWXVOVFkwTFM0d01UTXRMakEyTnkweExqUTROaTB4TGpFNE9DMDNMamt5TFRFdU16Z3lMVGN1T1RZNElERXVPVGd4TFRFdU1qRXlJRFV1TmpjNExURXVOemd6SURNdU5qazNMUzQxTnpNdU1EVWdNeTR4TWpFdE1pNHpOalFnTWk0ME9TMHlMalF4TWkwdU5qUXRNeTR3TVRFdE5DNDJNek11TVRjZ09TNDFORFI2YlMweE1TNHdNRGdnTXk0NE9HTXVNamtnTVM0ME9DMHhMakE0TlNBeUxqWTNPUzB6TGpBM01TQXlMalkzT1MweExqazRPQ0F3TFRNdU9ETTFMVEV1TWkwMExqRXpNaTB5TGpZNExTNHlPUzB4TGpRM09DQXhMakE0TkMweUxqWTNOeUF6TGpBM05pMHlMalkzTnk0Mk5TQXdJREV1TWpndU1USTNJREV1T0RVdU16VXlMalV6TWkwdU1ETTJMUzR3T1RndE1TNDFOQzB4TGpJd055MDNMamt5TFRFdU16Z3ROeTQ1TmpnZ01TNDVPREl0TVM0eU1URWdOUzQyTnpZdE1TNDNPRE1nTXk0Mk9UWXRMalUzT1M0d05TQXpMakV5TWkweUxqTTJNaUF5TGpRNE15MHlMalF4TWkwdU5qUXRNeTR3TVRJdE5DNDJNekl1TVRjZ09TNDFORFY2SWlCbWFXeHNQU0lqTm1VM05EZzRJaTgrUEM5emRtYysiLAogICAgICAibWF0IjogIk16VTdabWxzYkRvak1HUmhOVGRoSWk4K1BIQmhkR2dnWkQwaVRURTNMalVnTVRZdU5XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01YcHROU0F3WVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZWlJZ1ptbHNiRDBpSTJabVppSXZQanh3WVhSb0lHUTlJazB5Tnk0MUlERTJMalZoTVNBeElEQWdNQ0F4TFRFdE1YWXRNbUV4SURFZ01DQXdJREVnTVMweGFESmhNU0F4SURBZ01DQXhJREVnTVhZeVlURWdNU0F3SURBZ01TMHhJREY2SWlCbWFXeHNQU0lqTUdaaVpEaGpJaTgrUEhCaGRHZ2daRDBpVFRNeUxqVWdNVFl1TldFeElERWdNQ0F3SURFdE1TMHhkaTB5WVRFZ01TQXdJREFnTVNBeExURm9NbUV4SURFZ01DQXdJREVnTVNBeGRqSmhNU0F4SURBZ01DQXhMVEVnTVhwdE5TQXdZVEVnTVNBd0lEQWdNUzB4TFRGMkxUSmhNU0F4SURBZ01DQXhJREV0TVdneVlURWdNU0F3SURBZ01TQXhJREYyTW1FeElERWdNQ0F3SURFdE1TQXhlbTB0TWpBZ05XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01YcHROU0F3WVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZW0wMUlEQmhNU0F4SURBZ01DQXhMVEV0TVhZdE1tRXhJREVnTUNBd0lERWdNUzB4YURKaE1TQXhJREFnTUNBeElERWdNWFl5WVRFZ01TQXdJREFnTVMweElERjZiVFVnTUdFeElERWdNQ0F3SURFdE1TMHhkaTB5WVRFZ01TQXdJREFnTVNBeExURm9NbUV4SURFZ01DQXdJREVnTVNBeGRqSmhNU0F4SURBZ01DQXhMVEVnTVhwdE5TQXdZVEVnTVNBd0lEQWdNUzB4TFRGMkxUSmhNU0F4SURBZ01DQXhJREV0TVdneVlURWdNU0F3SURBZ01TQXhJREYyTW1FeElERWdNQ0F3SURFdE1TQXhlbTB0TWpBZ05XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01Yb2lJR1pwYkd3OUlpTm1abVlpTHo0OGNHRjBhQ0JrUFNKTk1qSXVOU0F5Tmk0MVlURWdNU0F3SURBZ01TMHhMVEYyTFRKaE1TQXhJREFnTUNBeElERXRNV2d5WVRFZ01TQXdJREFnTVNBeElERjJNbUV4SURFZ01DQXdJREV0TVNBeGVpSWdabWxzYkQwaUl6Qm1ZbVE0WXlJdlBqeHdZWFJvSUdROUlrMHlOeTQxSURJMkxqVmhNU0F4SURBZ01DQXhMVEV0TVhZdE1tRXhJREVnTUNBd0lERWdNUzB4YURKaE1TQXhJREFnTUNBeElERWdNWFl5WVRFZ01TQXdJREFnTVMweElERjZJaUJtYVd4c1BTSWpabVptSWk4K1BIQmhkR2dnWkQwaVRUTXlMalVnTWpZdU5XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01Yb2lJR1pwYkd3OUlpTXdabUprT0dNaUx6NDhjR0YwYUNCa1BTSk5NemN1TlNBeU5pNDFZVEVnTVNBd0lEQWdNUzB4TFRGMkxUSmhNU0F4SURBZ01DQXhJREV0TVdneVlURWdNU0F3SURBZ01TQXhJREYyTW1FeElERWdNQ0F3SURFdE1TQXhlbTB0TWpBZ05XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01Yb2lJR1pwYkd3OUlpTm1abVlpTHo0OGNHRjBhQ0JrUFNKTk1qSXVOU0F6TVM0MVlURWdNU0F3SURBZ01TMHhMVEYyTFRKaE1TQXhJREFnTUNBeElERXRNV2d5WVRFZ01TQXdJREFnTVNBeElERjJNbUV4SURFZ01DQXdJREV0TVNBeGVtMDFJREJoTVNBeElEQWdNQ0F4TFRFdE1YWXRNbUV4SURFZ01DQXdJREVnTVMweGFESmhNU0F4SURBZ01DQXhJREVnTVhZeVlURWdNU0F3SURBZ01TMHhJREY2YlRVZ01HRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01Yb2lJR1pwYkd3OUlpTXdabUprT0dNaUx6NDhjR0YwYUNCa1BTSk5NemN1TlNBek1TNDFZVEVnTVNBd0lEQWdNUzB4TFRGMkxUSmhNU0F4SURBZ01DQXhJREV0TVdneVlURWdNU0F3SURBZ01TQXhJREYyTW1FeElERWdNQ0F3SURFdE1TQXhlbTB0TWpBZ05XRXhJREVnTUNBd0lERXRNUzB4ZGkweVlURWdNU0F3SURBZ01TQXhMVEZvTW1FeElERWdNQ0F3SURFZ01TQXhkakpoTVNBeElEQWdNQ0F4TFRFZ01YcHROU0F3WVRFZ01TQXdJREFnTVMweExURjJMVEpoTVNBeElEQWdNQ0F4SURFdE1XZ3lZVEVnTVNBd0lEQWdNU0F4SURGMk1tRXhJREVnTUNBd0lERXRNU0F4ZWlJZ1ptbHNiRDBpSTJabVppSXZQanh3WVhSb0lHUTlJazB5Tnk0MUlETTJMalZoTVNBeElEQWdNQ0F4TFRFdE1YWXRNbUV4SURFZ01DQXdJREVnTVMweGFESmhNU0F4SURBZ01DQXhJREVnTVhZeVlURWdNU0F3SURBZ01TMHhJREY2SWlCbWFXeHNQU0lqTUdaaVpEaGpJaTgrUEhCaGRHZ2daRDBpVFRNeUxqVWdNell1TldFeElERWdNQ0F3SURFdE1TMHhkaTB5WVRFZ01TQXdJREFnTVNBeExURm9NbUV4SURFZ01DQXdJREVnTVNBeGRqSmhNU0F4SURBZ01DQXhMVEVnTVhwdE5TQXdZVEVnTVNBd0lEQWdNUzB4TFRGMkxUSmhNU0F4SURBZ01DQXhJREV0TVdneVlURWdNU0F3SURBZ01TQXhJREYyTW1FeElERWdNQ0F3SURFdE1TQXhlaUlnWm1sc2JEMGlJMlptWmlJdlBqd3ZjM1puUGc9PSIsCiAgICAgICJlbXAiOiAiTXpVN1ptbHNiRG9qWm1ZMFpEWmhPM04wY205clpTMXNhVzVsWTJGd09uSnZkVzVrTzNOMGNtOXJaUzFzYVc1bGFtOXBianB5YjNWdVpDSXZQand2YzNablBnPT0iCiAgICB9W25hbWVdOwogIH07CgogIGNvbnN0IHZtID0gU2NyYXRjaC52bTsKICBjb25zdCBydW50aW1lID0gdm0ucnVudGltZTsKICBjb25zdCBpc1BNID0gU2NyYXRjaC5leHRlbnNpb25zLmlzUGVuZ3Vpbk1vZDsKCiAgY29uc3QgVEVNUF9CTE9DS19PUENPREUgPSAiU1BtYnBDU1RfJC0sLl9fX1NQbWJwQ1NUX1RFTVBfQkxPQ0siOyAvLyBvcGNvZGUgb2YgdGhlIHRlbXBvcmFyeSBibG9jayBhZGRlZCB0byBrZWVwIHRoZSBleHRlbnNpb24gaW4gdGhlIHByb2plY3QKICBjb25zdCBDVVNUT01fTUVOVV9JRCA9ICJTUDB6TWVudU1ha2VyX21lbnVfIjsKICBjb25zdCB0YXJnZXRQcm9jRGF0YSA9IFN5bWJvbCgiTUJQcHJvY2VkdXJlRGF0YSIpOyAvLyBwbGFjZSB0byBzdG9yZSBpbXBvcnRhbnQgZ2xvYmFsIHByb2NlZHVyZSBkYXRhCgogIGxldCBwcm9jZWR1cmVzWE1MID0gIiIsIHRlbXBTdG9yZSA9IHt9LCBzdG9yYWdlID0ge307CiAgbGV0IGdsb2JhbEJsb2Nrc0NhY2hlID0ge307CiAgbGV0IGdsb2JhbFRhcmdldEZvY3VzID0gdW5kZWZpbmVkOyAvLyBub3QgdG8gYmUgY29uZnVzZWQgd2l0aCBnbG9iYWxCbG9ja3NDYWNoZSwgdGhpcyBoZWxwcyBmaW5kIGJsb2NrIElEcyBpbiBzdGFja3MKCiAgbGV0IGltZ1N0b3JhZ2UgPSB7fSwgaW1nU3RvcmVTaXplID0gMDsKCiAgbGV0IGV4dGVuc2lvblJlbW92YWJsZSA9IGZhbHNlOwogIGxldCBleHQ7IC8vIGV4dGVuc2lvbiBvYmplY3QKICBsZXQgZXhlY3V0ZSwgVGhyZWFkOyAvLyBzZXQgYnkgZXhwb3J0cwoKICBmdW5jdGlvbiB0aGVtZWlmeUNvbG9yKGhleCkgewogICAgaWYgKGlzUE0pIHJldHVybiBbaGV4XTsKICAgIGNvbnN0IHRoZW1lT2JqID0gUmVkdXhTdG9yZS5nZXRTdGF0ZSgpLnNjcmF0Y2hHdWkudGhlbWUudGhlbWUuZ2V0Q3VzdG9tRXh0ZW5zaW9uQ29sb3JzKCk7CiAgICByZXR1cm4gT2JqZWN0LmtleXModGhlbWVPYmopLmxlbmd0aCA9PT0gMCA/IFtoZXhdIDogWwogICAgICB0aGVtZU9iai5wcmltYXJ5KGhleCksIHRoZW1lT2JqLnNlY29uZGFyeShoZXgpLCB0aGVtZU9iai50ZXJ0aWFyeShoZXgpCiAgICBdOwogIH0KCiAgY29uc3QgaW5wdXRUeXBlcyA9IHsKICAgIGNvbDogeyBvcGNvZGU6ICJjb2xvdXJfcGlja2VyIiwgZmllbGROYW1lOiAiQ09MT1VSIiwgZGVmYXVsdFZhbHVlOiAoKCkgPT4gYCMke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIE1hdGgucG93KDIsIDI0KSkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDYsICIwIil9YCkgfSwKICAgIG5vdGU6IHsgb3Bjb2RlOiAibm90ZSIsIGZpZWxkTmFtZTogIk5PVEUiLCBkZWZhdWx0VmFsdWU6ICI2MCIgfSwKICAgIG1hdDogeyBvcGNvZGU6ICJtYXRyaXgiLCBmaWVsZE5hbWU6ICJNQVRSSVgiLCBkZWZhdWx0VmFsdWU6IGlzUE0gPyAiMTExMTAwMTAxMDAxMTEwMDEwMDAxMTAwMCIgOiAiMTExMTExMDEwMTAwMTAwMDAxMDAwMTExMCIgfSwKICAgIGFuZzogeyBvcGNvZGU6ICJtYXRoX2FuZ2xlIiwgZmllbGROYW1lOiAiTlVNIiwgZGVmYXVsdFZhbHVlOiAiOTAiIH0sCiAgICAvLyAlbiB0ZWNobmljYWxseSBhbHJlYWR5IGV4aXN0cyBidXQgc29tZSBwYXJ0cyBvZiBzY3JhdGNoLWJsb2NrcyByZXBsYWNlIGl0IHdpdGggJXMgc28gd2UgY2FuJ3QgdXNlIGl0CiAgICBudW06IHsgb3Bjb2RlOiAibWF0aF9udW1iZXIiLCBmaWVsZE5hbWU6ICJOVU0iLCBkZWZhdWx0VmFsdWU6ICIwIiB9LAogICAgZW1wOiB7IG9wY29kZTogImVtcCIsIGZpZWxkTmFtZTogIkVNUFRZIn0sCiAgICBicmM6IHsgb3Bjb2RlOiAiYnJjIiwgZmllbGROYW1lOiAiU1VCU1RBQ0siIH0sCiAgICBpbWc6IHsgb3Bjb2RlOiAiaW1nIiwgZmllbGROYW1lOiAiSU1BR0UiIH0KICB9OwogIGZ1bmN0aW9uIGdldElucHV0RGF0YShpbnB1dCkgewogICAgaWYgKGlucHV0LmlzRHJvcCkgcmV0dXJuIHsgb3Bjb2RlOiBpbnB1dC50eXBlLCBmaWVsZE5hbWU6IG51bGwsIGRlZmF1bHRWYWx1ZTogbnVsbCB9OwogICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoaW5wdXRUeXBlcywgaW5wdXQudHlwZSkpIHJldHVybiB7fTsKICAgIHJldHVybiBpbnB1dFR5cGVzW2lucHV0LnR5cGVdOwogIH0KICAvLyBVc2VkIGZvciBzZXR0aW5nIGlucHV0cyB0byB0aGUgY29ycmVjdCBibG9jayBjb2xvcgogIGZ1bmN0aW9uIGlzTm9ybWFsSW5wdXQob3Bjb2RlKSB7CiAgICByZXR1cm4gb3Bjb2RlID09PSAibm90ZSIgfHwgb3Bjb2RlID09PSAibWF0cml4IiB8fCBvcGNvZGUgPT09ICJjb2xvdXJfcGlja2VyIgogICAgICB8fCBvcGNvZGUgPT09ICJtYXRoX2FuZ2xlIiB8fCBvcGNvZGUgPT09ICJtYXRoX251bWJlciIgfHwgb3Bjb2RlID09PSAidGV4dCI7CiAgfQoKICAvLyBpZiB0cnVlLCBzY3JvbGxpbmcgdG8gTXkgQmxvY2tzIHdpbGwgc2Nyb2xsIHRvIE15IEJsb2NrcysgaW5zdGVhZAogIC8vIHVzZWQgdG8gbWFrZSB0aGUgTWFrZSBhIEJsb2NrIGRpYWxvZyBzY3JvbGwgdG8gdGhlIE1CKyBjYXRlZ29yeQogIGxldCBzaG91bGRTY3JvbGxUb01CUCA9IGZhbHNlOwoKICAvLyByZWZyZXNoIHRoZSBibG9jayBsaXN0IGlmIHRydWUgd2hlbiBjYWxsZWQsIG90aGVyd2lzZSBkb2VzIG5vdGhpbmcKICBsZXQgbGlzdE5lZWRzUmVmcmVzaCA9IGZhbHNlLCBzdXNwZW5kUmVtb3ZhbCA9IGZhbHNlLCBvbGRMaXN0TGVuZ3RoID0gMDsKCiAgLy8gQ3VzdG9tIEJsb2NrIE1vZGFsCiAgY29uc3QgcmV0dXJuVHlwZUVycm9yID0gKGUpID0+IHsKICAgIC8vIHVzZWQgZm9yIFBlbmd1aW5Nb2QKICAgIGNvbnN0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgZGl2W2NsYXNzPSJSZWFjdE1vZGFsUG9ydGFsIl1gKTsKICAgIGlmIChtb2RhbD8ucGFyZW50Tm9kZSkgewogICAgICBjb25zb2xlLndhcm4oIklnbm9yZSB0aGUgZm9sbG93aW5nIEVycm9yIGFib3V0ICdjb25uZWN0aW9uREJMaXN0JywgaXQgZml4ZXMgaXRzZWxmIik7CiAgICAgIG1vZGFsLnF1ZXJ5U2VsZWN0b3IoYFtjbGFzc149ImNsb3NlLWJ1dHRvbl9jbG9zZS1idXR0b25fIl1gKS5jbGljaygpOwogICAgfQogIH07CgogIC8vIENsZWFuIG5vbmV4aXN0ZW50IGlucHV0cyBmcm9tIHRoZSBpbnB1dHMgb2JqZWN0CiAgZnVuY3Rpb24gY2xlYW51cEJsb2NrSW5wdXRzKGlucHV0cywgYXJncykgewogICAgZm9yIChjb25zdCBpbnB1dElkIGluIGlucHV0cykgewogICAgICBpZiAoIWFyZ3MuaW5jbHVkZXMoaW5wdXRJZCkpIGRlbGV0ZSBpbnB1dHNbaW5wdXRJZF07CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvcGVuQmxvY2tNYWtlcih3b3Jrc3BhY2UsIGlzRWRpdGluZykgewogICAgaWYgKGV4dGVuc2lvblJlbW92YWJsZSkgcmV0dXJuOwogICAgbGlzdE5lZWRzUmVmcmVzaCA9IHRydWU7CiAgICBzaG91bGRTY3JvbGxUb01CUCA9IHRydWU7CiAgICBjb25zdCBpc0RhcmsgPSBpc1BNID8gZG9jdW1lbnQuYm9keS5nZXRBdHRyaWJ1dGUoInRoZW1lIikgPT09ICJkYXJrIiA6IFJlZHV4U3RvcmUuZ2V0U3RhdGUoKS5zY3JhdGNoR3VpLnRoZW1lLnRoZW1lLmd1aSA9PT0gImRhcmsiOwogICAgLy8gU2NyYXRjaCBjcmVhdGVzIGEgbmV3IHdvcmtzcGFjZSBmb3IgQ3VzdG9tIEJsb2Nrcywgd2UgbmVlZCB0byBjYXB0dXJlIGl0CiAgICBjb25zdCBuZXdXb3Jrc3BhY2UgPSBTY3JhdGNoQmxvY2tzLm1haW5Xb3Jrc3BhY2U7CiAgICBjb25zdCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYGRpdltjbGFzcz0iUmVhY3RNb2RhbFBvcnRhbCJdYCk7CiAgICBtb2RhbC5xdWVyeVNlbGVjdG9yKGBkaXZbY2xhc3MqPSJtb2RhbF9oZWFkZXItaXRlbS10aXRsZSJdYCkudGV4dENvbnRlbnQgPSAiTWFrZSBhIEJsb2NrKyI7CiAgICBpZiAoIWlzUE0pIG1vZGFsLnF1ZXJ5U2VsZWN0b3IoYGRpdltjbGFzcyo9Im1vZGFsX21vZGFsLW92ZXJsYXlfIl1gKS5zdHlsZS50b3AgPSAiLTI1cHgiOwogICAgZWxzZSB7CiAgICAgIGNvbnN0IG9wdGlvblJvdyA9IG1vZGFsLnF1ZXJ5U2VsZWN0b3JBbGwoYFtjbGFzc149ImN1c3RvbS1wcm9jZWR1cmVzX29wdGlvbnMtcm93XyJdYCk7CiAgICAgIGNvbnN0IHJldHVybkNoZWNrID0gbW9kYWwucXVlcnlTZWxlY3RvckFsbChgaW5wdXRbdHlwZT0iY2hlY2tib3giXWApOwoKICAgICAgY29uc3QgaW5uZXJNb2RhbCA9IG1vZGFsLmZpcnN0Q2hpbGQ7CiAgICAgIGlubmVyTW9kYWwuc3R5bGUub3ZlcmZsb3cgPSAiYXV0byI7CiAgICAgIGxldCBvZ1RvcDsKICAgICAgaW5uZXJNb2RhbC5hZGRFdmVudExpc3RlbmVyKCJzY3JvbGwiLCAoKSA9PiB7CiAgICAgICAgY29uc3QgYWN0aXZlSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBkaXZbY2xhc3NePSJibG9ja2x5V2lkZ2V0RGl2Il1bY2xhc3MqPSJmaWVsZFRleHRJbnB1dCJdYCk7CiAgICAgICAgaWYgKGFjdGl2ZUlucHV0KSB7CiAgICAgICAgICBpZiAoIW9nVG9wKSB7CiAgICAgICAgICAgIGNvbnN0IG1vZGFsUmVjdCA9IGlubmVyTW9kYWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgIGNvbnN0IGlucHV0UmVjdCA9IGFjdGl2ZUlucHV0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICBvZ1RvcCA9IGlucHV0UmVjdC50b3AgLSBtb2RhbFJlY3QudG9wICsgaW5uZXJNb2RhbC5zY3JvbGxUb3A7CiAgICAgICAgICB9CiAgICAgICAgICBhY3RpdmVJbnB1dC5zdHlsZS50b3AgPSBgJHtvZ1RvcCAtIGlubmVyTW9kYWwuc2Nyb2xsVG9wfXB4YDsKICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgbW9kYWwucXVlcnlTZWxlY3RvcihgW2NsYXNzXj0iY3VzdG9tLXByb2NlZHVyZXNfY29sb3ItcGlja2VyLWFyZWFfIl1gKS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICBpZiAob3B0aW9uUm93WzFdKSBvcHRpb25Sb3dbMV0uc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgaWYgKHJldHVybkNoZWNrWzFdKSByZXR1cm5DaGVja1sxXS5wYXJlbnROb2RlLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGUpID0+IHsKICAgICAgICBvcHRpb25Sb3dbMV0uc3R5bGUuZGlzcGxheSA9IGUudGFyZ2V0LmNoZWNrZWQgPyAiIiA6ICJub25lIjsKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCByb3cgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKGBbY2xhc3NePSJjdXN0b20tcHJvY2VkdXJlc19vcHRpb25zLXJvd18iXWApOwogICAgY29uc3QgYmxvY2tFZGl0b3IgPSBuZXdXb3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKG1vZGFsLnF1ZXJ5U2VsZWN0b3IoImdbZGF0YS1pZF0iKS5nZXRBdHRyaWJ1dGUoImRhdGEtaWQiKSk7CiAgICBjb25zdCBjdXJQcm9jID0gYmxvY2tFZGl0b3IucHJvY0NvZGVfOwogICAgdGVtcFN0b3JlID0gc3RydWN0dXJlZENsb25lKHN0b3JlR2V0KGN1clByb2MpKSB8fCB7fTsgLy8gUmVzZXQKICAgIGJsb2NrRWRpdG9yLlNQbWJwQ1NUX3N0b3JlID0gdGVtcFN0b3JlOwoKICAgIGF0dGFjaElucHV0QnRucyhyb3csIGJsb2NrRWRpdG9yLCBpc0RhcmssIHdvcmtzcGFjZSk7CiAgICBhdHRhY2hDb2xvcnMocm93LCBpc0RhcmssIGJsb2NrRWRpdG9yKTsKICAgIGF0dGFjaENoZWNrYm94ZXMobW9kYWwsIGJsb2NrRWRpdG9yLCBpc0VkaXRpbmcsIGN1clByb2MpOwoKICAgIC8vIEF0dGFjaCBPa2F5IEJ1dHRvbiBMaXN0ZW5lcgogICAgY29uc3Qgb2tCdG4gPSBtb2RhbC5xdWVyeVNlbGVjdG9yKGBidXR0b25bY2xhc3NePSJjdXN0b20tcHJvY2VkdXJlc19vay1idXR0b25fIl1gKTsKICAgIG9rQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGUpID0+IHsKICAgICAgLy8gcHJldmVudCBwcm9jY29kZSBjb25mbGljdHMKICAgICAgY29uc3QgcHJvYyA9IGJsb2NrRWRpdG9yLnByb2NDb2RlXzsKICAgICAgbGV0IHByb3RvRXhpc3RzID0gU2NyYXRjaEJsb2Nrcy5Qcm9jZWR1cmVzLmdldFByb3RvdHlwZUJsb2NrKHByb2MsIHdvcmtzcGFjZSk7CiAgICAgIGlmICghcHJvdG9FeGlzdHMpIHsKICAgICAgICByZWZyZXNoR2xvYmFsQmxvY2tzQ2FjaGUoKTsKICAgICAgICBjb25zdCB0aGlzSUQgPSB2bS5lZGl0aW5nVGFyZ2V0LmlkOwogICAgICAgIGZvciAoY29uc3QgdGFyZ2V0IG9mIHJ1bnRpbWUudGFyZ2V0cykgewogICAgICAgICAgcHJvdG9FeGlzdHMgPSB0YXJnZXQuYmxvY2tzLmdldFByb2NlZHVyZURlZmluaXRpb24ocHJvYyk7CiAgICAgICAgICBpZiAocHJvdG9FeGlzdHMpIHsKICAgICAgICAgICAgaWYgKHRoaXNJRCA9PT0gZ2xvYmFsQmxvY2tzQ2FjaGVbcHJvY10/LmlkKSB7CiAgICAgICAgICAgICAgcHJvdG9FeGlzdHMgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaWYgKHRoaXNJRCA9PT0gdGFyZ2V0LmlkICYmIGlzRWRpdGluZykgcHJvdG9FeGlzdHMgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKChwcm90b0V4aXN0cyAmJiAoIWlzRWRpdGluZyB8fCBjdXJQcm9jICE9PSBwcm9jKSkpIHsKICAgICAgICBhbGVydCgiQSBjdXN0b20gYmxvY2sgd2l0aCB0aGlzIHRleHQgYWxyZWFkeSBleGlzdHMhIik7CiAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNsZWFudXBCbG9ja0lucHV0cyh0ZW1wU3RvcmUuaW5wdXRzLCBibG9ja0VkaXRvci5hcmd1bWVudElkc18pOwogICAgICBzdG9yZVNldChibG9ja0VkaXRvci5wcm9jQ29kZV8sIHRlbXBTdG9yZSk7CiAgICAgIGlmIChpc0VkaXRpbmcgJiYgY3VyUHJvYyAhPT0gYmxvY2tFZGl0b3IucHJvY0NvZGVfKSBzdG9yZURlbChjdXJQcm9jKTsKICAgICAgcmVmcmVzaEdsb2JhbEJsb2Nrc0NhY2hlKCk7CgogICAgICBpZiAoaXNQTSkgewogICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJlcnJvciIsIHJldHVyblR5cGVFcnJvciwgeyBvbmNlOiB0cnVlIH0pOwogICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJlcnJvciIsIHJldHVyblR5cGVFcnJvciwgeyBvbmNlOiB0cnVlIH0pOwogICAgICB9CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIGdlbkRycEJ1dHRvbihjb250YWluZXIsIG9wdHMsIGRlZmF1bHRWYWx1ZSwgaXNEYXJrLCBpc0xhYmVsLCBjaGFuZ2VGdW5jLCBzZXRGdW5jKSB7CiAgICBjb25zdCBpbWcgPSBjb250YWluZXIuY2hpbGROb2Rlc1swXSwgYnRuID0gY29udGFpbmVyLmNoaWxkTm9kZXNbMl07CiAgICBpbWcuc3JjID0gZGVmYXVsdFZhbHVlOwogICAgaWYgKGlzTGFiZWwpIGNvbnRhaW5lci5jaGlsZE5vZGVzWzFdLmZpcnN0Q2hpbGQudGV4dENvbnRlbnQgPSAiQWRkIGEgbGFiZWwiOwoKICAgIC8vIHJlcGxhY2UgdGV4dCB3aXRoIGRyb3Bkb3duIGlucHV0CiAgICBsZXQgZHJwZG93biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNlbGVjdCIpOwogICAgZHJwZG93bi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgYCR7aXNMYWJlbCA/ICJ3aWR0aDogMTAwJTsgIiA6ICIifSBib3JkZXItcmFkaXVzOiA1cHg7IHRleHQtYWxpZ246IGNlbnRlcjsgYmFja2dyb3VuZDogJHtpc0RhcmsgPyAiIzFlMWUxZSIgOiAiI2ZmZiJ9OyBib3JkZXI6IDJweCBzb2xpZCB2YXIoLS11aS1ibGFjay10cmFuc3BhcmVudCwgcmdiYSgwLCAwLCAwLCAwLjE1KSk7YCk7CiAgICBmb3IgKGNvbnN0IFt0eHQsIHZhbF0gb2Ygb3B0cykgewogICAgICBsZXQgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgib3B0aW9uIik7CiAgICAgIG9wdC50ZXh0ID0gdHh0OyBvcHQudmFsdWUgPSB2YWw7CiAgICAgIGRycGRvd24uYXBwZW5kQ2hpbGQob3B0KTsKICAgIH07CiAgICBidG4ucmVwbGFjZUNoaWxkKGRycGRvd24sIGJ0bi5xdWVyeVNlbGVjdG9yKCJzcGFuIikpOwoKICAgIC8vIG9uIEZpcmVmb3gsIHRoZSAiY2xpY2siIGV2ZW50IHdpbGwgcHJvcGFnYXRlIHRvIHRoZSBidXR0b24sIHdoaWNoIHdpbGwgYWRkIGFub3RoZXIgaW5wdXQuIGRvbid0IGRvIHRoYXQKICAgIGRycGRvd24uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKSk7CiAgICBkcnBkb3duLmFkZEV2ZW50TGlzdGVuZXIoImNoYW5nZSIsIChlKSA9PiB7CiAgICAgIGNoYW5nZUZ1bmMoZS50YXJnZXQudmFsdWUsIGltZyk7CiAgICAgIGNvbnRhaW5lci5jbGljaygpOwogICAgfSk7CiAgICBjb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSkgPT4gc2V0RnVuYyhlLCBkcnBkb3duKSk7CiAgICByZXR1cm4gY29udGFpbmVyOwogIH0KCiAgZnVuY3Rpb24gYXR0YWNoSW5wdXRCdG5zKHJvdywgZWRpdG9yLCBpc0RhcmssIHdvcmtzcGFjZSkgewogICAgY29uc3Qgb2xkQm9vbFVSTCA9IHJvdy5jaGlsZE5vZGVzWzFdLmNoaWxkTm9kZXNbMF0uc3JjOwogICAgY29uc3Qgb2xkTGFiZWxVUkwgPSByb3cuY2hpbGROb2Rlc1tpc1BNID8gMyA6IDJdLmNoaWxkTm9kZXNbMF0uc3JjOwoKICAgIC8vIGRyb3Bkb3duIGJ0bgogICAgY29uc3QgZHJvcEJ0biA9IHJvdy5jaGlsZE5vZGVzWzFdLmNsb25lTm9kZSh0cnVlKTsKICAgIGRyb3BCdG4uY2hpbGROb2Rlc1swXS5zcmMgPSBndWlVUklzKCJkcm9wZHduIik7CiAgICBkcm9wQnRuLmNoaWxkTm9kZXNbMl0udGV4dENvbnRlbnQgPSAiZHJvcGRvd24iOwogICAgcm93Lmluc2VydEJlZm9yZShkcm9wQnRuLCByb3cuY2hpbGROb2Rlc1syXSk7CiAgICBkcm9wQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gb3Blbk1lbnVTZWxlY3RvcihlZGl0b3IsIGlzRGFyaywgd29ya3NwYWNlKSk7CgogICAgLy8gYnJhbmNoIGJ0bgogICAgY29uc3QgYnJhbmNoQnRuID0gcm93LmNoaWxkTm9kZXNbMV0uY2xvbmVOb2RlKHRydWUpOwogICAgYnJhbmNoQnRuLmNoaWxkTm9kZXNbMF0uc3JjID0gaW5wdXRVUklzKCJicmMiKTsKICAgIGJyYW5jaEJ0bi5jaGlsZE5vZGVzWzJdLnRleHRDb250ZW50ID0gImJyYW5jaCI7CiAgICByb3cuaW5zZXJ0QmVmb3JlKGJyYW5jaEJ0biwgcm93LmNoaWxkTm9kZXNbM10pOwogICAgYnJhbmNoQnRuLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGUpID0+IHsKICAgICAgZWRpdG9yLmFkZFN0cmluZ051bWJlckV4dGVybmFsKCk7CiAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7CgogICAgICBjb25zdCBhcmdzID0gZWRpdG9yLmFyZ3VtZW50SWRzXzsKICAgICAgY29uc3QgaWQgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CiAgICAgIGNvbnN0IGlucHV0cyA9IHRlbXBTdG9yZS5pbnB1dHMgfHwge307CiAgICAgIGlucHV0c1tpZF0gPSB7IHR5cGU6ICJicmMiLCBpc0Ryb3A6IGZhbHNlIH07CiAgICAgIHRlbXBTdG9yZS5pbnB1dHMgPSBpbnB1dHM7CiAgICAgIGNsZWFudXBCbG9ja0lucHV0cyhpbnB1dHMsIGFyZ3MpOwoKICAgICAgZWRpdG9yLmRpc3BsYXlOYW1lc19bYXJncy5sZW5ndGggLSAxXSA9ICJicmFuY2giOwogICAgICBlZGl0b3IudXBkYXRlRGlzcGxheV8oKTsKICAgICAgZWRpdG9yLmZvY3VzTGFzdEVkaXRvcl8oKTsKICAgIH0pOwoKICAgIC8vIGR5bmFtaWMgYnRucwogICAgY29uc3QgbGFiUGF0aHMgPSBbWyJ0ZXh0IiwgInRleHQiXSwgWyJpbWFnZSIsICJpbWciXV07CiAgICBjb25zdCBpbnBQYXRocyA9IFsKICAgICAgWyJudW1iZXIgb3IgdGV4dCIsICJub3JtIl0sIFsibnVtYmVyIiwgIm51bSJdLCBbImJvb2xlYW4iLCAiYm9vbCJdLCBbImFuZ2xlIiwgImFuZyJdLAogICAgICBbImNvbG9yIiwgImNvbCJdLCBbInBpYW5vIiwgIm5vdGUiXSwgWyJtYXRyaXgiLCAibWF0Il0sIFsiZW1wdHkiLCAiZW1wIl0KICAgIF07CgogICAgY29uc3QgdGVtcEJ0biA9IHJvdy5jaGlsZE5vZGVzWzFdOwogICAgcm93LnJlcGxhY2VDaGlsZChnZW5EcnBCdXR0b24oCiAgICAgIHRlbXBCdG4uY2xvbmVOb2RlKHRydWUpLCBpbnBQYXRocywgaW5wdXRVUklzKCJub3JtIiksIGlzRGFyaywgZmFsc2UsCiAgICAgICh2YWx1ZSwgaW1nKSA9PiB7CiAgICAgICAgaW1nLnNyYyA9IHZhbHVlID09PSAiYm9vbCIgPyBvbGRCb29sVVJMIDogaW5wdXRVUklzKHZhbHVlKTsKICAgICAgfSwKICAgICAgKGUsIGRycGRvd24pID0+IHsKICAgICAgICBpZiAoZS50YXJnZXQgPT09IGRycGRvd24pIHJldHVybjsKICAgICAgICBpZiAoZHJwZG93bi52YWx1ZSA9PT0gImJvb2wiKSB7CiAgICAgICAgICBlZGl0b3IuYWRkQm9vbGVhbkV4dGVybmFsKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGVkaXRvci5hZGRTdHJpbmdOdW1iZXJFeHRlcm5hbCgpOwogICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7IC8vIGRvbid0IHJ1biB0aGUgb2xkIGFkZCBldmVudAogICAgICAgIGlmIChkcnBkb3duLnZhbHVlID09PSAibm9ybSIpIHJldHVybjsKCiAgICAgICAgY29uc3QgYXJncyA9IGVkaXRvci5hcmd1bWVudElkc187CiAgICAgICAgY29uc3QgaWQgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CiAgICAgICAgY29uc3QgaW5wdXRzID0gdGVtcFN0b3JlLmlucHV0cyB8fCB7fTsKICAgICAgICBpbnB1dHNbaWRdID0geyB0eXBlOiBkcnBkb3duLnZhbHVlLCBpc0Ryb3A6IGZhbHNlIH07CiAgICAgICAgdGVtcFN0b3JlLmlucHV0cyA9IGlucHV0czsKICAgICAgICBjbGVhbnVwQmxvY2tJbnB1dHMoaW5wdXRzLCBhcmdzKTsKCiAgICAgICAgZWRpdG9yLmRpc3BsYXlOYW1lc19bYXJncy5sZW5ndGggLSAxXSA9IGRycGRvd24uc2VsZWN0ZWRPcHRpb25zWzBdLnRleHRDb250ZW50OwogICAgICAgIGVkaXRvci51cGRhdGVEaXNwbGF5XygpOwogICAgICAgIGVkaXRvci5mb2N1c0xhc3RFZGl0b3JfKCk7CiAgICAgIH0KICAgICksIHJvdy5jaGlsZE5vZGVzWzBdKTsKICAgIHJvdy5yZXBsYWNlQ2hpbGQoZ2VuRHJwQnV0dG9uKAogICAgICB0ZW1wQnRuLmNsb25lTm9kZSh0cnVlKSwgbGFiUGF0aHMsIG9sZExhYmVsVVJMLCBpc0RhcmssIHRydWUsCiAgICAgICh2YWx1ZSwgaW1nKSA9PiB7CiAgICAgICAgaW1nLnNyYyA9IHZhbHVlID09PSAidGV4dCIgPyBvbGRMYWJlbFVSTCA6IGlucHV0VVJJcyh2YWx1ZSk7CiAgICAgIH0sCiAgICAgIChlLCBkcnBkb3duKSA9PiB7CiAgICAgICAgaWYgKGUudGFyZ2V0ID09PSBkcnBkb3duKSByZXR1cm47CiAgICAgICAgaWYgKGRycGRvd24udmFsdWUgPT09ICJ0ZXh0IikgZWRpdG9yLmFkZExhYmVsRXh0ZXJuYWwoKTsKICAgICAgICBlbHNlIG9wZW5JbWdTZWxlY3RvcihlZGl0b3IsIGlzRGFyaywgd29ya3NwYWNlKTsKICAgICAgfQogICAgKSwgcm93LmNoaWxkTm9kZXNbaXNQTSA/IDUgOiA0XSk7CiAgICByb3cuY2hpbGROb2Rlc1sxXS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogIH0KCiAgZnVuY3Rpb24gYXR0YWNoQ2hlY2tib3hlcyhtb2RhbCwgZWRpdG9yLCBpc0VkaXRpbmcsIG9nUHJvY29kZSkgewogICAgY29uc3QgY2hlY2tSb3cgPSBpc1BNID8gbW9kYWwucXVlcnlTZWxlY3RvcihgZGl2W2NsYXNzXj0iY3VzdG9tLXByb2NlZHVyZXNfYnV0dG9uLXJvd18iXWApLnByZXZpb3VzU2libGluZwogICAgICA6IG1vZGFsLnF1ZXJ5U2VsZWN0b3IoYFtjbGFzc149ImN1c3RvbS1wcm9jZWR1cmVzX2NoZWNrYm94LXJvdyJdYCk7CiAgICBjb25zdCBtYWtlQm94ID0gKHR4dCwgdmFsLCBmdW5jKSA9PiB7CiAgICAgIGNvbnN0IGJveCA9IGNoZWNrUm93LmZpcnN0Q2hpbGQuY2xvbmVOb2RlKHRydWUpOwogICAgICBib3guY2hpbGROb2Rlc1sxXS50ZXh0Q29udGVudCA9IHR4dDsKICAgICAgYm94LmNoaWxkTm9kZXNbMF0uY2hlY2tlZCA9IHZhbDsKICAgICAgYm94LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gZnVuYyhib3guY2hpbGROb2Rlc1swXS5jaGVja2VkKSk7CiAgICAgIHJldHVybiBib3g7CiAgICB9OwogICAgaWYgKGlzRWRpdGluZyAmJiBpc1BNKSB7CiAgICAgIGNvbnN0IGlzUmV0dXJuZXIgPSBlZGl0b3IuZ2V0UmV0dXJucygpOwogICAgICBjb25zdCByZXR1cm5UeXBlID0gbWFrZUJveCgKICAgICAgICAiQm9vbGVhbiIsIGVkaXRvci5vdXRwdXRUeXBlID09PSAiYm9vbGVhbiIsCiAgICAgICAgKHZhbCkgPT4geyBlZGl0b3Iuc2V0VHlwZSh2YWwgPyAiYm9vbGVhbiIgOiAic3RyaW5nIikgfQogICAgICApOwogICAgICByZXR1cm5UeXBlLnN0eWxlLmRpc3BsYXkgPSBpc1JldHVybmVyID8gIiIgOiAibm9uZSI7CiAgICAgIHJldHVyblR5cGUuc3R5bGUubWFyZ2luTGVmdCA9ICI1cHgiOwogICAgICBjb25zdCByZXR1cm5DaGVjayA9IG1ha2VCb3goCiAgICAgICAgIlJldHVybnMgYSB2YWx1ZSIsIGlzUmV0dXJuZXIsCiAgICAgICAgKHZhbCkgPT4gewogICAgICAgICAgZWRpdG9yLnNldFJldHVybnModmFsKTsKICAgICAgICAgIGlmICh2YWwpIHsKICAgICAgICAgICAgZWRpdG9yLnNldFR5cGUoInN0cmluZyIpOwogICAgICAgICAgICByZXR1cm5UeXBlLmNoaWxkTm9kZXNbMF0uY2hlY2tlZCA9IGZhbHNlOwogICAgICAgICAgICByZXR1cm5UeXBlLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVkaXRvci5zZXRUeXBlKCJzdGF0ZW1lbnQiKTsKICAgICAgICAgICAgcmV0dXJuVHlwZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgKTsKICAgICAgY2hlY2tSb3cuYXBwZW5kKHJldHVybkNoZWNrLCByZXR1cm5UeXBlKTsKICAgIH0KICAgIGNoZWNrUm93LmFwcGVuZChpc1BNICYmICFpc0VkaXRpbmcgPyAiIiA6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJyIiksIG1ha2VCb3goCiAgICAgICJDYXAgYmxvY2siLCB0ZW1wU3RvcmUuaXNUZXJtaW5hbCAhPT0gdW5kZWZpbmVkID8gdGVtcFN0b3JlLmlzVGVybWluYWwgOiBmYWxzZSwKICAgICAgKHZhbCkgPT4gewogICAgICAgIGVkaXRvci5zZXROZXh0U3RhdGVtZW50KCF2YWwpOwogICAgICAgIHRlbXBTdG9yZS5pc1Rlcm1pbmFsID0gdmFsOwogICAgICB9CiAgICApKTsKICAgIGNoZWNrUm93LmFwcGVuZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJiciIpLCBtYWtlQm94KAogICAgICAiQXZhaWxhYmxlIGZvciBhbGwgc3ByaXRlcyIsIHRlbXBTdG9yZS5nbG9iYWwgIT09IHVuZGVmaW5lZCA/IHRlbXBTdG9yZS5nbG9iYWwgOiBmYWxzZSwKICAgICAgKHZhbCkgPT4geyB0ZW1wU3RvcmUuZ2xvYmFsID0gdmFsIH0KICAgICkpOwogIH0KCiAgZnVuY3Rpb24gYXR0YWNoQ29sb3JzKHJvdywgaXNEYXJrLCBlZGl0b3IpIHsKICAgIGNvbnN0IGNvbG9yVXRpbCA9IFNjcmF0Y2hCbG9ja3MuZ29vZy5jb2xvcjsKICAgIGNvbnN0IGJvdW5jZUFuaW0gPSAoY2lyYykgPT4gewogICAgICBjaXJjLmFuaW1hdGUoCiAgICAgICAgW3sgdHJhbnNmb3JtOiAic2NhbGUoMC43NSkiIH0sIHsgdHJhbnNmb3JtOiAic2NhbGUoMSkiIH1dLCB7IGR1cmF0aW9uOiAyMDAsIGVhc2luZzogImVhc2UtaW4tb3V0IiB9CiAgICAgICk7CiAgICB9OwogICAgY29uc3Qgc2V0Q29sID0gKGNvbCkgPT4gewogICAgICB0ZW1wU3RvcmUuY29sb3IgPSBjb2w7CiAgICAgIGNvbnN0IHJnYiA9IGNvbG9yVXRpbC5oZXhUb1JnYihjb2wpOwogICAgICBpZiAoaXNQTSkgewogICAgICAgIGVkaXRvci5zZXRDb2xvcigKICAgICAgICAgIGNvbCwKICAgICAgICAgIGNvbG9yVXRpbC5yZ2JBcnJheVRvSGV4KGNvbG9yVXRpbC5kYXJrZW4ocmdiLCAwLjEpKSwKICAgICAgICAgIGNvbG9yVXRpbC5yZ2JBcnJheVRvSGV4KGNvbG9yVXRpbC5kYXJrZW4ocmdiLCAwLjIpKQogICAgICAgICk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWRpdG9yLnNldENvbG91ciguLi50aGVtZWlmeUNvbG9yKGNvbCkpOwogICAgICAgIGVkaXRvci51cGRhdGVEaXNwbGF5XygpOwogICAgICB9CiAgICB9OwoKICAgIGNvbnN0IGNvbG9yRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBjb2xvckRpdi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyOyBtYXJnaW4tdG9wOiAxNXB4OyBib3JkZXItcmFkaXVzOiAxMHB4OyIpOwogICAgaWYgKGlzUE0pIGNvbG9yRGl2LnN0eWxlLm1hcmdpbkJvdHRvbSA9ICIxNXB4IjsKICAgIGNvbG9yRGl2LnN0eWxlLmJvcmRlciA9IGBzb2xpZCAke2lzRGFyayA/ICIjMzQzNDM0IiA6ICIjRDlEOUQ5In0gMi41cHhgOwoKICAgIGNvbnN0IGNvbG9yTGlzdCA9IGlzUE0gPyBTY3JhdGNoQmxvY2tzLkNvbG91cnMgOiBSZWR1eFN0b3JlLmdldFN0YXRlKCkuc2NyYXRjaEd1aS50aGVtZS50aGVtZS5nZXRTdGFnZUJsb2NrQ29sb3JzKCk7CiAgICBjb25zdCBjb2xvcnMgPSBbCiAgICAgIGNvbG9yTGlzdC5tb3Rpb24ucHJpbWFyeSwgY29sb3JMaXN0Lmxvb2tzLnByaW1hcnksIGNvbG9yTGlzdC5zb3VuZHMucHJpbWFyeSwKICAgICAgY29sb3JMaXN0LmV2ZW50LnByaW1hcnksIGNvbG9yTGlzdC5jb250cm9sLnByaW1hcnksIGNvbG9yTGlzdC5zZW5zaW5nLnByaW1hcnksCiAgICAgIGNvbG9yTGlzdC5vcGVyYXRvcnMucHJpbWFyeSwgY29sb3JMaXN0LmRhdGEucHJpbWFyeSwgY29sb3JMaXN0LmRhdGFfbGlzdHMucHJpbWFyeSwKICAgICAgY29sb3JMaXN0Lm1vcmUucHJpbWFyeSwgY29sb3JMaXN0LnBlbi5wcmltYXJ5LCAicmVkIiwKICAgIF07CiAgICBjb2xvcnMuZm9yRWFjaChjb2xvciA9PiB7CiAgICAgIGNvbnN0IGNpcmNsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJ3aWR0aDogMzVweDsgaGVpZ2h0OiAzNXB4OyBib3JkZXItcmFkaXVzOiA1MCU7IGJvcmRlcjogMi41cHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjEzKTsgbWFyZ2luOiA3cHg7IGN1cnNvcjogcG9pbnRlcjsiKTsKICAgICAgY2lyY2xlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yOwogICAgICBjaXJjbGUuc3R5bGUuYm94U2hhZG93ID0gYDBweCAwcHggMHB4IDIuNXB4ICR7aXNEYXJrID8gIiMzNDM0MzQiIDogIiNEOUQ5RDkifWA7CiAgICAgIGNvbG9yRGl2LmFwcGVuZENoaWxkKGNpcmNsZSk7CiAgICAgIGlmIChjb2xvciA9PT0gInJlZCIpIHsKICAgICAgICBjb25zdCBpbm5lckltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgIGlubmVySW1nLnNyYyA9IGd1aVVSSXMoImNvbG9yUGtyIik7CiAgICAgICAgaW5uZXJJbWcuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJ3aWR0aDogMjVweDsgaGVpZ2h0OiAyNXB4OyBwb3NpdGlvbjogcmVsYXRpdmU7IHBhZGRpbmc6IDJweDsgbGVmdDogNTAlOyB0b3A6IDUwJTsgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7Iik7CiAgICAgICAgY2lyY2xlLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgYm91bmNlQW5pbShjaXJjbGUpOwogICAgICAgICAgY29sSW5wLmNsaWNrKCk7CiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IGNvbElucCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7CiAgICAgICAgY29sSW5wLnR5cGUgPSAiY29sb3IiOwogICAgICAgIGNvbElucC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIm9wYWNpdHk6IDA7IGN1cnNvcjogcG9pbnRlcjsgd2lkdGg6IDFweDsgaGVpZ2h0OiAxcHg7IHRyYW5zZm9ybTogdHJhbnNsYXRlKDE1cHgsIC0yNXB4KTsiKTsKICAgICAgICBjaXJjbGUuYXBwZW5kKGlubmVySW1nLCBjb2xJbnApOwogICAgICAgIGNvbElucC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsICgpID0+IHsKICAgICAgICAgIGNpcmNsZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xJbnAudmFsdWU7CiAgICAgICAgICBzZXRDb2woY29sSW5wLnZhbHVlKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjaXJjbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICAgICAgICBib3VuY2VBbmltKGNpcmNsZSk7CiAgICAgICAgICBzZXRDb2woY29sb3IpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9KTsKICAgIGlmICghdGVtcFN0b3JlLmNvbG9yKSBzZXRDb2woY29sb3JzWzldKTsKICAgIHJvdy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShjb2xvckRpdiwgcm93LnBhcmVudE5vZGUubGFzdENoaWxkLnByZXZpb3VzU2libGluZyk7CiAgfQoKICAvLyBDdXN0b20gTWluaSBNb2RhbHMKICBmdW5jdGlvbiBvcGVuTW9kYWwodGl0bGVOYW1lLCB3b3JrZXJGbiwgY2FsbGJhY2tGbikgewogICAgY29uc3QgbW9kYWxTdG9yYWdlID0ge307CiAgICBTY3JhdGNoQmxvY2tzLnByb21wdCgKICAgICAgIiIsICIiLCAoKSA9PiBjYWxsYmFja0ZuKG1vZGFsU3RvcmFnZS52YWx1ZSksCiAgICAgIHRpdGxlTmFtZSwgImJyb2FkY2FzdF9tc2ciCiAgICApOwoKICAgIGxldCBtb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoYGRpdltjbGFzcz0iUmVhY3RNb2RhbFBvcnRhbCJdYCk7CiAgICBtb2RhbCA9IG1vZGFsW21vZGFsLmxlbmd0aCAtIDFdOwogICAgbW9kYWwuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOyBtb2RhbC5zdHlsZS56SW5kZXggPSAiOTk5OTkiOwogICAgY29uc3QgYm94TW9kYWwgPSBtb2RhbC5xdWVyeVNlbGVjdG9yKCJpbnB1dCIpLnBhcmVudE5vZGU7CiAgICBib3hNb2RhbC5wcmV2aW91c1NpYmxpbmcucmVtb3ZlKCk7IGJveE1vZGFsLmZpcnN0Q2hpbGQucmVtb3ZlKCk7CiAgICB3b3JrZXJGbihib3hNb2RhbCwgbW9kYWxTdG9yYWdlKTsKICB9CgogIGZ1bmN0aW9uIG9wZW5NZW51U2VsZWN0b3IoZWRpdG9yLCBpc0RhcmssIG9nV29ya3NwYWNlKSB7CiAgICBjb25zdCBhcnJvd0ljb24gPSBpc1BNID8gInN0YXRpYy9ibG9ja3MtbWVkaWEvZHJvcGRvd24tYXJyb3ciIDogIi9zdGF0aWMvYmxvY2tzLW1lZGlhL2RlZmF1bHQvZHJvcGRvd24tYXJyb3ciOwoKICAgIC8vIEdldCBBbGwgRHJvcGRvd25zCiAgICBjb25zdCBhdm9pZCA9IFsibG9va3NfY29zdHVtZW51bWJlcm5hbWUiLCAiZXh0ZW5zaW9uX3dlZG9fdGlsdF9tZW51IiwgImxtc01vcmVFdmVudHNfbWVudV9zdGF0ZSJdOwogICAgbGV0IGFsbEJsb2NrcyA9IE9iamVjdC5rZXlzKFNjcmF0Y2hCbG9ja3MuQmxvY2tzKTsKICAgIGFsbEJsb2NrcyA9IGFsbEJsb2Nrcy5maWx0ZXIoKGkpID0+IGkuaW5jbHVkZXMoIm1lbnUiKSAmJiAhYXZvaWQuaW5jbHVkZXMoaSkpOwogICAgYWxsQmxvY2tzLnVuc2hpZnQoImxvb2tzX2Nvc3R1bWUiLCAibG9va3NfYmFja2Ryb3BzIiwgInNlbnNpbmdfa2V5b3B0aW9ucyIpOwogICAgYWxsQmxvY2tzLmZvckVhY2goKGUsIGkpID0+IHsKICAgICAgaWYgKGUuc3RhcnRzV2l0aChDVVNUT01fTUVOVV9JRCkpIHsKICAgICAgICBhbGxCbG9ja3MudW5zaGlmdChlKTsKICAgICAgICBhbGxCbG9ja3Muc3BsaWNlKGkgKyAxLCAxKTsKICAgICAgfQogICAgfSk7CgogICAgb3Blbk1vZGFsKAogICAgICAiU2VsZWN0IGEgRHJvcGRvd24iLAogICAgICAobW9kYWwsIG1vZGFsU3RvcmFnZSkgPT4gewogICAgICAgIG1vZGFsU3RvcmFnZS52YWx1ZSA9IGFsbEJsb2Nrc1swXTsKICAgICAgICBjb25zdCBkcm9wRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgZHJvcERpdi5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgYHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDIwMHB4OyBtYXJnaW4tYm90dG9tOiAxNXB4OyBvdmVyZmxvdzogc2Nyb2xsOyBib3JkZXI6IHNvbGlkICR7aXNEYXJrID8gIiMzNDM0MzQiIDogIiNEOUQ5RDkifSAycHg7IGJvcmRlci1yYWRpdXM6IDEwcHg7YCk7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhbGxCbG9ja3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGRyb3BJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksIHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgcHJldiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgZHJvcEl0ZW0uc2V0QXR0cmlidXRlKCJzdHlsZSIsIGBjdXJzb3I6IHBvaW50ZXI7IHBhZGRpbmc6IDhweDsgd2lkdGg6IDEwMCU7IGhlaWdodDogbWF4LWNvbnRlbnQ7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGFsaWduLWl0ZW1zOiBjZW50ZXI7IGp1c3RpZnktY29udGVudDogY2VudGVyO2ApOwogICAgICAgICAgZHJvcEl0ZW0uYXBwZW5kKHByZXYsIHRleHQpOwogICAgICAgICAgdGV4dC50ZXh0Q29udGVudCA9IGFsbEJsb2Nrc1tpXS5yZXBsYWNlKENVU1RPTV9NRU5VX0lELCAiIik7CgogICAgICAgICAgY29uc3QgaXNDdXN0b20gPSBhbGxCbG9ja3NbaV0uaW5jbHVkZXMoQ1VTVE9NX01FTlVfSUQpOwogICAgICAgICAgY29uc3QgYmxvY2sgPSBvZ1dvcmtzcGFjZS5nZXRCbG9ja0J5SWQoYWxsQmxvY2tzW2ldKTsKICAgICAgICAgIGxldCBwcmV2VHh0ID0gYmxvY2sgPyBibG9jay5pbnB1dExpc3RbMF0uZmllbGRSb3dbMF0udGV4dF8uc3Vic3RyaW5nKDAsIDE3KSA6ICIiOwogICAgICAgICAgaWYgKHByZXZUeHQubGVuZ3RoID09PSAxNykgcHJldlR4dCArPSAiLi4uIjsKICAgICAgICAgIHByZXYub3V0ZXJIVE1MID0gYAogICAgICAgICAgICA8ZGl2IHN0eWxlPSJjb2xvcjogI2ZmZjsgYmFja2dyb3VuZDogJHtpc0N1c3RvbSA/ICIjRkY2NjgwIiA6IGJsb2NrID8gYmxvY2suY29sb3VyXyA6ICIjNTA1MDUwIn07IGJvcmRlci1yYWRpdXM6ICR7YmxvY2sgPyA1MCA6IDV9cHg7IHdpZHRoOiBtYXgtY29udGVudDsgdGV4dC1hbGlnbjogY2VudGVyOyBtYXJnaW4tYm90dG9tOiA1cHg7IHBhZGRpbmc6IDVweCAxMHB4IDVweCAxMHB4OyBmb250LXdlaWdodDogNTAwOyBib3JkZXI6IHNvbGlkIDFweCByZ2JhKDAsMCwwLDAuMykiPgogICAgICAgICAgICAgIDxzcGFuPiR7YmxvY2sgPyBwcmV2VHh0IDogIj8/PyJ9PC9zcGFuPjxpbWcgc3R5bGU9Im1hcmdpbi1sZWZ0OiA1cHg7IiBzcmM9IiR7YXJyb3dJY29ufS5zdmciPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIGA7CgogICAgICAgICAgY29uc3QgYmdDb2xvciA9IGkgJSAyID09PSAwID8gaXNDdXN0b20gPyAiI2NjNTI2NjQwIiA6ICIjYWFhMyIgOiBpc0N1c3RvbSA/ICIjY2M1MjY2ODAiIDogInRyYW5zcGFyZW50IjsKICAgICAgICAgIGRyb3BJdGVtLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGB2YXIoLS1zZWxlY3RlZC1jb2xvciwgJHtiZ0NvbG9yfSlgOwogICAgICAgICAgaWYgKGkgPT09IDApIGRyb3BJdGVtLnN0eWxlLnNldFByb3BlcnR5KCItLXNlbGVjdGVkLWNvbG9yIiwgaXNDdXN0b20gPyAiI2Y3ODg5YTk5IiA6ICIjYWFhYSIpOwogICAgICAgICAgZHJvcERpdi5hcHBlbmRDaGlsZChkcm9wSXRlbSk7CiAgICAgICAgICBkcm9wSXRlbS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgICAgICAgICAgQXJyYXkuZnJvbShkcm9wRGl2LmNoaWxkcmVuKS5mb3JFYWNoKGMgPT4gYy5zdHlsZS5yZW1vdmVQcm9wZXJ0eSgiLS1zZWxlY3RlZC1jb2xvciIpKTsKICAgICAgICAgICAgZHJvcEl0ZW0uc3R5bGUuc2V0UHJvcGVydHkoIi0tc2VsZWN0ZWQtY29sb3IiLCBpc0N1c3RvbSA/ICIjZjc4ODlhOTkiIDogIiNhYWFhIik7CiAgICAgICAgICAgIG1vZGFsU3RvcmFnZS52YWx1ZSA9IGFsbEJsb2Nrc1tpXTsKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBtb2RhbC5pbnNlcnRCZWZvcmUoZHJvcERpdiwgbW9kYWwubGFzdENoaWxkKTsKICAgICAgfSwKICAgICAgKHZhbHVlKSA9PiB7CiAgICAgICAgZWRpdG9yLmFkZFN0cmluZ051bWJlckV4dGVybmFsKCk7CiAgICAgICAgY29uc3QgYXJncyA9IGVkaXRvci5hcmd1bWVudElkc187CiAgICAgICAgY29uc3QgaWQgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CiAgICAgICAgZWRpdG9yLmRpc3BsYXlOYW1lc19bYXJncy5sZW5ndGggLSAxXSA9IHZhbHVlLnJlcGxhY2UoQ1VTVE9NX01FTlVfSUQsICIiKTsKICAgICAgICBlZGl0b3IudXBkYXRlRGlzcGxheV8oKTsKICAgICAgICBlZGl0b3IuZm9jdXNMYXN0RWRpdG9yXygpOwoKICAgICAgICBjb25zdCBpbnB1dHMgPSB0ZW1wU3RvcmUuaW5wdXRzIHx8IHt9OwogICAgICAgIGlucHV0c1tpZF0gPSB7IHR5cGU6IHZhbHVlLCBpc0Ryb3A6IHRydWUgfTsKICAgICAgICB0ZW1wU3RvcmUuaW5wdXRzID0gaW5wdXRzOwogICAgICAgIGNsZWFudXBCbG9ja0lucHV0cyhpbnB1dHMsIGFyZ3MpOwogICAgICB9CiAgICApOwogIH0KCiAgLy8gSW1hZ2UgTW9kYWwKICBmdW5jdGlvbiBvcGVuSW1nU2VsZWN0b3IoZWRpdG9yLCBpc0RhcmssIG9nV29ya3NwYWNlKSB7CiAgICAvLyBHZXQgQWxsIEltYWdlcwogICAgY29uc3QgaW1hZ2VzID0gbmV3IFNldCgpOwogICAgY29uc3QgZXh0cmFjdEltYWdlID0gKGJsb2NrKSA9PiB7CiAgICAgIGlmICghYmxvY2suaW5pdCkgcmV0dXJuOwogICAgICBsZXQganNvbiA9IHt9OwogICAgICBjb25zdCBqc29uSW5pdCA9IChqc29uMCkgPT4geyBqc29uID0ganNvbjA7IH07CiAgICAgIHRyeSB7CiAgICAgICAgYmxvY2suaW5pdC5jYWxsKHsganNvbkluaXQgfSk7CiAgICAgIH0gY2F0Y2ggeyByZXR1cm4gfQoKICAgICAgZm9yIChjb25zdCBrZXkgaW4ganNvbikgewogICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aCgiYXJncyIpKSBmb3IgKGNvbnN0IGFyZyBvZiBqc29uW2tleV0pIHsKICAgICAgICAgIGlmIChhcmcudHlwZSA9PT0gImZpZWxkX2ltYWdlIiAmJiBhcmcuc3JjKSBpbWFnZXMuYWRkKGFyZy5zcmMpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIE9iamVjdC52YWx1ZXMoU2NyYXRjaEJsb2Nrcy5CbG9ja3MpLmZvckVhY2goZXh0cmFjdEltYWdlKTsKCiAgICBjb25zdCBzZWxlY3RCdG4gPSAoZHJvcERpdiwgYnRuKSA9PiB7CiAgICAgIEFycmF5LmZyb20oZHJvcERpdi5jaGlsZHJlbikuZm9yRWFjaChjID0+IHsKICAgICAgICBjLnN0eWxlLmJhY2tncm91bmRDb2xvciA9ICJ2YXIoLS1kZWZhdWx0LWJnKSI7CiAgICAgICAgYy5zdHlsZS5ib3JkZXIgPSAic29saWQgdmFyKC0tZGVmYXVsdC1ib3JkZXIpIDJweCI7CiAgICAgIH0pOwogICAgICBidG4uc3R5bGUuYmFja2dyb3VuZENvbG9yID0gInZhcigtLWxvb2tzLXRyYW5zcGFyZW50LCBoc2xhKDE5NCwgMTAwJSwgNTAlLCAwLjM1KSkiOwogICAgICBidG4uc3R5bGUuYm9yZGVyID0gInNvbGlkIHZhcigtLWxvb2tzLXNlY29uZGFyeSwgaHNsKDE5NCwgMTAwJSwgNTAlKSkgMnB4IjsKICAgIH07CgogICAgb3Blbk1vZGFsKAogICAgICAiU2VsZWN0IGFuIEltYWdlIiwKICAgICAgKG1vZGFsLCBtb2RhbFN0b3JhZ2UpID0+IHsKICAgICAgICBjb25zdCBmbGV4Q29uc3QgPSAiZGlzcGxheTogZmxleDsgZmxleC13cmFwOiB3cmFwOyBhbGlnbi1pdGVtczogY2VudGVyOyBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsiOwogICAgICAgIGNvbnN0IGJvcmRlckNvbnN0ID0gYGJvcmRlcjogc29saWQgdmFyKC0tZGVmYXVsdC1ib3JkZXIpIDJweDsgYm9yZGVyLXJhZGl1czogMTBweDtgOwogICAgICAgIGNvbnN0IGl0ZW1DU1MgPSBgY3Vyc29yOiBwb2ludGVyOyB3aWR0aDogNzVweDsgaGVpZ2h0OiA3NXB4OyAke2ZsZXhDb25zdH0gcGFkZGluZzogNXB4OyBiYWNrZ3JvdW5kLWNvbG9yOiB2YXIoLS1kZWZhdWx0LWJnKTsgbWFyZ2luOiA3cHg7ICR7Ym9yZGVyQ29uc3R9IC0tZGVmYXVsdC1ib3JkZXI6ICR7aXNEYXJrID8gIiMzNDM0MzQiIDogIiNEOUQ5RDkifTsgLS1kZWZhdWx0LWJnOiAke2lzRGFyayA/ICIjMWYxZjFmIiA6ICIjZjVmNWY1In07YDsKCiAgICAgICAgY29uc3QgZHJvcERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgIGRyb3BEaXYuc2V0QXR0cmlidXRlKCJzdHlsZSIsIGB3aWR0aDogMTAwJTsgaGVpZ2h0OiAyMDBweDsgJHtmbGV4Q29uc3R9IG92ZXJmbG93OiBoaWRkZW4gc2Nyb2xsOyBtYXJnaW4tYm90dG9tOiAxNXB4OyAke2JvcmRlckNvbnN0fSAtLWRlZmF1bHQtYm9yZGVyOiAke2lzRGFyayA/ICIjMzQzNDM0IiA6ICIjRDlEOUQ5In07YCk7CgogICAgICAgIGNvbnN0IGRyb3BJdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgZHJvcEl0ZW0uc2V0QXR0cmlidXRlKCJzdHlsZSIsIGl0ZW1DU1MpOwogICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgIGltZy5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgIndpZHRoOiA3NSU7IGhlaWdodDogNzUlOyIpOwogICAgICAgIGltZy5zcmMgPSBndWlVUklzKCJhZGRJbWciKTsKICAgICAgICAKICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgdGV4dC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgInRleHQtd3JhcDogbm93cmFwOyBmb250LXNpemU6IDYwJTsiKTsKICAgICAgICB0ZXh0LnRleHRDb250ZW50ID0gIkN1c3RvbSBJbWFnZSI7CiAgICAgICAgZHJvcEl0ZW0uYXBwZW5kKGltZywgdGV4dCk7CgogICAgICAgIGRyb3BEaXYuYXBwZW5kQ2hpbGQoZHJvcEl0ZW0pOwogICAgICAgIGRyb3BJdGVtLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgY29uc3Qgc3JjID0gcHJvbXB0KCJFbnRlciB0aGUgVVJMIG9yIERhdGEuVVJJIG9mIHlvdXIgaW1hZ2U6Iik7CiAgICAgICAgICBpZiAoc3JjKSB7CiAgICAgICAgICAgIG1vZGFsU3RvcmFnZS52YWx1ZSA9IHNyYzsKICAgICAgICAgICAgc2VsZWN0QnRuKGRyb3BEaXYsIGRyb3BJdGVtKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgaW1hZ2VzLmZvckVhY2goKGltYWdlLCBpLCBkKSA9PiB7CiAgICAgICAgICBjb25zdCBkcm9wSXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgZHJvcEl0ZW0uc2V0QXR0cmlidXRlKCJzdHlsZSIsIGl0ZW1DU1MpOwogICAgICAgICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7CiAgICAgICAgICBpbWcuc2V0QXR0cmlidXRlKCJzdHlsZSIsICJ3aWR0aDogMTAwJTsgaGVpZ2h0OiAxMDAlOyIpOwogICAgICAgICAgaW1nLnNyYyA9IGltYWdlOwogICAgICAgICAgZHJvcEl0ZW0uYXBwZW5kQ2hpbGQoaW1nKTsKCiAgICAgICAgICBkcm9wRGl2LmFwcGVuZENoaWxkKGRyb3BJdGVtKTsKICAgICAgICAgIGRyb3BJdGVtLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gewogICAgICAgICAgICBzZWxlY3RCdG4oZHJvcERpdiwgZHJvcEl0ZW0pOwogICAgICAgICAgICBtb2RhbFN0b3JhZ2UudmFsdWUgPSBpbWFnZTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIG1vZGFsLmluc2VydEJlZm9yZShkcm9wRGl2LCBtb2RhbC5sYXN0Q2hpbGQpOwogICAgICB9LAogICAgICAodmFsdWUpID0+IHsKICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm47CiAgICAgICAgZWRpdG9yLmFkZFN0cmluZ051bWJlckV4dGVybmFsKCk7CiAgICAgICAgY29uc3QgYXJncyA9IGVkaXRvci5hcmd1bWVudElkc187CiAgICAgICAgY29uc3QgaWQgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07CiAgICAgICAgZWRpdG9yLmRpc3BsYXlOYW1lc19bYXJncy5sZW5ndGggLSAxXSA9ICJpbWFnZSI7CiAgICAgICAgZWRpdG9yLnVwZGF0ZURpc3BsYXlfKCk7CiAgICAgICAgZWRpdG9yLmZvY3VzTGFzdEVkaXRvcl8oKTsKCiAgICAgICAgY29uc3QgaW5wdXRzID0gdGVtcFN0b3JlLmlucHV0cyB8fCB7fTsKICAgICAgICBpbnB1dHNbaWRdID0geyB0eXBlOiAiaW1nIiwgaXNEcm9wOiBmYWxzZSwgc3JjOiBzdG9yZUltYWdlKHZhbHVlKSB9OwogICAgICAgIHRlbXBTdG9yZS5pbnB1dHMgPSBpbnB1dHM7CiAgICAgICAgY2xlYW51cEJsb2NrSW5wdXRzKGlucHV0cywgYXJncyk7CiAgICAgIH0KICAgICk7CiAgfQoKICAvLyBDb21waWxlciBQYXRjaGVzCiAgZnVuY3Rpb24gZ2V0RXhwb3J0cygpIHsKICAgIGlmICh2bS5leHBvcnRzLmlfd2lsbF9ub3RfYXNrX2Zvcl9oZWxwX3doZW5fdGhlc2VfYnJlYWspIHJldHVybiB2bS5leHBvcnRzLmlfd2lsbF9ub3RfYXNrX2Zvcl9oZWxwX3doZW5fdGhlc2VfYnJlYWsoKTsKICAgIGVsc2UgaWYgKHZtLmV4cG9ydHMuSlNHZW5lcmF0b3IgJiYgdm0uZXhwb3J0cy5JUkdlbmVyYXRvcj8uZXhwb3J0cykgcmV0dXJuIHsKICAgICAgLi4udm0uZXhwb3J0cywgU2NyaXB0VHJlZUdlbmVyYXRvcjogdm0uZXhwb3J0cy5JUkdlbmVyYXRvci5leHBvcnRzLlNjcmlwdFRyZWVHZW5lcmF0b3IKICAgIH07CiAgfQogIGNvbnN0IGV4cG9ydHMgPSBnZXRFeHBvcnRzKCk7CiAgaWYgKGV4cG9ydHMpIHsKICAgIGNvbnN0IHNhbml0aXplID0gc3RyaW5nID0+IHsKICAgICAgaWYgKHR5cGVvZiBzdHJpbmcgIT09ICJzdHJpbmciKSB7CiAgICAgICAgY29uc29sZS53YXJuKGBzYW5pdGl6ZSBnb3QgdW5leHBlY3RlZCB0eXBlOiAke3R5cGVvZiBzdHJpbmd9YCk7CiAgICAgICAgc3RyaW5nID0gIiIgKyBzdHJpbmc7CiAgICAgIH0KICAgICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHN0cmluZykuc2xpY2UoMSwgLTEpOwogICAgfTsKCiAgICBUaHJlYWQgPSBleHBvcnRzLlRocmVhZDsgZXhlY3V0ZSA9IGV4cG9ydHMuZXhlY3V0ZTsKICAgIGNvbnN0IHsgSlNHZW5lcmF0b3IsIFNjcmlwdFRyZWVHZW5lcmF0b3IgfSA9IGV4cG9ydHM7CiAgICBjb25zdCBleHAgPSBKU0dlbmVyYXRvci5leHBvcnRzID09PSB1bmRlZmluZWQgPyBKU0dlbmVyYXRvci51bnN0YWJsZV9leHBvcnRzIDogSlNHZW5lcmF0b3IuZXhwb3J0czsKICAgIGNvbnN0IF9vZ0lSZGVzY2VuZFN0YWNrID0gU2NyaXB0VHJlZUdlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZFN0YWNrZWRCbG9jazsKICAgIFNjcmlwdFRyZWVHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRTdGFja2VkQmxvY2sgPSBmdW5jdGlvbihibG9jaykgewogICAgICBzd2l0Y2ggKGJsb2NrLm9wY29kZSkgewogICAgICAgIGNhc2UgInByb2NlZHVyZXNfY2FsbCI6IHsKICAgICAgICAgIGNvbnN0IHByb2MgPSBibG9jay5tdXRhdGlvbi5wcm9jY29kZTsKICAgICAgICAgIGNvbnN0IHN0b3JlID0gc3RvcmVHZXQocHJvYywgdGhpcy50YXJnZXQpOwogICAgICAgICAgaWYgKCF0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV0pIHRoaXMudGhyZWFkW3RhcmdldFByb2NEYXRhXSA9IHt9OwogICAgICAgICAgdGhpcy50aHJlYWRbdGFyZ2V0UHJvY0RhdGFdW3Byb2NdID0geyBibG9jaywgc3RvcmUgfTsgLy8gYXR0YWNoIHNvbWUgZGF0YSB3ZSBuZWVkCiAgICAgICAgICBpZiAoIXN0b3JlIHx8ICFzdG9yZS5pbnB1dHMpIHJldHVybiBfb2dJUmRlc2NlbmRTdGFjay5jYWxsKHRoaXMsIGJsb2NrKTsKCiAgICAgICAgICAvLyBpZ25vcmUgYnJhbmNoZXMgdGVtcG9yYXJpbHkKICAgICAgICAgIGNvbnN0IGFyZ0lkcyA9IEpTT04ucGFyc2UoYmxvY2subXV0YXRpb24uYXJndW1lbnRpZHMpOwogICAgICAgICAgY29uc3QgYXBwZW5kZXJzID0gW107CiAgICAgICAgICBjb25zdCB0ZW1wQmxvY2sgPSBzdHJ1Y3R1cmVkQ2xvbmUoYmxvY2spOwogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcmdJZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY29uc3QgaW5wdXQgPSBibG9jay5pbnB1dHNbYXJnSWRzW2ldXTsKICAgICAgICAgICAgaWYgKHN0b3JlLmlucHV0c1tpbnB1dD8ubmFtZV0/LnR5cGUgPT09ICJicmMiKSB7CiAgICAgICAgICAgICAgYXBwZW5kZXJzLnB1c2goW2ksIGlucHV0LmJsb2NrXSk7CiAgICAgICAgICAgICAgZGVsZXRlIHRlbXBCbG9jay5pbnB1dHNbaW5wdXQubmFtZV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV1bcHJvY10uYXBwZW5kZXJzID0gYXBwZW5kZXJzOwogICAgICAgICAgY29uc3Qgbm9kZSA9IF9vZ0lSZGVzY2VuZFN0YWNrLmNhbGwodGhpcywgdGVtcEJsb2NrKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXBwZW5kZXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIG5vZGUuYXJndW1lbnRzW2FwcGVuZGVyc1tpXVswXV0gPSB7IGtpbmQ6ICJjb25zdGFudCIsIG1icEtleTogdHJ1ZSwgdmFsdWU6IHRoaXMud2Fsa1N0YWNrKGFwcGVuZGVyc1tpXVsxXSkgfTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBub2RlOwogICAgICAgIH0KICAgICAgICBjYXNlICJTUG1icENTVF9zZXRQYXJhbSI6IHsKICAgICAgICAgIGxldCBwYXJhbUluZGV4ID0gdGhpcy5zY3JpcHQuYXJndW1lbnRzLmxhc3RJbmRleE9mKGJsb2NrLmZpZWxkcy5QQVJBTS52YWx1ZSk7CiAgICAgICAgICBpZiAocGFyYW1JbmRleCA9PT0gLTEpIHsKICAgICAgICAgICAgcGFyYW1JbmRleCA9IHRoaXMuc2NyaXB0LmFyZ3VtZW50cy5sZW5ndGg7CiAgICAgICAgICAgIHRoaXMuc2NyaXB0LmFyZ3VtZW50cy5wdXNoKGJsb2NrLmZpZWxkcy5QQVJBTS52YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICBraW5kOiAiU1BtYnBDU1Quc2V0UGFyYW0iLCBwYXJhbUluZGV4LCB2YWw6IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIlZBTFVFIikKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGNhc2UgIlNQbWJwQ1NUX2V2YWxQYXJhbSI6IHsKICAgICAgICAgIGNvbnN0IG5vZGUgPSB7IGtpbmQ6ICJTUG1icENTVC5ldmFsUGFyYW0iIH07CiAgICAgICAgICBpZiAoIXRoaXMudGhyZWFkW3RhcmdldFByb2NEYXRhXSkgcmV0dXJuIG5vZGU7CiAgICAgICAgICBjb25zdCBwcm9jRGF0YSA9IHRoaXMudGhyZWFkW3RhcmdldFByb2NEYXRhXVt0aGlzLnNjcmlwdC5wcm9jZWR1cmVDb2RlXTsKICAgICAgICAgIGNvbnN0IHByb2NlZHVyZUJsb2NrID0gcHJvY0RhdGE/LmJsb2NrOwogICAgICAgICAgaWYgKHByb2NlZHVyZUJsb2NrKSB7CiAgICAgICAgICAgIGNvbnN0IHBhcmFtSW5kZXggPSB0aGlzLnNjcmlwdC5hcmd1bWVudHMubGFzdEluZGV4T2YoYmxvY2suZmllbGRzLlBBUkFNLnZhbHVlKTsKICAgICAgICAgICAgY29uc3QgYXJnSWRzID0gSlNPTi5wYXJzZShwcm9jZWR1cmVCbG9jay5tdXRhdGlvbi5hcmd1bWVudGlkcyk7CiAgICAgICAgICAgIGlmIChwYXJhbUluZGV4ID4gLTEpIHsKICAgICAgICAgICAgICBjb25zdCBhcmcgPSBwcm9jZWR1cmVCbG9jay5pbnB1dHNbYXJnSWRzW3BhcmFtSW5kZXhdXTsKICAgICAgICAgICAgICBpZiAoYXJnPy5ibG9jayAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb25zdCBpbnB1dCA9IHRoaXMudGFyZ2V0LmJsb2Nrcy5nZXRCbG9jayhhcmcuYmxvY2spOwogICAgICAgICAgICAgICAgbm9kZVsiaW5wdXQiXSA9IHRoaXMuZGVzY2VuZElucHV0KGlucHV0KTsKICAgICAgICAgICAgICAgIG5vZGVbImluZGV4Il0gPSBwYXJhbUluZGV4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5vZGU7CiAgICAgICAgfQogICAgICAgIGNhc2UgIlNQbWJwQ1NUX3J1bkJyYW5jaCI6IHsKICAgICAgICAgIGNvbnN0IG5vZGUgPSB7IGtpbmQ6ICJTUG1icENTVC5ydW5CcmFuY2giLCBpbmRleDogdGhpcy5kZXNjZW5kSW5wdXRPZkJsb2NrKGJsb2NrLCAiSU5ERVgiKSB9OwogICAgICAgICAgaWYgKCF0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV0pIHJldHVybiBub2RlOwogICAgICAgICAgY29uc3QgcHJvY0RhdGEgPSB0aGlzLnRocmVhZFt0YXJnZXRQcm9jRGF0YV1bdGhpcy5zY3JpcHQucHJvY2VkdXJlQ29kZV07CiAgICAgICAgICBjb25zdCBwcm9jZWR1cmVCbG9jayA9IHByb2NEYXRhPy5ibG9jazsKICAgICAgICAgIGlmIChwcm9jZWR1cmVCbG9jaykgbm9kZS5hcHBlbmRlcnMgPSBwcm9jRGF0YS5hcHBlbmRlcnM7CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICB9CiAgICAgICAgZGVmYXVsdDogcmV0dXJuIF9vZ0lSZGVzY2VuZFN0YWNrLmNhbGwodGhpcywgYmxvY2spOwogICAgICB9CiAgICB9OwogICAgY29uc3QgX29nSVJkZXNjZW5kSW5wID0gU2NyaXB0VHJlZUdlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZElucHV0OwogICAgU2NyaXB0VHJlZUdlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZElucHV0ID0gZnVuY3Rpb24oYmxvY2spIHsKICAgICAgaWYgKGJsb2NrLm9wY29kZSA9PT0gIlNQbWJwQ1NUX2dldFBhcmFtIikgcmV0dXJuIHsga2luZDogIlNQbWJwQ1NULmdldFBhcmFtIiwgcGFyYW06IHRoaXMuZGVzY2VuZElucHV0T2ZCbG9jayhibG9jaywgIlBBUkFNIikgfTsKICAgICAgZWxzZSByZXR1cm4gX29nSVJkZXNjZW5kSW5wLmNhbGwodGhpcywgYmxvY2spOwogICAgfTsKICAgIGNvbnN0IF9vZ0pTZGVzY2VuZFN0YWNrID0gSlNHZW5lcmF0b3IucHJvdG90eXBlLmRlc2NlbmRTdGFja2VkQmxvY2s7CiAgICBKU0dlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZFN0YWNrZWRCbG9jayA9IGZ1bmN0aW9uKG5vZGUpIHsKICAgICAgc3dpdGNoIChub2RlLmtpbmQpIHsKICAgICAgICBjYXNlICJwcm9jZWR1cmVzLmNhbGwiOiB7CiAgICAgICAgICAvLyBUaGlzIGFsc28gZ2V0cyBHbG9iYWwgUHJvY2VkdXJlcyB0byB3b3JrIGZvciBzb21lIHJlYXNvbgogICAgICAgICAgY29uc3QgYXJnSW5kZXhlcyA9IFtdOwogICAgICAgICAgbGV0IGZvcmNlWWllbGQgPSBmYWxzZTsKICAgICAgICAgIGNvbnN0IG9nU291cmNlID0gdGhpcy5zb3VyY2U7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGUuYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IGFyZyA9IG5vZGUuYXJndW1lbnRzW2ldOwogICAgICAgICAgICBpZiAoIWFyZy52YWx1ZSB8fCAhYXJnLm1icEtleSkgY29udGludWU7CiAgICAgICAgICAgIHRoaXMuc291cmNlID0gIiI7CiAgICAgICAgICAgIHRoaXMuZGVzY2VuZFN0YWNrKGFyZy52YWx1ZSwgbmV3IGV4cC5GcmFtZShmYWxzZSkpOwogICAgICAgICAgICBpZiAodGhpcy5zY3JpcHQueWllbGRzKSB7CiAgICAgICAgICAgICAgYXJnLnZhbHVlID0gYGZ1bmN0aW9uKiAoKSB7ICR7dGhpcy5zb3VyY2V9IH1gOwogICAgICAgICAgICAgIGZvcmNlWWllbGQgPSB0cnVlOwogICAgICAgICAgICB9IGVsc2UgYXJnLnZhbHVlID0gYCgpID0+IHsgJHt0aGlzLnNvdXJjZX0gfWA7CiAgICAgICAgICAgIGFyZ0luZGV4ZXMucHVzaChpKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc291cmNlID0gb2dTb3VyY2U7CgogICAgICAgICAgaWYgKGFyZ0luZGV4ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIHRyYW5zZm9ybSB0aGUgYnJhbmNoIHN0cmluZyB0byBhIGZ1bmN0aW9uCiAgICAgICAgICAgIC8vIG1vZGlmaWVkIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL1R1cmJvV2FycC9zY3JhdGNoLXZtL2Jsb2IvZGV2ZWxvcC9zcmMvY29tcGlsZXIvanNnZW4uanMKICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlQ29kZSA9IG5vZGUuY29kZTsKICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlVmFyaWFudCA9IG5vZGUudmFyaWFudDsKICAgICAgICAgICAgY29uc3QgcHJvY2VkdXJlRGF0YSA9IHRoaXMuaXIucHJvY2VkdXJlc1twcm9jZWR1cmVWYXJpYW50XTsKICAgICAgICAgICAgaWYgKHByb2NlZHVyZURhdGEuc3RhY2sgPT09IG51bGwpIGJyZWFrOwoKICAgICAgICAgICAgY29uc3QgeWllbGRGb3JSZWN1cnNpb24gPSAhdGhpcy5pc1dhcnAgJiYgcHJvY2VkdXJlQ29kZSA9PT0gdGhpcy5zY3JpcHQucHJvY2VkdXJlQ29kZTsKICAgICAgICAgICAgaWYgKHlpZWxkRm9yUmVjdXJzaW9uKSB0aGlzLnlpZWxkTm90V2FycCgpOwogICAgICAgICAgICBpZiAocHJvY2VkdXJlRGF0YS55aWVsZHMgfHwgZm9yY2VZaWVsZCkgdGhpcy5zb3VyY2UgKz0gInlpZWxkKiAiOwoKICAgICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYHRocmVhZC5wcm9jZWR1cmVzWyIke3Nhbml0aXplKHByb2NlZHVyZVZhcmlhbnQpfSJdKGA7CiAgICAgICAgICAgIGNvbnN0IGFyZ3MgPSBbXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlLmFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gbm9kZS5hcmd1bWVudHNbaV07CiAgICAgICAgICAgICAgaWYgKGFyZ0luZGV4ZXMuaW5kZXhPZihpKSA+IC0xKSBhcmdzLnB1c2goaW5wdXQudmFsdWUpOwogICAgICAgICAgICAgIGVsc2UgYXJncy5wdXNoKHRoaXMuZGVzY2VuZElucHV0KGlucHV0KS5hc1NhZmUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYXJncy5qb2luKCIsIikgKyAiKTtcbiI7CiAgICAgICAgICAgIHRoaXMucmVzZXRWYXJpYWJsZUlucHV0cygpOwoKICAgICAgICAgICAgaWYgKGZvcmNlWWllbGQpIHRoaXMuaXIucHJvY2VkdXJlc1twcm9jZWR1cmVWYXJpYW50XS55aWVsZHMgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0gZWxzZSByZXR1cm4gX29nSlNkZXNjZW5kU3RhY2suY2FsbCh0aGlzLCBub2RlKTsKICAgICAgICB9CiAgICAgICAgY2FzZSAiU1BtYnBDU1Quc2V0UGFyYW0iOiB7CiAgICAgICAgICBjb25zdCB2YWwgPSB0aGlzLmRlc2NlbmRJbnB1dChub2RlLnZhbCk7CiAgICAgICAgICBjb25zdCBpID0gbm9kZS5wYXJhbUluZGV4OwogICAgICAgICAgaWYgKGkgIT09IHVuZGVmaW5lZCAmJiBpICE9PSAtMSkgdGhpcy5zb3VyY2UgKz0gYHAke2l9ID0gJHt2YWwuYXNTYWZlKCl9O1xuYDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjYXNlICJTUG1icENTVC5ldmFsUGFyYW0iOiB7CiAgICAgICAgICBpZiAobm9kZS5pbnB1dCA9PT0gdW5kZWZpbmVkKSBicmVhazsKICAgICAgICAgIGNvbnN0IHZhbCA9IHRoaXMuZGVzY2VuZElucHV0KG5vZGUuaW5wdXQpOwogICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYHAke25vZGUuaW5kZXh9ID0gJHt2YWwuYXNVbmtub3duKCl9O1xuYDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjYXNlICJTUG1icENTVC5ydW5CcmFuY2giOiB7CiAgICAgICAgICBpZiAodGhpcy5pc1Byb2NlZHVyZSkgewogICAgICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMubG9jYWxWYXJpYWJsZXMubmV4dCgpOwogICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgY29uc3QgJHtpbmRleH0gPSAke3RoaXMuZGVzY2VuZElucHV0KG5vZGUuaW5kZXgpLmFzTnVtYmVyKCl9IC0gMTtcbmA7CiAgICAgICAgICAgIHRoaXMuc291cmNlICs9IGBzd2l0Y2ggKCR7aW5kZXh9LnRvU3RyaW5nKCkpIHtcbmA7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZS5hcHBlbmRlcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBhcmdJbmQgPSBub2RlLmFwcGVuZGVyc1tpXVswXTsKICAgICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgY2FzZSAiJHtpfSI6IHtcbmA7CiAgICAgICAgICAgICAgaWYgKHRoaXMuc2NyaXB0LnlpZWxkcykgdGhpcy5zb3VyY2UgKz0gYHlpZWxkKiBwJHthcmdJbmR9KCk7XG5gOwogICAgICAgICAgICAgIGVsc2UgdGhpcy5zb3VyY2UgKz0gYHAke2FyZ0luZH0oKTtcbmA7CiAgICAgICAgICAgICAgdGhpcy5zb3VyY2UgKz0gYGJyZWFrO1xuYDsKICAgICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgfVxuYDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNvdXJjZSArPSBgfVxuYDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBkZWZhdWx0OiByZXR1cm4gX29nSlNkZXNjZW5kU3RhY2suY2FsbCh0aGlzLCBub2RlKTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IF9vZ0pTZGVzY2VuZElucCA9IEpTR2VuZXJhdG9yLnByb3RvdHlwZS5kZXNjZW5kSW5wdXQ7CiAgICBKU0dlbmVyYXRvci5wcm90b3R5cGUuZGVzY2VuZElucHV0ID0gZnVuY3Rpb24obm9kZSkgewogICAgICBpZiAobm9kZS5raW5kID09PSAiU1BtYnBDU1QuZ2V0UGFyYW0iKSB7CiAgICAgICAgY29uc3QgdmFsID0gdGhpcy5kZXNjZW5kSW5wdXQobm9kZS5wYXJhbSkuYXNTYWZlKCk7CiAgICAgICAgcmV0dXJuIG5ldyBleHAuVHlwZWRJbnB1dChgKCgpID0+IHsKICAgICAgICAgIGxldCBhID0gJHtKU09OLnN0cmluZ2lmeSh0aGlzLnNjcmlwdC5hcmd1bWVudHMpfSwgdiA9ICR7dmFsfTsKICAgICAgICAgIGlmICh0eXBlb2YgdiAhPT0gJ3N0cmluZycpIHYgPSAodikudG9TdHJpbmcoKTsKICAgICAgICAgIGNvbnN0IGkgPSBhLmluZGV4T2Yodik7CiAgICAgICAgICByZXR1cm4gaSA+IC0xID8gYXJndW1lbnRzW2ldLnRvU3RyaW5nKCkgOiAiIjsKICAgICAgICB9KSgpYCwgZXhwLlRZUEVfU1RSSU5HKTsKICAgICAgfSBlbHNlIGlmIChub2RlLmtpbmQgPT09ICJwcm9jZWR1cmVzLmNhbGwiKSB7CiAgICAgICAgLy8gVGhpcyBnZXRzIEdsb2JhbCBQcm9jZWR1cmVzIHRvIHdvcmsgZm9yIHNvbWUgcmVhc29uCiAgICAgICAgcmV0dXJuIF9vZ0pTZGVzY2VuZElucC5jYWxsKHRoaXMsIG5vZGUpOwogICAgICB9IGVsc2UgcmV0dXJuIF9vZ0pTZGVzY2VuZElucC5jYWxsKHRoaXMsIG5vZGUpOwogICAgfTsKICB9CgogIC8vIFNjcmF0Y2hCbG9ja3MgYW5kIEVkaXRvciBQYXRjaGVzCiAgZnVuY3Rpb24gc3luY0ZpZWxkQ29sb3JzKGJsb2NrKSB7CiAgICBmb3IgKGNvbnN0IGlucHV0IG9mIGJsb2NrLmlucHV0TGlzdCkgewogICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGlucHV0Py5maWVsZFJvdykgewogICAgICAgIGlmIChmaWVsZC5hcnJvd18pIHsgLy8gZHJvcGRvd24gZmllbGRzCiAgICAgICAgICBpZiAoZmllbGQuc291cmNlQmxvY2tfLmlzU2hhZG93KCkpIGZpZWxkLnNvdXJjZUJsb2NrXy5jbGVhclNoYWRvd0NvbG91cigpOwogICAgICAgIH0KICAgICAgICBpZiAoZmllbGQuYm94XykgeyAvLyB0ZXh0IGlucHV0IGZpZWxkcyBhbmQgcm91bmQgZHJvcGRvd25zCiAgICAgICAgICBmaWVsZC5ib3hfLnNldEF0dHJpYnV0ZSgiZmlsbCIsIGZpZWxkLnNvdXJjZUJsb2NrXy5nZXRDb2xvdXIoKSk7CiAgICAgICAgICBpZiAoZmllbGQuYm94Xy5oYXNBdHRyaWJ1dGUoInN0cm9rZSIpKSBmaWVsZC5ib3hfLnNldEF0dHJpYnV0ZSgic3Ryb2tlIiwgZmllbGQuc291cmNlQmxvY2tfLmdldENvbG91clRlcnRpYXJ5KCkpOwogICAgICAgIH0KICAgICAgfQogICAgICAvLyBmb3Igc2hhZG93IGJsb2NrcywgaW5oZXJpdCB0aGUgdGVydGlhcnkgY29sb3IKICAgICAgaWYgKGlucHV0Py5jb25uZWN0aW9uPy50YXJnZXRDb25uZWN0aW9uPy5zb3VyY2VCbG9ja18pIHsKICAgICAgICBjb25zdCBvdGhlckJsb2NrID0gaW5wdXQ/LmNvbm5lY3Rpb24/LnRhcmdldENvbm5lY3Rpb24/LnNvdXJjZUJsb2NrXzsKICAgICAgICBpZiAob3RoZXJCbG9jay5pc1NoYWRvdygpKSB7CiAgICAgICAgICAvLyBwZW5ndWlubW9kIGRvZXNudCBoYXZlIHF1YXRlcm5hcnkgY29sb3JzIHlldAogICAgICAgICAgaWYgKGlzUE0pIG90aGVyQmxvY2suc2V0Q29sb3VyKG90aGVyQmxvY2suZ2V0Q29sb3VyKCksIG90aGVyQmxvY2suZ2V0Q29sb3VyU2Vjb25kYXJ5KCksIGJsb2NrLmdldENvbG91clRlcnRpYXJ5KCkpOwogICAgICAgICAgZWxzZSBvdGhlckJsb2NrLnNldENvbG91cihvdGhlckJsb2NrLmdldENvbG91cigpLCBvdGhlckJsb2NrLmdldENvbG91clNlY29uZGFyeSgpLCBibG9jay5nZXRDb2xvdXJUZXJ0aWFyeSgpLCBvdGhlckJsb2NrLmdldENvbG91clF1YXRlcm5hcnkoKSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHsKICAgIGNvbnN0IHJlY29sb3JhYmxlcyA9IFsKICAgICAgImFyZ3VtZW50X3JlcG9ydGVyX3N0cmluZ19udW1iZXIiLCAiYXJndW1lbnRfcmVwb3J0ZXJfYm9vbGVhbiIsCiAgICAgICJTUG1icENTVF9zZXRQYXJhbSIsICJTUG1icENTVF9nZXRQYXJhbSIsICJTUG1icENTVF9ydW5CcmFuY2giLAogICAgICAiU1BtYnBDU1RfZXZhbFBhcmFtIiwgInByb2NlZHVyZXNfcmV0dXJuIiwKICAgICAgLy8gcGVuZ3Vpbm1vZAogICAgICAicHJvY2VkdXJlc19kZWZpbml0aW9uX3JldHVybiIsICJwcm9jZWR1cmVzX3NldCIKICAgIF07CgogICAgbGV0IGRvbVRvQmxvY2tYbWwgPSBudWxsOwogICAgY29uc3Qgb2xkRFRCSCA9IFNCLlhtbC5kb21Ub0Jsb2NrSGVhZGxlc3NfOwogICAgU0IuWG1sLmRvbVRvQmxvY2tIZWFkbGVzc18gPSBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICAgIGRvbVRvQmxvY2tYbWwgPSBhcmdzWzBdOwogICAgICBjb25zdCByZXR1cm5WYWx1ZSA9IG9sZERUQkguYXBwbHkodGhpcywgYXJncyk7CiAgICAgIGRvbVRvQmxvY2tYbWwgPSBudWxsOwogICAgICByZXR1cm4gcmV0dXJuVmFsdWU7CiAgICB9CgogICAgY29uc3Qgb2xkU2Nyb2xsVG9DYXRlZ29yeSA9IFNCLlRvb2xib3gucHJvdG90eXBlLnNjcm9sbFRvQ2F0ZWdvcnlCeUlkOwogICAgU0IuVG9vbGJveC5wcm90b3R5cGUuc2Nyb2xsVG9DYXRlZ29yeUJ5SWQgPSBmdW5jdGlvbihpZCkgewogICAgICBpZiAoaWQgPT09ICJteUJsb2NrcyIgJiYgc2hvdWxkU2Nyb2xsVG9NQlApIHsKICAgICAgICBzaG91bGRTY3JvbGxUb01CUCA9IGZhbHNlOwogICAgICAgIGlkID0gIlNQbWJwQ1NUIjsKICAgICAgfQogICAgICByZXR1cm4gb2xkU2Nyb2xsVG9DYXRlZ29yeS5jYWxsKHRoaXMsIGlkKTsKICAgIH0KCiAgICBjb25zdCB1dGlscyA9IFNCLlNjcmF0Y2hCbG9ja3MuUHJvY2VkdXJlVXRpbHM7CiAgICBjb25zdCBvZ1VwZGF0ZURpc3BsYXkgPSB1dGlscy51cGRhdGVEaXNwbGF5XzsKICAgIHV0aWxzLnVwZGF0ZURpc3BsYXlfID0gZnVuY3Rpb24oKSB7CiAgICAgIGlmIChleHRlbnNpb25SZW1vdmFibGUpIHJldHVybiBvZ1VwZGF0ZURpc3BsYXkuY2FsbCh0aGlzKTsKICAgICAgY29uc3Qgc3RvcmUgPSB0aGlzLlNQbWJwQ1NUX3N0b3JlIHx8IHN0b3JlR2V0KHRoaXMucHJvY0NvZGVfKTsKICAgICAgaWYgKHN0b3JlLmNvbG9yICYmICF0aGlzLmlzSW5zZXJ0aW9uTWFya2VyKCkpIHsKICAgICAgICB0aGlzLnNldENvbG91ciguLi50aGVtZWlmeUNvbG9yKHN0b3JlLmNvbG9yKSk7CiAgICAgICAgaWYgKHRoaXMudHlwZSA9PT0gInByb2NlZHVyZXNfcHJvdG90eXBlIikgewogICAgICAgICAgLy8gUmVjb2xvciBhcmd1bWVudCByZXBvcnRlcnMgYW5kIHRoZSBkZWZpbmUgYmxvY2sgdG8gdGhlIGJsb2NrIGNvbG9yCiAgICAgICAgICAvLyBEaXNhYmxlIGJyYW5jaCBpbnB1dHMKICAgICAgICAgIHRoaXMuc2V0Q29sb3VyKC4uLnRoZW1laWZ5Q29sb3Ioc3RvcmUuY29sb3IpKTsKICAgICAgICAgIC8vIFNjcmF0Y2hCbG9ja3Mgd2F5cyBvZiBnZXR0aW5nIHRoZSBwYXJlbnQgYmxvY2sgd29uJ3Qgd29yayB3aGlsZSB0aGUgYmxvY2tzIGFyZSBiZWluZyBjcmVhdGVkCiAgICAgICAgICBxdWV1ZU1pY3JvdGFzaygoKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGRlZmluZUJsb2NrID0gdGhpcy5nZXRQYXJlbnQoKTsKICAgICAgICAgICAgaWYgKCFkZWZpbmVCbG9jaykgcmV0dXJuOwogICAgICAgICAgICBkZWZpbmVCbG9jay5zZXRDb2xvdXIoLi4udGhlbWVpZnlDb2xvcihzdG9yZS5jb2xvcikpOwogICAgICAgICAgICBzeW5jRmllbGRDb2xvcnMoZGVmaW5lQmxvY2spOwogICAgICAgICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuaW5wdXRMaXN0LmZpbHRlcigoaXRlbSwgaSkgPT4gaXRlbS5jb25uZWN0aW9uICE9PSBudWxsKTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGlmICghY2hpbGRyZW5baV0uY29ubmVjdGlvbikgY29udGludWU7CiAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXS5jb25uZWN0aW9uLnRhcmdldEJsb2NrKCk7CiAgICAgICAgICAgICAgaWYgKHN0b3JlLmlucHV0cykgewogICAgICAgICAgICAgICAgY29uc3QgdHlwZSA9IHN0b3JlLmlucHV0c1t0aGlzLmFyZ3VtZW50SWRzX1tpXV0/LnR5cGU7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gImJyYyIpIHsKICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0T3V0cHV0U2hhcGUoMyk7CiAgICAgICAgICAgICAgICAgIGNoaWxkLnNldE5leHRTdGF0ZW1lbnQoZmFsc2UpOwogICAgICAgICAgICAgICAgICBjaGlsZC5zZXRNb3ZhYmxlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgY2hpbGRbdGFyZ2V0UHJvY0RhdGFdID0gImJyYW5jaERyYWciOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAocmVjb2xvcmFibGVzLmluY2x1ZGVzKGNoaWxkLnR5cGUpKSB1cGRhdGVBcmd1bWVudFJlcG9ydGVyQ29sb3IoY2hpbGQsIGRlZmluZUJsb2NrKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIC8vIFJlY29sb3IgZHJvcGRvd25zIHRvIHRoZSBibG9jayBjb2xvcgogICAgICAgIGlmICh0aGlzLnR5cGUgPT09ICJwcm9jZWR1cmVzX2NhbGwiKSB7CiAgICAgICAgICBxdWV1ZU1pY3JvdGFzaygoKSA9PiB7CiAgICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5nZXRDaGlsZHJlbigpKSB7CiAgICAgICAgICAgICAgaWYgKGNoaWxkLmlzU2hhZG93KCkgJiYgY2hpbGQub3V0cHV0Q29ubmVjdGlvbiAmJiAhaXNOb3JtYWxJbnB1dChjaGlsZC50eXBlKSkgY2hpbGQuc2V0Q29sb3VyKC4uLnRoZW1laWZ5Q29sb3Ioc3RvcmUuY29sb3IpKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CgogICAgICAvLyBEaXNjb25uZWN0IGFuZCByZWNvbm5lY3QgdGhlIHByb3RvdHlwZSBmcm9tIHRoZSBkZWZpbmUgYmxvY2sgd2hlbgogICAgICAvLyBjaGFuZ2luZyB0aGUgb3V0cHV0IHR5cGUgaW4gUE0gYmVjYXVzZSBvdGhlcndpc2UgZXJyb3JzIHdpbGwgaGFwcGVuCiAgICAgIC8vIHdlIGhhdmUgdG8gY3JlYXRlIGEgbmV3IGRlZmluZSBibG9jayB0byBjaGFuZ2UgaXRzIHR5cGUKICAgICAgbGV0IGRlZmluZUJsb2NrID0gKAogICAgICAgIGlzUE0gJiYgdGhpcy50eXBlID09PSAicHJvY2VkdXJlc19wcm90b3R5cGUiICYmIHRoaXMuZ2V0UGFyZW50KCk/LnR5cGU/LnN0YXJ0c1dpdGgoInByb2NlZHVyZXNfZGVmaW5pdGlvbiIpCiAgICAgICkgPyB0aGlzLmdldFBhcmVudCgpIDogbnVsbDsKICAgICAgbGV0IHNhdmVkRGVmQ29ubmVjdCA9IG51bGwsIHNhdmVkU2hhZG93ID0gbnVsbDsKICAgICAgY29uc3QgbmV3T3Bjb2RlID0gdGhpcy5vdXRwdXRfID8gInByb2NlZHVyZXNfZGVmaW5pdGlvbl9yZXR1cm4iIDogInByb2NlZHVyZXNfZGVmaW5pdGlvbiI7CiAgICAgIGlmIChpc1BNICYmIGRlZmluZUJsb2NrICYmIGRlZmluZUJsb2NrLnR5cGUgIT09IG5ld09wY29kZSkgewogICAgICAgIHNhdmVkRGVmQ29ubmVjdCA9ICh0aGlzLnByZXZpb3VzQ29ubmVjdGlvbiB8fCB0aGlzLm91dHB1dENvbm5lY3Rpb24pLnRhcmdldENvbm5lY3Rpb247CiAgICAgICAgc2F2ZWRTaGFkb3cgPSBzYXZlZERlZkNvbm5lY3QuZ2V0U2hhZG93RG9tKCk7CiAgICAgICAgY29uc3Qgc2F2ZWROZXh0Q29ubmVjdCA9IGRlZmluZUJsb2NrLm5leHRDb25uZWN0aW9uPy50YXJnZXRDb25uZWN0aW9uOwoKICAgICAgICAvLyBSZW1vdmUgdGhlIHNoYWRvdyBET00sIHRoZW4gZGlzY29ubmVjdCB0aGUgYmxvY2suICBPdGhlcndpc2UgYSBzaGFkb3cgYmxvY2sKICAgICAgICAvLyB3aWxsIHJlc3Bhd24gaW5zdGFudGx5LCBhbmQgd2UnZCBoYXZlIHRvIHJlbW92ZSBpdCB3aGVuIHdlIHJlbW92ZSB0aGUgaW5wdXQuCiAgICAgICAgc2F2ZWROZXh0Q29ubmVjdD8uZGlzY29ubmVjdCgpOwoKICAgICAgICAvLyBSZWNyZWF0ZSB0aGUgZGVmaW5lIGJsb2NrIHdpdGggYSBjaGFuZ2VkIHR5cGUKICAgICAgICBjb25zdCB3cyA9IGRlZmluZUJsb2NrLndvcmtzcGFjZTsKICAgICAgICBjb25zdCB4bWwgPSBTQi5YbWwuYmxvY2tUb0RvbShkZWZpbmVCbG9jayk7CiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBkZWZpbmVCbG9jay5nZXRSZWxhdGl2ZVRvU3VyZmFjZVhZKCk7CiAgICAgICAgeG1sLnNldEF0dHJpYnV0ZSgidHlwZSIsIG5ld09wY29kZSk7CiAgICAgICAgZGVmaW5lQmxvY2suZGlzcG9zZSgpOwogICAgICAgIGRlZmluZUJsb2NrID0gU0IuWG1sLmRvbVRvQmxvY2soeG1sLCB3cyk7CiAgICAgICAgZGVmaW5lQmxvY2subW92ZUJ5KHBvc2l0aW9uLngsIHBvc2l0aW9uLnkpOwogICAgICAgIGlmIChzYXZlZE5leHRDb25uZWN0KSBzYXZlZE5leHRDb25uZWN0LmNvbm5lY3QoZGVmaW5lQmxvY2submV4dENvbm5lY3Rpb24pOwogICAgICB9CiAgICAgIG9nVXBkYXRlRGlzcGxheS5jYWxsKHRoaXMpOwoKICAgICAgLy8gdHVybiBicmFuY2ggYW5kIGltYWdlIGlucHV0cyBpbnRvIGJyYW5jaGVzIGFuZCBpbWFnZXMKICAgICAgLy8gKGRvaW5nIGl0IGluIGF0dGFjaFNoYWRvdyBtYWtlcyBpdCBub3Qgd29yayBvbiBmdXJ0aGVyIHVwZGF0ZXMpCiAgICAgIGlmIChzdG9yZT8uaW5wdXRzICYmIHRoaXMudHlwZSAhPT0gInByb2NlZHVyZXNfZGVjbGFyYXRpb24iKSBmb3IgKGxldCBpID0gdGhpcy5pbnB1dExpc3QubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgY29uc3QgaW5wdXQgPSB0aGlzLmlucHV0TGlzdFtpXTsKICAgICAgICBjb25zdCB0eXBlID0gc3RvcmUuaW5wdXRzW2lucHV0Lm5hbWVdPy50eXBlOwogICAgICAgIGlmICgKICAgICAgICAgIChpbnB1dC50eXBlICE9PSBTQi5ORVhUX1NUQVRFTUVOVCAmJiB0eXBlID09PSAiYnJjIikgfHwgKGlucHV0LnR5cGUgIT09IFNCLkRVTU1ZX0lOUFVUICYmIHR5cGUgPT09ICJpbWciKQogICAgICAgICkgewogICAgICAgICAgLy8gZm9yIFByb3RvdHlwZSBibG9ja3Mgd2UganVzdCB1c2UgYSBzdGF0aWMgc3F1YXJlIGJsb2NrIGFzIGEgdmlzdWFsIHJlcHJlc2VudGF0aW9uCiAgICAgICAgICAvLyBmb3IgYnJhbmNoIGlucHV0cywgdGhpcyBpcyBkb25lIGluICd1cGRhdGVEaXNwbGF5XycKICAgICAgICAgIGlmICh0eXBlID09PSAiYnJjIiAmJiB0aGlzLnR5cGUgPT09ICJwcm9jZWR1cmVzX3Byb3RvdHlwZSIpIGNvbnRpbnVlOwogICAgICAgICAgbGV0IGNvbm5lY3Rpb24sIG5ld0lucHV0OwogICAgICAgICAgaWYgKHR5cGUgPT09ICJicmMiKSB7CiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSB0aGlzLm1ha2VDb25uZWN0aW9uXyhTQi5ORVhUX1NUQVRFTUVOVCk7CiAgICAgICAgICAgIGlmIChpc1BNKSBjb25uZWN0aW9uLnNldENoZWNrKCJub3JtYWwiKTsKICAgICAgICAgICAgbmV3SW5wdXQgPSBuZXcgU0IuSW5wdXQoU0IuTkVYVF9TVEFURU1FTlQsIGlucHV0Lm5hbWUsIHRoaXMsIGNvbm5lY3Rpb24pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgaW1hZ2VVUkwgPSBnZXRTdG9yZWRJbWFnZShzdG9yZS5pbnB1dHNbaW5wdXQubmFtZV0uc3JjKTsKICAgICAgICAgICAgbmV3SW5wdXQgPSBuZXcgU0IuSW5wdXQoU0IuRFVNTVlfSU5QVVQsICIiLCB0aGlzKTsKICAgICAgICAgICAgbmV3SW5wdXQuYXBwZW5kRmllbGQobmV3IFNjcmF0Y2hCbG9ja3MuRmllbGRJbWFnZShpbWFnZVVSTCwgMjUsIDI1KSk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gUmVtb3ZlIHRoZSBvbGQgaW5wdXQuLi4KICAgICAgICAgIGlmIChpbnB1dC5jb25uZWN0aW9uICYmIGlucHV0LmNvbm5lY3Rpb24uaXNDb25uZWN0ZWQoKSkgewogICAgICAgICAgICBpbnB1dC5jb25uZWN0aW9uLnNldFNoYWRvd0RvbShudWxsKTsKICAgICAgICAgICAgdmFyIGJsb2NrID0gaW5wdXQuY29ubmVjdGlvbi50YXJnZXRCbG9jaygpOwogICAgICAgICAgICBpZiAoYmxvY2suaXNTaGFkb3coKSkgYmxvY2suZGlzcG9zZSgpOyAvLyBEZXN0cm95IGFueSBhdHRhY2hlZCBzaGFkb3cgYmxvY2sKICAgICAgICAgICAgZWxzZSBibG9jay51bnBsdWcoKTsgLy8gRGlzY29ubmVjdCBhbnkgYXR0YWNoZWQgbm9ybWFsIGJsb2NrCiAgICAgICAgICB9CiAgICAgICAgICBpbnB1dC5kaXNwb3NlKCk7CiAgICAgICAgICAvLyAuLi5idXQgcmVwbGFjZSBpdCB3aXRoIHRoZSBuZXcgb25lIGluIHBsYWNlCiAgICAgICAgICAvLyAoY2FsbGluZyByZW1vdmVJbnB1dCgpIHNoaWZ0cyBhbGwgZWxlbWVudHMgb2YgaW5wdXRMaXN0IHdoaWNoIGlzIGEgYml0IHNsb3dlcikKICAgICAgICAgIGlmICh0eXBlID09PSAiYnJjIiAmJiAoaXNQTSA/IHRoaXMub3V0cHV0XyA6IHRoaXMuZ2V0UmV0dXJuKCkpKSB0aGlzLmlucHV0TGlzdC5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKGkgfHwgdHlwZSA9PT0gImltZyIpIHRoaXMuaW5wdXRMaXN0W2ldID0gbmV3SW5wdXQ7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIC8vIGZpeCB3ZWlyZCB2aXN1YWwgZ2xpdGNoIHdpdGggYSBicmFuY2ggYXMgdGhlIGZpcnN0IGlucHV0CiAgICAgICAgICAgICAgdGhpcy5pbnB1dExpc3RbaV0gPSB0aGlzLmFwcGVuZER1bW15SW5wdXQoKTsKICAgICAgICAgICAgICB0aGlzLmlucHV0TGlzdC5wdXNoKG5ld0lucHV0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNhdmVkRGVmQ29ubmVjdCkgewogICAgICAgIHNhdmVkRGVmQ29ubmVjdCA9IGRlZmluZUJsb2NrLmdldElucHV0KCJjdXN0b21fYmxvY2siKS5jb25uZWN0aW9uOwogICAgICAgICh0aGlzLnByZXZpb3VzQ29ubmVjdGlvbiB8fCB0aGlzLm91dHB1dENvbm5lY3Rpb24pLmNvbm5lY3Qoc2F2ZWREZWZDb25uZWN0KTsKICAgICAgICBzYXZlZERlZkNvbm5lY3Quc2V0U2hhZG93RG9tKHNhdmVkU2hhZG93KTsKICAgICAgfQoKICAgICAgaWYgKCF0aGlzLmlzSW5zZXJ0aW9uTWFya2VyKCkpIHsKICAgICAgICAvLyBTY3JhdGNoQmxvY2tzIHdheXMgb2YgZ2V0dGluZyB0aGUgbmV4dCBibG9jayB3b24ndCB3b3JrIHdoaWxlIHRoZSBibG9ja3MgYXJlIGJlaW5nIGNyZWF0ZWQKICAgICAgICBjb25zdCBhY3R1YWxOZXh0QmxvY2sgPSB0aGlzLmdldE5leHRCbG9jaygpIHx8IHZtPy5lZGl0aW5nVGFyZ2V0Py5ibG9ja3M/LmdldEJsb2NrKHRoaXMuaWQpPy5uZXh0IHx8IChkb21Ub0Jsb2NrWG1sICYmIGRvbVRvQmxvY2tYbWwucXVlcnlTZWxlY3RvcigibmV4dCIpKTsKICAgICAgICBjb25zdCBpc1JldHVybmVyID0gaXNQTSA/IHRoaXMub3V0cHV0XyA6IHRoaXMucmV0dXJuXzsKICAgICAgICBpZiAoIXN0b3JlLmlzVGVybWluYWwgIT09IHVuZGVmaW5lZCAmJiAhaXNSZXR1cm5lciAmJiAhYWN0dWFsTmV4dEJsb2NrKSB7CiAgICAgICAgICB0aGlzLnNldE5leHRTdGF0ZW1lbnQoCiAgICAgICAgICAgICFzdG9yZS5pc1Rlcm1pbmFsLAogICAgICAgICAgICB0aGlzLnR5cGUgPT09ICJwcm9jZWR1cmVzX3Byb3RvdHlwZSIgPyB0cnVlIDogaXNQTSA/ICJub3JtYWwiIDogdW5kZWZpbmVkCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUaGUgaW5zZXJ0aW9uIG1hcmtlciBzaG91bGQgY29weSB0aGUgdGVybWluYWwtbmVzcyBvZiB0aGUgc291cmNlIGJsb2NrLAogICAgICAgIC8vIG90aGVyd2lzZSBCbG9ja2x5IHdpbGwgdGhyb3cgYW4gZXJyb3IKICAgICAgICBjb25zdCB0YXJnZXRCbG9jayA9IHRoaXMud29ya3NwYWNlPy5jdXJyZW50R2VzdHVyZV8/LnRhcmdldEJsb2NrXzsKICAgICAgICAvLyB0YXJnZXRCbG9jayBkb2Vzbid0IGV4aXN0IHdoZW4gZHJhZ2dpbmcgdG8gdGhlIHN0YXJ0IG9mIGEgc3RhY2sKICAgICAgICAvLyBJbiB0aGlzIGNhc2UsIGl0IHNob3VsZCBhbHdheXMgYmUgYSBzdGFjayBibG9jawogICAgICAgIHRoaXMuc2V0TmV4dFN0YXRlbWVudCh0YXJnZXRCbG9jayA/ICEhdGFyZ2V0QmxvY2s/Lm5leHRDb25uZWN0aW9uIDogdHJ1ZSwgaXNQTSA/ICJub3JtYWwiIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBvcGNvZGUgb2YgWyJwcm9jZWR1cmVzX2NhbGwiLCAicHJvY2VkdXJlc19wcm90b3R5cGUiLCAicHJvY2VkdXJlc19kZWNsYXJhdGlvbiJdKSB7CiAgICAgIFNCLkJsb2Nrc1tvcGNvZGVdLnVwZGF0ZURpc3BsYXlfID0gdXRpbHMudXBkYXRlRGlzcGxheV87CiAgICB9CgogICAgY29uc3Qgb2dBdHRhY2hTaGFkb3cgPSB1dGlscy5hdHRhY2hTaGFkb3dfOwogICAgdXRpbHMuYXR0YWNoU2hhZG93XyA9IGZ1bmN0aW9uKGlucHV0LCBhcmd1bWVudFR5cGUpIHsKICAgICAgaWYgKGV4dGVuc2lvblJlbW92YWJsZSkgcmV0dXJuIG9nQXR0YWNoU2hhZG93LmNhbGwodGhpcywgaW5wdXQsIGFyZ3VtZW50VHlwZSk7CiAgICAgIGNvbnN0IHN0b3JlID0gdGhpcy5TUG1icENTVF9zdG9yZSB8fCBzdG9yZUdldCh0aGlzLmdldFByb2NDb2RlKCkpOwogICAgICBpZiAoIXN0b3JlIHx8ICFzdG9yZS5pbnB1dHMgfHwgIXN0b3JlLmlucHV0c1tpbnB1dC5uYW1lXSkgcmV0dXJuIG9nQXR0YWNoU2hhZG93LmNhbGwodGhpcywgaW5wdXQsIGFyZ3VtZW50VHlwZSk7CiAgICAgIGNvbnN0IHsgb3Bjb2RlLCBmaWVsZE5hbWUsIGRlZmF1bHRWYWx1ZSB9ID0gZ2V0SW5wdXREYXRhKHN0b3JlLmlucHV0c1tpbnB1dC5uYW1lXSk7CiAgICAgIGlmICghb3Bjb2RlKSByZXR1cm4gb2dBdHRhY2hTaGFkb3cuY2FsbCh0aGlzLCBpbnB1dCwgYXJndW1lbnRUeXBlKTsKICAgICAgaWYgKG9wY29kZSA9PT0gImJyYyIgfHwgb3Bjb2RlID09PSAiZW1wIiB8fCBvcGNvZGUgPT09ICJpbWciKSByZXR1cm47IC8vIHRoZXNlIGFyZSBzcGVjaWFsCgogICAgICAvLyBBZGQgY3VzdG9tIGlucHV0cwogICAgICBjb25zdCBibG9ja1R5cGUgPSBvcGNvZGU7CiAgICAgIFNCLkV2ZW50cy5kaXNhYmxlKCk7CiAgICAgIGxldCBuZXdCbG9jazsKICAgICAgdHJ5IHsKICAgICAgICBuZXdCbG9jayA9IHRoaXMud29ya3NwYWNlLm5ld0Jsb2NrKGJsb2NrVHlwZSk7CiAgICAgICAgaWYgKGZpZWxkTmFtZSkgbmV3QmxvY2suc2V0RmllbGRWYWx1ZShkZWZhdWx0VmFsdWUgaW5zdGFuY2VvZiBGdW5jdGlvbiA/IGRlZmF1bHRWYWx1ZSgpIDogZGVmYXVsdFZhbHVlLCBmaWVsZE5hbWUpOwogICAgICAgIG5ld0Jsb2NrLnNldFNoYWRvdyh0cnVlKTsKICAgICAgICBpZiAoIXRoaXMuaXNJbnNlcnRpb25NYXJrZXIoKSkgewogICAgICAgICAgbmV3QmxvY2suaW5pdFN2ZygpOwogICAgICAgICAgbmV3QmxvY2sucmVuZGVyKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgU0IuRXZlbnRzLmVuYWJsZSgpOwogICAgICB9CiAgICAgIGlmIChTQi5FdmVudHMuaXNFbmFibGVkKCkpIFNCLkV2ZW50cy5maXJlKG5ldyBTQi5FdmVudHMuQmxvY2tDcmVhdGUobmV3QmxvY2spKTsKICAgICAgbmV3QmxvY2s/Lm91dHB1dENvbm5lY3Rpb24/LmNvbm5lY3QoaW5wdXQuY29ubmVjdGlvbik7CiAgICB9OwogICAgU0IuQmxvY2tzWyJwcm9jZWR1cmVzX2NhbGwiXS5hdHRhY2hTaGFkb3dfID0gdXRpbHMuYXR0YWNoU2hhZG93XzsKCiAgICBjb25zdCBvZ1BvcEFyZyA9IHV0aWxzLnBvcHVsYXRlQXJndW1lbnRPbkNhbGxlcl87CiAgICB1dGlscy5wb3B1bGF0ZUFyZ3VtZW50T25DYWxsZXJfID0gZnVuY3Rpb24odHlwZSwgaW5kZXgsIGNvbm5lY3Rpb25NYXAsIGlkLCBpbnB1dCkgewogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vVHVyYm9XYXJwL3NjcmF0Y2gtYmxvY2tzL2Jsb2IvZGV2ZWxvcC9ibG9ja3NfdmVydGljYWwvcHJvY2VkdXJlcy5qcyNMNDQ1CiAgICAgIHZhciBvbGRCbG9jayA9IG51bGwsIG9sZFNoYWRvdyA9IG51bGw7CiAgICAgIGlmIChjb25uZWN0aW9uTWFwICYmIChpZCBpbiBjb25uZWN0aW9uTWFwKSkgewogICAgICAgIHZhciBzYXZlSW5mbyA9IGNvbm5lY3Rpb25NYXBbaWRdOwogICAgICAgIG9sZEJsb2NrID0gc2F2ZUluZm9bImJsb2NrIl07CiAgICAgICAgb2xkU2hhZG93ID0gc2F2ZUluZm9bInNoYWRvdyJdOwogICAgICB9CgogICAgICBpZiAoY29ubmVjdGlvbk1hcCAmJiBvbGRCbG9jaykgewogICAgICAgIC8vIFJlYXR0YWNoIHRoZSBvbGQgYmxvY2sgYW5kIHNoYWRvdyBET00uCiAgICAgICAgY29ubmVjdGlvbk1hcFtpbnB1dC5uYW1lXSA9IG51bGw7CiAgICAgICAgaWYgKG9sZFNoYWRvdyA9PT0gbnVsbCAmJiBvbGRCbG9jay5vdXRwdXRDb25uZWN0aW9uID09PSBudWxsKSB7CiAgICAgICAgICAvLyB0aGlzIGlzIGEgYnJhbmNoCiAgICAgICAgICBjb25zdCBwYXJlbnQgPSBpbnB1dC5jb25uZWN0aW9uLnNvdXJjZUJsb2NrXzsKICAgICAgICAgIGlmIChpc1BNICYmIHRoaXMub3V0cHV0XykgcmV0dXJuOwogICAgICAgICAgY29uc3QgYnJhbmNoSW5kZXggPSBwYXJlbnQuaW5wdXRMaXN0LmluZGV4T2YoaW5wdXQpOwogICAgICAgICAgcGFyZW50LmlucHV0TGlzdFticmFuY2hJbmRleF0uY29ubmVjdGlvbi50eXBlID0gMzsKICAgICAgICAgIHBhcmVudC5pbnB1dExpc3RbYnJhbmNoSW5kZXhdLnR5cGUgPSAzOwogICAgICAgICAgcGFyZW50LmlucHV0TGlzdFticmFuY2hJbmRleF0uY29ubmVjdGlvbi5jb25uZWN0KG9sZEJsb2NrLnByZXZpb3VzQ29ubmVjdGlvbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9sZEJsb2NrLm91dHB1dENvbm5lY3Rpb24uY29ubmVjdChpbnB1dC5jb25uZWN0aW9uKTsKICAgICAgICAgIGlmICh0eXBlICE9ICJiIiAmJiB0aGlzLmdlbmVyYXRlU2hhZG93c18pIHsKICAgICAgICAgICAgdmFyIHNoYWRvd0RvbSA9IG9sZFNoYWRvdyB8fCB0aGlzLmJ1aWxkU2hhZG93RG9tXyh0eXBlKTsKICAgICAgICAgICAgaW5wdXQuY29ubmVjdGlvbi5zZXRTaGFkb3dEb20oc2hhZG93RG9tKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy5nZW5lcmF0ZVNoYWRvd3NfKSB7CiAgICAgICAgdGhpcy5hdHRhY2hTaGFkb3dfKGlucHV0LCB0eXBlKTsKICAgICAgfQogICAgfTsKICAgIFNCLkJsb2Nrc1sicHJvY2VkdXJlc19jYWxsIl0ucG9wdWxhdGVBcmd1bWVudF8gPSB1dGlscy5wb3B1bGF0ZUFyZ3VtZW50T25DYWxsZXJfOwoKICAgIGZ1bmN0aW9uIHVwZGF0ZUFyZ3VtZW50UmVwb3J0ZXJDb2xvcihibG9jaywgZGVmaW5lQmxvY2sgPSBudWxsKSB7CiAgICAgIC8vIEp1c3Qgc3RvcHBlZCBkcmFnZ2luZyAoYW5kIGRyb3BwaW5nKSwgdXBkYXRlIGNvbG9yIGFjY29yZGluZyB0byB0aGUgdG9wIGRlZmluZSBibG9jawogICAgICBpZiAoZXh0ZW5zaW9uUmVtb3ZhYmxlKSByZXR1cm47CiAgICAgIGlmICghZGVmaW5lQmxvY2spIHsKICAgICAgICBkZWZpbmVCbG9jayA9IGJsb2NrOwogICAgICAgIHdoaWxlIChkZWZpbmVCbG9jaz8uZ2V0UGFyZW50KCkpIHsgZGVmaW5lQmxvY2sgPSBkZWZpbmVCbG9jaz8uZ2V0UGFyZW50KCkgfQogICAgICB9CiAgICAgIGlmIChkZWZpbmVCbG9jaz8udHlwZS5zdGFydHNXaXRoKCJwcm9jZWR1cmVzX2RlZmluaXRpb24iKSkgewogICAgICAgIGlmIChibG9ja1t0YXJnZXRQcm9jRGF0YV0gPT09ICJicmFuY2hEcmFnIikgewogICAgICAgICAgYmxvY2suc2V0Q29sb3VyKGRlZmluZUJsb2NrLmNvbG91clNlY29uZGFyeV8sIGRlZmluZUJsb2NrLmNvbG91clNlY29uZGFyeV8sIGRlZmluZUJsb2NrLmNvbG91clRlcnRpYXJ5Xyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJsb2NrLnNldENvbG91cihkZWZpbmVCbG9jay5jb2xvdXJfLCBkZWZpbmVCbG9jay5jb2xvdXJTZWNvbmRhcnlfLCBkZWZpbmVCbG9jay5jb2xvdXJUZXJ0aWFyeV8pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBibG9jay5zZXRDb2xvdXIoLi4uT2JqZWN0LnZhbHVlcyhTQi5Db2xvdXJzLm1vcmUpKTsKICAgICAgfQogICAgICBzeW5jRmllbGRDb2xvcnMoYmxvY2spOwogICAgfQoKICAgIGNvbnN0IG9nU2V0RHJhZ2dpbmcgPSBTQi5CbG9ja1N2Zy5wcm90b3R5cGUuc2V0RHJhZ2dpbmc7CiAgICBjb25zdCBhcmd1bWVudFJlcG9ydGVyU2V0RHJhZ2dpbmcgPSBmdW5jdGlvbihhZGRpbmcpIHsKICAgICAgaWYgKCFhZGRpbmcgJiYgIWV4dGVuc2lvblJlbW92YWJsZSAmJiB0aGlzLnN2Z0dyb3VwXy5jbGFzc0xpc3QuY29udGFpbnMoImJsb2NrbHlEcmFnZ2luZyIpKSB7CiAgICAgICAgcXVldWVNaWNyb3Rhc2soKCkgPT4gdXBkYXRlQXJndW1lbnRSZXBvcnRlckNvbG9yKHRoaXMpKTsKICAgICAgfQogICAgICBvZ1NldERyYWdnaW5nLmNhbGwodGhpcywgYWRkaW5nKTsKICAgIH07CiAgICAvLyB0aGlzIHdvdWxkIHJ1biB3aGVuIHRoZSBibG9jayBpcyBhZGRlZCB0byB0aGUgd29ya3NwYWNlCiAgICBjb25zdCBvZ1NldFBhcmVudCA9IFNCLkJsb2NrU3ZnLnByb3RvdHlwZS5zZXRQYXJlbnQ7CiAgICBjb25zdCBhcmd1bWVudFJlcG9ydGVyU2V0UGFyZW50ID0gZnVuY3Rpb24obmV3UGFyZW50KSB7CiAgICAgIGlmIChuZXdQYXJlbnQgJiYgIWV4dGVuc2lvblJlbW92YWJsZSkgcXVldWVNaWNyb3Rhc2soKCkgPT4gdXBkYXRlQXJndW1lbnRSZXBvcnRlckNvbG9yKHRoaXMpKTsKICAgICAgb2dTZXRQYXJlbnQuY2FsbCh0aGlzLCBuZXdQYXJlbnQpOwogICAgfTsKCiAgICBmb3IgKGNvbnN0IG9wY29kZSBvZiByZWNvbG9yYWJsZXMpIHsKICAgICAgaWYgKCFTQi5CbG9ja3Nbb3Bjb2RlXSkgY29udGludWU7CiAgICAgIFNCLkJsb2Nrc1tvcGNvZGVdLnNldERyYWdnaW5nID0gYXJndW1lbnRSZXBvcnRlclNldERyYWdnaW5nOwogICAgICBTQi5CbG9ja3Nbb3Bjb2RlXS5zZXRQYXJlbnQgPSBhcmd1bWVudFJlcG9ydGVyU2V0UGFyZW50OwogICAgfQogICAgdHJ5IHsKICAgICAgU0IuRXh0ZW5zaW9ucy5yZWdpc3RlcigiU1BtYnBDU1RfZGVmaW5lQ29sb3JlZCIsIGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuc2V0RHJhZ2dpbmcgPSBhcmd1bWVudFJlcG9ydGVyU2V0RHJhZ2dpbmc7CiAgICAgICAgdGhpcy5zZXRQYXJlbnQgPSBhcmd1bWVudFJlcG9ydGVyU2V0UGFyZW50OwogICAgICAgIHVwZGF0ZUFyZ3VtZW50UmVwb3J0ZXJDb2xvcih0aGlzKTsKICAgICAgfSk7CiAgICB9IGNhdGNoIHsvKiBhbHJlYWR5IGRlZmluZWQgKi99CgogICAgLy8gVHVybiBwcm9jZWR1cmUgY2FsbHMgbWFya2VkIGFzIGNhcCBibG9ja3MgaW50byBjYXAgYmxvY2tzIGlmIHRoZXkgY2FuIGJlIHR1cm5lZCBpbnRvIGNhcCBibG9ja3MKICAgIGZ1bmN0aW9uIGNoZWNrQ2FwQmxvY2soYmxvY2spIHsKICAgICAgaWYgKCFibG9jay5pc0luc2VydGlvbk1hcmtlcigpKSB7CiAgICAgICAgY29uc3Qgc3RvcmUgPSBzdG9yZUdldChibG9jay5wcm9jQ29kZV8pOwogICAgICAgIGlmIChzdG9yZSAmJiBzdG9yZS5pc1Rlcm1pbmFsICYmIGJsb2NrLm5leHRDb25uZWN0aW9uICYmICFibG9jay5nZXROZXh0QmxvY2soKSkKICAgICAgICAgIGJsb2NrLnNldE5leHRTdGF0ZW1lbnQoIXN0b3JlLmlzVGVybWluYWwsIGlzUE0gPyAibm9ybWFsIiA6IHVuZGVmaW5lZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVGhlIGluc2VydGlvbiBtYXJrZXIgc2hvdWxkIGNvcHkgdGhlIG5leHQgY29ubmVjdGlvbiBvZiB0aGUgc291cmNlIGJsb2NrCiAgICAgICAgYmxvY2suc2V0TmV4dFN0YXRlbWVudChCb29sZWFuKGJsb2NrLmdldE5leHRCbG9jaygpKSwgaXNQTSA/ICJub3JtYWwiIDogdW5kZWZpbmVkKTsKICAgICAgfQogICAgfQogICAgLy8gRm9yIHRoZSBwcmV2aW91cyBibG9jayB3aGVuIHN0YXJ0aW5nIGEgZHJhZyBvZiB0aGUgY3VycmVudCBibG9jawogICAgY29uc3Qgb2dVbnBsdWcgPSBTQi5CbG9jay5wcm90b3R5cGUudW5wbHVnOwogICAgY29uc3QgcHJvY0NhbGxVbnBsdWcgPSBmdW5jdGlvbihvcHRfaGVhbFN0YWNrKSB7CiAgICAgIGlmIChleHRlbnNpb25SZW1vdmFibGUgfHwgdGhpcy5pc0luc2VydGlvbk1hcmtlcigpIHx8IHRoaXMuZ2V0UGFyZW50KCk/LmlzSW5zZXJ0aW9uTWFya2VyKCkpIHJldHVybiBvZ1VucGx1Zy5jYWxsKHRoaXMsIG9wdF9oZWFsU3RhY2spOwogICAgICBjb25zdCBwYXJlbnQgPSB0aGlzLmdldFBhcmVudCgpOwogICAgICBvZ1VucGx1Zy5jYWxsKHRoaXMsIG9wdF9oZWFsU3RhY2spOwogICAgICBjaGVja0NhcEJsb2NrKHRoaXMpOwogICAgICBpZiAocGFyZW50KSBjaGVja0NhcEJsb2NrKHBhcmVudCk7CiAgICB9OwogICAgU0IuQmxvY2tzWyJwcm9jZWR1cmVzX2NhbGwiXS51bnBsdWcgPSBwcm9jQ2FsbFVucGx1ZzsKCiAgICAvLyBDb3B5IHRoZSBkZWZpbmUgYmxvY2sncyBhcmd1bWVudCBjb2xvciB3aGVuIGRyYWdnaW5nIGFuIGFyZ3VtZW50IHJlcG9ydGVyCiAgICBjb25zdCBvbGREdXBsaWNhdGVPbkRyYWdfID0gU0IuR2VzdHVyZS5wcm90b3R5cGUuZHVwbGljYXRlT25EcmFnXzsKICAgIFNCLkdlc3R1cmUucHJvdG90eXBlLmR1cGxpY2F0ZU9uRHJhZ18gPSBmdW5jdGlvbigpIHsKICAgICAgY29uc3Qgc291cmNlID0gdGhpcy50YXJnZXRCbG9ja187CiAgICAgIG9sZER1cGxpY2F0ZU9uRHJhZ18uY2FsbCh0aGlzKTsKICAgICAgY29uc3QgZHVwbGljYXRlZCA9IHRoaXMudGFyZ2V0QmxvY2tfOwogICAgICBpZiAoc291cmNlICYmIGR1cGxpY2F0ZWQgJiYgc291cmNlLnR5cGUuc3RhcnRzV2l0aCgiYXJndW1lbnRfcmVwb3J0ZXJfIikpCiAgICAgICAgZHVwbGljYXRlZC5zZXRDb2xvdXIoc291cmNlLmNvbG91cl8sIHNvdXJjZS5jb2xvdXJTZWNvbmRhcnlfLCBzb3VyY2UuY29sb3VyVGVydGlhcnlfKTsKICAgIH07CgogICAgLy8gRGlzYWJsZSBicmFuY2ggYXJndW1lbnQgcmVwb3J0ZXIgZHJhZ2dpbmcKICAgIGNvbnN0IG9sZHN0YXJ0RHJhZ2dpbmdfID0gU0IuR2VzdHVyZS5wcm90b3R5cGUuc3RhcnREcmFnZ2luZ0Jsb2NrXzsKICAgIFNCLkdlc3R1cmUucHJvdG90eXBlLnN0YXJ0RHJhZ2dpbmdCbG9ja18gPSBmdW5jdGlvbigpIHsKICAgICAgY29uc3Qgc291cmNlID0gdGhpcy50YXJnZXRCbG9ja187CiAgICAgIGlmIChzb3VyY2VbdGFyZ2V0UHJvY0RhdGFdID09PSAiYnJhbmNoRHJhZyIpIHsKICAgICAgICB0aGlzLmlzRHJhZ2dpbmdCbG9ja18gPSBmYWxzZTsKICAgICAgICB0aGlzLmRpc3Bvc2UoKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgb2xkc3RhcnREcmFnZ2luZ18uY2FsbCh0aGlzKTsKICAgIH07CgogICAgLy8gUGF0Y2ggUHJvY2VkdXJlIEVkaXQgYW5kIENyZWF0ZSB0byBhbHNvIG9wZW4gb3VyIE1vZGFsCiAgICBjb25zdCBwcm9jcyA9IFNCLlByb2NlZHVyZXM7CiAgICBjb25zdCBvZ0NyZWF0ZUNhbGwgPSBwcm9jcy5jcmVhdGVQcm9jZWR1cmVEZWZDYWxsYmFja187CiAgICBpZiAocnVudGltZS5TUG1icENTVE9sZFN0b3JhZ2UgPT09IHVuZGVmaW5lZCkgewogICAgICBwcm9jcy5jcmVhdGVQcm9jZWR1cmVEZWZDYWxsYmFja18gPSBmdW5jdGlvbih3b3Jrc3BhY2UpIHsKICAgICAgICBjb25zdCBzaGFyZWRXb3JrID0gU0IubWFpbldvcmtzcGFjZTsKICAgICAgICBvZ0NyZWF0ZUNhbGwuY2FsbCh0aGlzLCB3b3Jrc3BhY2UpOwogICAgICAgIG9wZW5CbG9ja01ha2VyKHNoYXJlZFdvcmssIGZhbHNlKTsKICAgICAgfTsKICAgICAgY29uc3Qgb2dFZGl0Q2FsbCA9IHByb2NzLmVkaXRQcm9jZWR1cmVDYWxsYmFja187CiAgICAgIHByb2NzLmVkaXRQcm9jZWR1cmVDYWxsYmFja18gPSBmdW5jdGlvbihibG9jaykgewogICAgICAgIGlmIChibG9jay50eXBlID09PSAicHJvY2VkdXJlc19jYWxsIikgewogICAgICAgICAgY29uc3QgaXNHbG9iYWwgPSBnbG9iYWxCbG9ja3NDYWNoZVtibG9jay5wcm9jQ29kZV9dOwogICAgICAgICAgaWYgKGlzR2xvYmFsICYmIGlzR2xvYmFsLmlkICE9PSB2bS5lZGl0aW5nVGFyZ2V0LmlkKSB7CiAgICAgICAgICAgIHZtLm9uY2UoIndvcmtzcGFjZVVwZGF0ZSIsICgpID0+IHsKICAgICAgICAgICAgICBjb25zdCBibG9ja0lkID0gdm0uZWRpdGluZ1RhcmdldC5ibG9ja3MuZ2V0UHJvY2VkdXJlRGVmaW5pdGlvbihibG9jay5wcm9jQ29kZV8pOwogICAgICAgICAgICAgIGJsb2NrID0gU0IubWFpbldvcmtzcGFjZS5nZXRCbG9ja0J5SWQoYmxvY2tJZCk7CiAgICAgICAgICAgICAgcmV0dXJuIHByb2NzLmVkaXRQcm9jZWR1cmVDYWxsYmFja18uY2FsbCh0aGlzLCBibG9jayk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2bS5zZXRFZGl0aW5nVGFyZ2V0KGlzR2xvYmFsLmlkKTsKICAgICAgICAgICAgcmV0dXJuOyAKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29uc3Qgc2hhcmVkV29yayA9IFNCLm1haW5Xb3Jrc3BhY2U7CiAgICAgICAgY29uc3QgdmFsID0gb2dFZGl0Q2FsbC5jYWxsKHRoaXMsIGJsb2NrKTsKICAgICAgICBvcGVuQmxvY2tNYWtlcihzaGFyZWRXb3JrLCB0cnVlKTsKICAgICAgICByZXR1cm4gdmFsOwogICAgICB9CiAgICB9CiAgICAvLyBQYXRjaCBQcm9jZWR1cmUgRmx5b3V0IHRvIGFsc28gaW50ZXJhY3Qgd2l0aCB0aGUgZXh0ZW5zaW9uCiAgICBjb25zdCBvZ0ZseW91dENhbGwgPSBwcm9jcy5mbHlvdXRDYXRlZ29yeTsKICAgIHByb2NzLmZseW91dENhdGVnb3J5ID0gZnVuY3Rpb24od29ya3NwYWNlKSB7CiAgICAgIGNvbnN0IHZhbCA9IG9nRmx5b3V0Q2FsbC5jYWxsKHRoaXMsIHdvcmtzcGFjZSk7CiAgICAgIGlmICh2YWwubGVuZ3RoICE9PSBvbGRMaXN0TGVuZ3RoKSBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgY29tcGlsZVByb2NlZHVyZXModmFsLCB3b3Jrc3BhY2UsIHByb2NzKTsKICAgICAgcmV0dXJuIHZhbDsKICAgIH0KICB9KQoKICAvLyBPdGhlciBwYXRjaGVzCiAgZnVuY3Rpb24gcGF0Y2hUYXJnZXQoKSB7CiAgICAvLyBjcmVhdGUgYSB0YXJnZXQgdG8gcGF0Y2ggVGFyZ2V0LkJsb2NrcwogICAgY29uc3QgdGFyZ2V0ID0gbmV3IHZtLmV4cG9ydHMuUmVuZGVyZWRUYXJnZXQoe2Jsb2NrczogbnVsbH0sIHJ1bnRpbWUpOwoKICAgIGNvbnN0IEJsb2NrcyA9IHRhcmdldC5ibG9ja3MuY29uc3RydWN0b3I7CiAgICBjb25zdCBvbGRHZXRQcm9jRGVmID0gQmxvY2tzLnByb3RvdHlwZS5nZXRQcm9jZWR1cmVEZWZpbml0aW9uOwogICAgQmxvY2tzLnByb3RvdHlwZS5nZXRQcm9jZWR1cmVEZWZpbml0aW9uID0gZnVuY3Rpb24obmFtZSkgewogICAgICBjb25zdCBkZWZpbml0aW9uID0gb2xkR2V0UHJvY0RlZi5jYWxsKHRoaXMsIG5hbWUpOwogICAgICBpZiAoIWRlZmluaXRpb24gJiYgZ2xvYmFsQmxvY2tzQ2FjaGVbbmFtZV0gJiYgZ2xvYmFsQmxvY2tzQ2FjaGVbbmFtZV0uYmxvY2tzICE9PSB0aGlzKSB7CiAgICAgICAgcmV0dXJuIGdsb2JhbEJsb2Nrc0NhY2hlW25hbWVdLmJsb2Nrcy5nZXRQcm9jZWR1cmVEZWZpbml0aW9uKG5hbWUpOwogICAgICB9CiAgICAgIHJldHVybiBkZWZpbml0aW9uOwogICAgfQogICAgY29uc3Qgb2xkR2V0QmxvY2sgPSBCbG9ja3MucHJvdG90eXBlLmdldEJsb2NrOwogICAgQmxvY2tzLnByb3RvdHlwZS5nZXRCbG9jayA9IGZ1bmN0aW9uKG5hbWUpIHsKICAgICAgbGV0IHRoaXNCbG9jazsKCiAgICAgIC8vIGdsb2JhbHMgdGFrZSBwcmlvcml0eQogICAgICBpZiAoZ2xvYmFsVGFyZ2V0Rm9jdXMpIHsKICAgICAgICB0aGlzQmxvY2sgPSBvbGRHZXRCbG9jay5jYWxsKGdsb2JhbFRhcmdldEZvY3VzLmJsb2NrcywgbmFtZSk7CiAgICAgICAgaWYgKCF0aGlzQmxvY2sgfHwgdGhpc0Jsb2NrLm5leHQgPT09IG51bGwpIGdsb2JhbFRhcmdldEZvY3VzID0gdW5kZWZpbmVkOwogICAgICAgIGlmICh0aGlzQmxvY2spIHJldHVybiB0aGlzQmxvY2s7CiAgICAgIH0KCiAgICAgIHRoaXNCbG9jayA9IG9sZEdldEJsb2NrLmNhbGwodGhpcywgbmFtZSk7CiAgICAgIGlmICh0aGlzQmxvY2spIHJldHVybiB0aGlzQmxvY2s7CgogICAgICBsZXQgZm9jdXNUYXJnZXQ7CiAgICAgIGZvciAoY29uc3QgdGFyZ2V0IG9mIHRoaXMucnVudGltZS50YXJnZXRzKSB7CiAgICAgICAgaWYgKCF0YXJnZXQuaXNPcmlnaW5hbCB8fCB0YXJnZXQuYmxvY2tzID09PSB0aGlzKSBjb250aW51ZTsKICAgICAgICB0aGlzQmxvY2sgPSBvbGRHZXRCbG9jay5jYWxsKHRhcmdldC5ibG9ja3MsIG5hbWUpOwogICAgICAgIGlmICh0aGlzQmxvY2spIHsKICAgICAgICAgIGZvY3VzVGFyZ2V0ID0gdGFyZ2V0OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpc0Jsb2NrICYmIGdsb2JhbFRhcmdldEZvY3VzID09PSB1bmRlZmluZWQpIGdsb2JhbFRhcmdldEZvY3VzID0gZm9jdXNUYXJnZXQ7CiAgICAgIGVsc2UgaWYgKCF0aGlzQmxvY2sgfHwgdGhpc0Jsb2NrLm5leHQgPT09IG51bGwpIGdsb2JhbFRhcmdldEZvY3VzID0gdW5kZWZpbmVkOwogICAgICByZXR1cm4gdGhpc0Jsb2NrOwogICAgfQogICAgY29uc3Qgb2xkR2V0QnJhbmNoID0gQmxvY2tzLnByb3RvdHlwZS5nZXRCcmFuY2g7CiAgICBCbG9ja3MucHJvdG90eXBlLmdldEJyYW5jaCA9IGZ1bmN0aW9uKGlkLCBicmFuY2hOdW0pIHsKICAgICAgY29uc3QgdGhpc0Jsb2NrID0gb2xkR2V0QnJhbmNoLmNhbGwodGhpcywgaWQsIGJyYW5jaE51bSk7CiAgICAgIGlmICh0aGlzQmxvY2spIHJldHVybiB0aGlzQmxvY2s7CiAgICAgIGZvciAoY29uc3QgdGFyZ2V0IG9mIHRoaXMucnVudGltZS50YXJnZXRzKSB7CiAgICAgICAgaWYgKCF0YXJnZXQuaXNPcmlnaW5hbCB8fCB0YXJnZXQuYmxvY2tzID09PSB0aGlzKSBjb250aW51ZTsKICAgICAgICBjb25zdCB0YXJnZXRCbG9jayA9IG9sZEdldEJyYW5jaC5jYWxsKHRhcmdldC5ibG9ja3MsIGlkLCBicmFuY2hOdW0pOwogICAgICAgIGlmICh0YXJnZXRCbG9jaykgcmV0dXJuIHRhcmdldEJsb2NrOwogICAgICB9CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBjb25zdCBvbGRQb3BQcm9jQ2FjaGUgPSBCbG9ja3MucHJvdG90eXBlLnBvcHVsYXRlUHJvY2VkdXJlQ2FjaGU7CiAgICBCbG9ja3MucHJvdG90eXBlLnBvcHVsYXRlUHJvY2VkdXJlQ2FjaGUgPSBmdW5jdGlvbigpIHsKICAgICAgb2xkUG9wUHJvY0NhY2hlLmNhbGwodGhpcyk7CiAgICAgIHJlZnJlc2hHbG9iYWxCbG9ja3NDYWNoZSgpOwogICAgICBmb3IgKGNvbnN0IHByb2Njb2RlIG9mIE9iamVjdC5rZXlzKGdsb2JhbEJsb2Nrc0NhY2hlKSkgewogICAgICAgIGNvbnN0IHRhcmdldCA9IGdsb2JhbEJsb2Nrc0NhY2hlW3Byb2Njb2RlXTsKICAgICAgICBpZiAodGFyZ2V0LmJsb2NrcyA9PT0gdGhpcykgY29udGludWU7CiAgICAgICAgb2xkUG9wUHJvY0NhY2hlLmNhbGwodGFyZ2V0LmJsb2Nrcyk7CiAgICAgICAgLy8gYWRkIGdsb2JhbCBibG9ja3MgdG8gdGhpcyBjYWNoZSBpZiB0aGV5IGFyZW4ndCBwcmVzZW50IGFscmVhZHkKICAgICAgICB0aGlzLl9jYWNoZS5wcm9jZWR1cmVQYXJhbU5hbWVzW3Byb2Njb2RlXSA9IHRhcmdldC5ibG9ja3MuX2NhY2hlLnByb2NlZHVyZVBhcmFtTmFtZXNbcHJvY2NvZGVdOwogICAgICAgIHRoaXMuX2NhY2hlLnByb2NlZHVyZURlZmluaXRpb25zW3Byb2Njb2RlXSA9IHRhcmdldC5ibG9ja3MuX2NhY2hlLnByb2NlZHVyZURlZmluaXRpb25zW3Byb2Njb2RlXTsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IG9sZEdldElucHV0cyA9IEJsb2Nrcy5wcm90b3R5cGUuZ2V0SW5wdXRzOwogICAgQmxvY2tzLnByb3RvdHlwZS5nZXRJbnB1dHMgPSBmdW5jdGlvbihibG9jaykgewogICAgICBpZiAoYmxvY2sub3Bjb2RlICE9PSAicHJvY2VkdXJlc19jYWxsIikgcmV0dXJuIG9sZEdldElucHV0cy5jYWxsKHRoaXMsIGJsb2NrKTsKCiAgICAgIGlmICh0eXBlb2YgYmxvY2sgPT09ICJ1bmRlZmluZWQiKSByZXR1cm4gbnVsbDsKICAgICAgbGV0IGlucHV0cyA9IHRoaXMuX2NhY2hlLmlucHV0c1tibG9jay5pZF07CiAgICAgIGlmICh0eXBlb2YgaW5wdXRzICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgcmV0dXJuIGlucHV0czsKICAgICAgfQoKICAgICAgbGV0IHN0b3JlVGFyZ2V0ID0gdm0uZWRpdGluZ1RhcmdldDsKICAgICAgZm9yIChjb25zdCB0YXJnZXQgb2YgdGhpcy5ydW50aW1lLnRhcmdldHMpIHsKICAgICAgICBpZiAoIXRhcmdldC5pc09yaWdpbmFsIHx8IHRhcmdldC5ibG9ja3MgIT09IHRoaXMpIGNvbnRpbnVlOwogICAgICAgIHN0b3JlVGFyZ2V0ID0gdGFyZ2V0OwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIAogICAgICBjb25zdCBzdG9yZSA9IHN0b3JlR2V0KGJsb2NrLm11dGF0aW9uLnByb2Njb2RlLCBzdG9yZVRhcmdldCk7CiAgICAgIGlucHV0cyA9IHt9OwogICAgICBmb3IgKGNvbnN0IGlucHV0IGluIGJsb2NrLmlucHV0cykgewogICAgICAgICAgLy8gSWdub3JlIGJsb2NrcyBwcmVmaXhlZCB3aXRoIGJyYW5jaCBwcmVmaXgsIGFuZCBjdXN0b20gYnJhbmNoIGlucHV0cy4KICAgICAgICAgIGlmICgKICAgICAgICAgICAgIXN0b3JlLmlucHV0cyB8fAogICAgICAgICAgICBpbnB1dC5zdWJzdHJpbmcoMCwgQmxvY2tzLkJSQU5DSF9JTlBVVF9QUkVGSVgubGVuZ3RoKSAhPT0gQmxvY2tzLkJSQU5DSF9JTlBVVF9QUkVGSVgKICAgICAgICAgICAgJiYgIShzdG9yZS5pbnB1dHNbaW5wdXRdICYmIHN0b3JlLmlucHV0c1tpbnB1dF0udHlwZSA9PT0gImJyYyIpCiAgICAgICAgICApIGlucHV0c1tpbnB1dF0gPSBibG9jay5pbnB1dHNbaW5wdXRdOwogICAgICB9CiAgICAgIHRoaXMuX2NhY2hlLmlucHV0c1tibG9jay5pZF0gPSBpbnB1dHM7CiAgICAgIHJldHVybiBpbnB1dHM7CiAgICB9CiAgfQogIHBhdGNoVGFyZ2V0KCk7CgogIGlmIChydW50aW1lLnRhcmdldHMubGVuZ3RoKSB7CiAgICAvLyBNYWtlIHRoZSBleHRlbnNpb24gc3RheSBieSBhZGRpbmcgYSBkdW1teSBibG9jawogICAgY29uc3QgYmxvY2tzID0gcnVudGltZS50YXJnZXRzWzBdLmJsb2NrczsKICAgIGJsb2Nrcy5fYmxvY2tzW1RFTVBfQkxPQ0tfT1BDT0RFXSA9IHsKICAgICAgb3Bjb2RlOiBURU1QX0JMT0NLX09QQ09ERSwgaWQ6IFRFTVBfQkxPQ0tfT1BDT0RFLCBmaWVsZHM6IHt9LAogICAgICBuZXh0OiBudWxsLCBwYXJlbnQ6IG51bGwsIHNoYWRvdzogdHJ1ZSwgdG9MZXZlbDogdHJ1ZSwKICAgICAgeDogdW5kZWZpbmVkLCB5OiB1bmRlZmluZWQKICAgIH0KICB9CiAgLy8gcHJvamVjdCBsb2FkZWQsIGFkZCBpbiB0aGUgdGVtcCBibG9jayBpZiBpdCBpc250IHRoZXJlCiAgcnVudGltZS5vbmNlKCJQUk9KRUNUX0xPQURFRCIsICgpID0+IHsKICAgIGZvciAoY29uc3QgdGFyZ2V0IG9mIHJ1bnRpbWUudGFyZ2V0cykgewogICAgICBjb25zdCBibG9ja3MgPSBPYmplY3QudmFsdWVzKHRhcmdldC5ibG9ja3MuX2Jsb2NrcykKICAgICAgaWYgKGJsb2Nrcy5zb21lKGJsb2NrID0+IGJsb2NrLm9wY29kZSA9PT0gVEVNUF9CTE9DS19PUENPREUpKSByZXR1cm47CiAgICB9CiAgICBjb25zdCBibG9ja3MgPSBydW50aW1lLnRhcmdldHNbMF0uYmxvY2tzOwogICAgYmxvY2tzLl9ibG9ja3NbVEVNUF9CTE9DS19PUENPREVdID0gewogICAgICBvcGNvZGU6IFRFTVBfQkxPQ0tfT1BDT0RFLCBpZDogVEVNUF9CTE9DS19PUENPREUsIGZpZWxkczoge30sCiAgICAgIG5leHQ6IG51bGwsIHBhcmVudDogbnVsbCwgc2hhZG93OiB0cnVlLCB0b0xldmVsOiB0cnVlLAogICAgICB4OiB1bmRlZmluZWQsIHk6IHVuZGVmaW5lZAogICAgfQogIH0pOwogIGNvbnN0IG9sZFRvSlNPTiA9IHZtLmNvbnN0cnVjdG9yLnByb3RvdHlwZS50b0pTT047CiAgdm0uY29uc3RydWN0b3IucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICAgIGlmIChleHRlbnNpb25SZW1vdmFibGUpIHJldHVybiBvbGRUb0pTT04uYXBwbHkodGhpcywgYXJncyk7CiAgICBpZiAoIWlzUE0pIHsKICAgICAgLy8gcGVuZ3Vpbm1vZCBhdXRvbWF0aWNhbGx5IGRvZXMgdGhpcwogICAgICBzdXNwZW5kUmVtb3ZhbCA9IGZhbHNlOwogICAgICByZW1vdmVVbnVzZWRQcm9jcygpOwogICAgICByZW1vdmVVbnVzZWRJbWFnZXMoKTsKICAgICAgZXh0Py5zZXJpYWxpemUoKTsKICAgIH0KCiAgICBjb25zdCBqc29uU3RyID0gb2xkVG9KU09OLmFwcGx5KHRoaXMsIGFyZ3MpOwogICAgcmV0dXJuIGpzb25TdHI7CiAgfQoKICBjb25zdCBvbGRHZXRPcGNvZGUgPSBydW50aW1lLmdldE9wY29kZUZ1bmN0aW9uOwogIHJ1bnRpbWUuY29uc3RydWN0b3IucHJvdG90eXBlLmdldE9wY29kZUZ1bmN0aW9uID0gZnVuY3Rpb24ob3Bjb2RlKSB7CiAgICBpZiAob3Bjb2RlID09PSAicHJvY2VkdXJlc19jYWxsIikgcmV0dXJuIHBhdGNoZWRDYWxsRnVuYzsKICAgIHJldHVybiBvbGRHZXRPcGNvZGUuY2FsbCh0aGlzLCBvcGNvZGUpOwogIH0KCiAgY29uc3QgcGF0Y2hlZENhbGxGdW5jID0gKGFyZ3MsIHV0aWwpID0+IHsKICAgIC8vIFBhdGNoZWQgQmxvY2sgY29kZSBmcm9tOgogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL1R1cmJvV2FycC9zY3JhdGNoLXZtL2Jsb2IvZGV2ZWxvcC9zcmMvYmxvY2tzL3NjcmF0Y2gzX3Byb2NlZHVyZXMuanMjTDI4LUw4MgogICAgY29uc3QgdGhyZWFkID0gdXRpbC50aHJlYWQ7CiAgICBjb25zdCBzdGFja0ZyYW1lID0gdXRpbC5zdGFja0ZyYW1lOwogICAgY29uc3QgaXNSZXBvcnRlciA9ICEhYXJncy5tdXRhdGlvbi5yZXR1cm47CiAgICBpZiAoc3RhY2tGcmFtZS5leGVjdXRlZCkgewogICAgICBpZiAodGhyZWFkLmlzTUJQUGF0Y2hlZCkgewogICAgICAgIC8vIHBhdGNoIHRoaXMgZnVuY3Rpb24gZm9yIHRoZSB0aHJlYWQKICAgICAgICB0aHJlYWQuaXNNQlBQYXRjaGVkID0gdW5kZWZpbmVkOwogICAgICAgIHRocmVhZC50YXJnZXQuYmxvY2tzLmdldE5leHRCbG9jayA9IHRocmVhZFt0YXJnZXRQcm9jRGF0YV0ub2dOZXh0OwogICAgICB9CiAgICAgIGlmIChpc1JlcG9ydGVyKSB7CiAgICAgICAgY29uc3QgcmV0dXJuVmFsdWUgPSBzdGFja0ZyYW1lLnJldHVyblZhbHVlOwogICAgICAgIGNvbnN0IHRocmVhZFN0YWNrRnJhbWUgPSB0aHJlYWQucGVla1N0YWNrRnJhbWUoKTsKICAgICAgICB0aHJlYWRTdGFja0ZyYW1lLnBhcmFtcyA9IG51bGw7CiAgICAgICAgZGVsZXRlIHN0YWNrRnJhbWUucmV0dXJuVmFsdWU7CiAgICAgICAgZGVsZXRlIHN0YWNrRnJhbWUuZXhlY3V0ZWQ7CiAgICAgICAgcmV0dXJuIHJldHVyblZhbHVlOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBwcm9jZWR1cmVDb2RlID0gYXJncy5tdXRhdGlvbi5wcm9jY29kZTsKICAgIGxldCBpc0dsb2JhbCA9IGdsb2JhbEJsb2Nrc0NhY2hlW3Byb2NlZHVyZUNvZGVdOwogICAgaWYgKGlzR2xvYmFsICYmIGlzR2xvYmFsLmlkID09PSB1dGlsLnRhcmdldC5zcHJpdGUuY2xvbmVzWzBdLmlkKSBpc0dsb2JhbCA9IHVuZGVmaW5lZDsKCiAgICBjb25zdCBwYXJhbU5hbWVzSWRzQW5kRGVmYXVsdHMgPSAoaXNHbG9iYWwgPyBpc0dsb2JhbC5ibG9ja3MgOiB1dGlsKS5nZXRQcm9jZWR1cmVQYXJhbU5hbWVzSWRzQW5kRGVmYXVsdHMocHJvY2VkdXJlQ29kZSk7CiAgICBpZiAocGFyYW1OYW1lc0lkc0FuZERlZmF1bHRzID09PSBudWxsKSB7CiAgICAgIGlmIChpc1JlcG9ydGVyKSByZXR1cm4gIiI7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBbcGFyYW1OYW1lcywgcGFyYW1JZHMsIHBhcmFtRGVmYXVsdHNdID0gcGFyYW1OYW1lc0lkc0FuZERlZmF1bHRzOwogICAgdXRpbC5pbml0UGFyYW1zKCk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhcmFtSWRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYXJncywgcGFyYW1JZHNbaV0pKSB1dGlsLnB1c2hQYXJhbShwYXJhbU5hbWVzW2ldLCBhcmdzW3BhcmFtSWRzW2ldXSk7CiAgICAgIGVsc2UgdXRpbC5wdXNoUGFyYW0ocGFyYW1OYW1lc1tpXSwgcGFyYW1EZWZhdWx0c1tpXSk7CiAgICB9CgogICAgY29uc3QgYWRkb25CbG9jayA9IHV0aWwucnVudGltZS5nZXRBZGRvbkJsb2NrKHByb2NlZHVyZUNvZGUpOwogICAgaWYgKGFkZG9uQmxvY2spIHsKICAgICAgY29uc3QgcmVzdWx0ID0gYWRkb25CbG9jay5jYWxsYmFjayh0aHJlYWQuZ2V0QWxscGFyYW1zKCksIHV0aWwpOwogICAgICBpZiAodGhyZWFkLnN0YXR1cyA9PT0gMSkgc3RhY2tGcmFtZS5leGVjdXRlZCA9IHRydWU7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgc3RhY2tGcmFtZS5leGVjdXRlZCA9IHRydWU7CiAgICBjb25zdCBmcmFtZSA9IHRocmVhZC5wZWVrU3RhY2tGcmFtZSgpOwogICAgaWYgKGlzUmVwb3J0ZXIpIHsKICAgICAgZnJhbWUud2FpdGluZ1JlcG9ydGVyID0gdHJ1ZTsKICAgICAgc3RhY2tGcmFtZS5yZXR1cm5WYWx1ZSA9ICIiOwogICAgfQogICAgdGhyZWFkW3RhcmdldFByb2NEYXRhXSA9IHsKICAgICAgb2dOZXh0OiB0aHJlYWQudGFyZ2V0LmJsb2Nrcy5nZXROZXh0QmxvY2ssCiAgICAgIGJsb2NrOiBmcmFtZS5vcCwgZnJhbWUsCiAgICAgIHBhcmFtczogcGFyYW1OYW1lc0lkc0FuZERlZmF1bHRzCiAgICB9OwogICAgdXRpbC5zdGFydFByb2NlZHVyZSh7IHByb2M6IHByb2NlZHVyZUNvZGUsIGlzR2xvYmFsIH0pOwogIH07CgogIGNvbnN0IG9sZFN0ZXAyUHJvYyA9IHJ1bnRpbWUuc2VxdWVuY2VyLnN0ZXBUb1Byb2NlZHVyZTsKICBydW50aW1lLnNlcXVlbmNlci5jb25zdHJ1Y3Rvci5wcm90b3R5cGUuc3RlcFRvUHJvY2VkdXJlID0gZnVuY3Rpb24odGhyZWFkLCBwcm9jZWR1cmVDb2RlKSB7CiAgICBpZiAocHJvY2VkdXJlQ29kZS5pc0dsb2JhbCA9PT0gdW5kZWZpbmVkKSBvbGRTdGVwMlByb2MuY2FsbCh0aGlzLCB0aHJlYWQsIHByb2NlZHVyZUNvZGUucHJvYyk7CiAgICBlbHNlIHsKICAgICAgY29uc3Qgb2dUYXJnZXQgPSBwcm9jZWR1cmVDb2RlLmlzR2xvYmFsOwogICAgICBjb25zdCBkZWYgPSBvZ1RhcmdldC5ibG9ja3MuZ2V0UHJvY2VkdXJlRGVmaW5pdGlvbihwcm9jZWR1cmVDb2RlLnByb2MpOwogICAgICBpZiAoIWRlZikgcmV0dXJuOwogICAgICBpZiAodGhyZWFkLmlzTUJQUGF0Y2hlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gcGF0Y2ggdGhpcyBmdW5jdGlvbiBmb3IgdGhlIHRocmVhZAogICAgICAgIHRocmVhZC5pc01CUFBhdGNoZWQgPSB0cnVlOwogICAgICAgIGNvbnN0IG9nR2V0TmV4dCA9IHRocmVhZC50YXJnZXQuYmxvY2tzLmdldE5leHRCbG9jazsKICAgICAgICB0aHJlYWQudGFyZ2V0LmJsb2Nrcy5nZXROZXh0QmxvY2sgPSBmdW5jdGlvbihpZCkgewogICAgICAgICAgY29uc3QgYmxvY2sgPSBvZ0dldE5leHQuY2FsbCh0aGlzLCBpZCk7CiAgICAgICAgICBpZiAoYmxvY2spIHJldHVybiBibG9jazsKICAgICAgICAgIGVsc2UgcmV0dXJuIG9nVGFyZ2V0LmJsb2Nrcy5nZXROZXh0QmxvY2soaWQpID8/IG51bGw7CiAgICAgICAgfQogICAgICB9CgogICAgICBjb25zdCBpc1JlY3Vyc2l2ZSA9IHRocmVhZC5pc1JlY3Vyc2l2ZUNhbGwocHJvY2VkdXJlQ29kZS5wcm9jKTsKICAgICAgdGhyZWFkLnB1c2hTdGFjayhkZWYpOwogICAgICBpZiAodGhyZWFkLnBlZWtTdGFja0ZyYW1lKCkud2FycE1vZGUgJiYgdGhyZWFkLndhcnBUaW1lci50aW1lRWxhcHNlZCgpID4gU2VxdWVuY2VyLldBUlBfVElNRSkgdGhyZWFkLnN0YXR1cyA9IFRocmVhZC5TVEFUVVNfWUlFTEQ7CiAgICAgIGVsc2UgewogICAgICAgIGNvbnN0IGRlZkJsb2NrID0gb2dUYXJnZXQuYmxvY2tzLmdldEJsb2NrKGRlZik7CiAgICAgICAgY29uc3QgaW5uZXJCbG9jayA9IG9nVGFyZ2V0LmJsb2Nrcy5nZXRCbG9jayhkZWZCbG9jay5pbnB1dHMuY3VzdG9tX2Jsb2NrLmJsb2NrKTsKICAgICAgICBsZXQgZG9XYXJwID0gZmFsc2U7CiAgICAgICAgaWYgKGlubmVyQmxvY2sgJiYgaW5uZXJCbG9jay5tdXRhdGlvbikgewogICAgICAgICAgY29uc3Qgd2FycCA9IGlubmVyQmxvY2subXV0YXRpb24ud2FycDsKICAgICAgICAgIGlmICh0eXBlb2Ygd2FycCA9PT0gImJvb2xlYW4iKSBkb1dhcnAgPSB3YXJwOwogICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHdhcnAgPT09ICJzdHJpbmciKSBkb1dhcnAgPSBKU09OLnBhcnNlKHdhcnApOwogICAgICAgIH0KICAgICAgICBpZiAoZG9XYXJwKSB0aHJlYWQucGVla1N0YWNrRnJhbWUoKS53YXJwTW9kZSA9IHRydWU7CiAgICAgICAgZWxzZSBpZiAoaXNSZWN1cnNpdmUpIHRocmVhZC5zdGF0dXMgPSBUaHJlYWQuU1RBVFVTX1lJRUxEOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBJbnRlcm5hbHMKICAvLyBSZW1vdmUgdW51c2VkIHByb2NlZHVyZXMgYmVmb3JlIHNhdmluZwogIGZ1bmN0aW9uIHJlbW92ZVVudXNlZFByb2NzKCkgewogICAgaWYgKHN1c3BlbmRSZW1vdmFsKSByZXR1cm47CiAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiBydW50aW1lLnRhcmdldHMpIHsKICAgICAgZm9yIChjb25zdCBwcm9jY29kZSBvZiBPYmplY3Qua2V5cyhzdG9yYWdlW3RhcmdldC5pZF0gfHwge30pKSB7CiAgICAgICAgaWYgKCF0YXJnZXQuYmxvY2tzLmdldFByb2NlZHVyZURlZmluaXRpb24ocHJvY2NvZGUpKSBkZWxldGUgc3RvcmFnZVt0YXJnZXQuaWRdW3Byb2Njb2RlXTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gUmVtb3ZlIHVudXNlZCBpbWFnZXMgYmVmb3JlIHNhdmluZwogIGZ1bmN0aW9uIHJlbW92ZVVudXNlZEltYWdlcygpIHsKICAgIGlmIChzdXNwZW5kUmVtb3ZhbCkgcmV0dXJuOwogICAgY29uc3QgdXNlZElkcyA9IG5ldyBTZXQoKTsKICAgIE9iamVjdC52YWx1ZXMoc3RvcmFnZSkuZm9yRWFjaChwcm9jID0+IE9iamVjdC52YWx1ZXMocHJvYyA/PyB7fSkuZm9yRWFjaChkYXRhID0+IHsKICAgICAgaWYgKCFkYXRhLmlucHV0cykgcmV0dXJuOwogICAgICBPYmplY3QudmFsdWVzKGRhdGEuaW5wdXRzKS5mb3JFYWNoKGlucHV0ID0+IHsKICAgICAgICBpZiAoaW5wdXQudHlwZSA9PT0gImltZyIpIHVzZWRJZHMuYWRkKGlucHV0LnNyYyk7CiAgICAgIH0pOwogICAgfSkpOwoKICAgIGZvciAobGV0IGkgPSAxOyBpIDwgaW1nU3RvcmVTaXplOyBpKyspIHsKICAgICAgaWYgKCF1c2VkSWRzLmhhcyhpKSkgZGVsZXRlIGltZ1N0b3JhZ2VbaV07CiAgICB9CiAgfQoKICAvLyByZXNldCB0aGUgY29tcGlsZWQgY29kZSBjYWNoZSBmb3IgZ2xvYmFsIGJsb2NrcyB0aGF0IGdldCBjaGFuZ2VkCiAgZnVuY3Rpb24gcmVzZXRHbG9iYWxDb21waWxlckNhY2hlKHByb2Njb2RlKSB7CiAgICBmb3IgKGNvbnN0IHRhcmdldCBvZiBydW50aW1lLnRhcmdldHMpIHsKICAgICAgY29uc3QgYmxvY2tzID0gdGFyZ2V0LmJsb2NrczsKICAgICAgY29uc3QgY29tcGlsZWRQcm9jcyA9IE9iamVjdC5rZXlzKGJsb2Nrcy5fY2FjaGUuY29tcGlsZWRQcm9jZWR1cmVzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb21waWxlZFByb2NzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKGNvbXBpbGVkUHJvY3NbaV0uaW5jbHVkZXMocHJvY2NvZGUpKSB7CiAgICAgICAgICBibG9ja3MucmVzZXRDYWNoZSgpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgLy8gSXMtaW4tRWRpdG9yIENoZWNrZXIKICBsZXQgc3RhcnRlZEVkaXRvcldvcmtlciA9IGZhbHNlOwogIGZ1bmN0aW9uIHN0YXJ0RWRpdG9yTGlzdGVuZXIoKSB7CiAgICByZWZyZXNoR2xvYmFsQmxvY2tzQ2FjaGUoKTsKICAgIGlmIChzdGFydGVkRWRpdG9yV29ya2VyKSByZXR1cm47CiAgICBzdGFydGVkRWRpdG9yV29ya2VyID0gZmFsc2U7CiAgICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHsKICAgICAgY29uc3Qgd29ya3NwYWNlID0gU0IubWFpbldvcmtzcGFjZTsKICAgICAgaWYgKCFpc1BNKSB3b3Jrc3BhY2UuZW5hYmxlUHJvY2VkdXJlUmV0dXJucygpOwogICAgICB2bS5vbigid29ya3NwYWNlVXBkYXRlIiwgKCkgPT4gewogICAgICAgIGlmICghZXh0ZW5zaW9uUmVtb3ZhYmxlKSB7CiAgICAgICAgICBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgIGlmICh3b3Jrc3BhY2U/LnJlbmRlcmVkKSBTQi5Qcm9jZWR1cmVzLmZseW91dENhdGVnb3J5KHdvcmtzcGFjZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0KCiAgLy8gQmxvY2sgRXZlbnRzIEhhbmRsZXIKICBmdW5jdGlvbiBpbml0QmxvY2tFdmVudHMoKSB7CiAgICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHsKICAgICAgY29uc3QgeyBFdmVudHMsIG1haW5Xb3Jrc3BhY2UgfSA9IFNCOwogICAgICBpZiAoIW1haW5Xb3Jrc3BhY2U/LnJlbmRlcmVkKSByZXR1cm47CiAgICAgIGxldCBwYXRjaGVkID0gZmFsc2U7CiAgICAgIGNvbnN0IHdvcmtzcGFjZUV2ZW50cyA9IChlKSA9PiB7CiAgICAgICAgaWYgKG1haW5Xb3Jrc3BhY2UuaWQgPT09IGUud29ya3NwYWNlSWQpIHsKICAgICAgICAgIGlmICghaXNQTSAmJiAhcGF0Y2hlZCkgewogICAgICAgICAgICBjb25zdCBvZ1JldHVybnNXaWxsQ2hhbmdlID0gbWFpbldvcmtzcGFjZS5wcm9jZWR1cmVSZXR1cm5zV2lsbENoYW5nZTsKICAgICAgICAgICAgbWFpbldvcmtzcGFjZS5wcm9jZWR1cmVSZXR1cm5zV2lsbENoYW5nZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIG9nUmV0dXJuc1dpbGxDaGFuZ2UuY2FsbCh0aGlzKTsKICAgICAgICAgICAgICBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgICAgICBwYXRjaGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3dpdGNoIChlLnR5cGUpIHsKICAgICAgICAgICAgY2FzZSBFdmVudHMuQ0hBTkdFOiB7CiAgICAgICAgICAgICAgbGV0IGJsb2NrID0gbWFpbldvcmtzcGFjZS5nZXRCbG9ja0J5SWQoZS5ibG9ja0lkKTsKICAgICAgICAgICAgICB3aGlsZSAoYmxvY2sgIT09IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChibG9jayAmJiBibG9jay50eXBlID09PSAicHJvY2VkdXJlc19kZWZpbml0aW9uIikgewogICAgICAgICAgICAgICAgICBjb25zdCBwcm90byA9IGJsb2NrLmdldElucHV0KCJjdXN0b21fYmxvY2siKT8uY29ubmVjdGlvbj8udGFyZ2V0QmxvY2soKTsKICAgICAgICAgICAgICAgICAgaWYgKCFwcm90bykgcmV0dXJuOwogICAgICAgICAgICAgICAgICBjb25zdCBzdG9yZSA9IHN0b3JlR2V0KHByb3RvLnByb2NDb2RlXyk7CiAgICAgICAgICAgICAgICAgIGlmIChzdG9yZS5nbG9iYWwpIHJlc2V0R2xvYmFsQ29tcGlsZXJDYWNoZShwcm90by5wcm9jQ29kZV8pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYmxvY2sgPSBibG9jay5nZXRQYXJlbnQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSBFdmVudHMuTU9WRTogewogICAgICAgICAgICAgIGxldCBibG9jayA9IG1haW5Xb3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKGUuYmxvY2tJZCksIHBhcmVudCA9IG1haW5Xb3Jrc3BhY2UuZ2V0QmxvY2tCeUlkKGUubmV3UGFyZW50SWQpOwoKICAgICAgICAgICAgICAvLyBmaXggZmllbGQgY29sb3VycwogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGUubmV3SW5wdXROYW1lICYmIGJsb2NrPy5jYXRlZ29yeV8gPT09IG51bGwgJiYKICAgICAgICAgICAgICAgIGJsb2NrLmlucHV0TGlzdFswXS5maWVsZFJvd1swXT8uYXJyb3dfICE9PSB1bmRlZmluZWQgJiYKICAgICAgICAgICAgICAgIHBhcmVudD8udHlwZSA9PT0gInByb2NlZHVyZXNfY2FsbCIKICAgICAgICAgICAgICApIGJsb2NrLnNldENvbG91cihwYXJlbnQuY29sb3VyXyk7CgogICAgICAgICAgICAgIC8vIHVwZGF0ZSBnbG9iYWwgYmxvY2sgY2FjaGUgZm9yIHJldHVybnMKICAgICAgICAgICAgICBpZiAoIWlzUE0pIHsKICAgICAgICAgICAgICAgIGlmIChwYXJlbnQ/LnR5cGUgPT09ICJwcm9jZWR1cmVzX3JldHVybiIpIHsKICAgICAgICAgICAgICAgICAgYmxvY2sgPSBwYXJlbnQ7CiAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGJsb2NrLmdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGNvbnN0IGNoYW5nZUdsb2JhbFJldHVybiA9IChwYXJlbnQsIHJldHVybnMpID0+IHsKICAgICAgICAgICAgICAgICAgd2hpbGUgKHBhcmVudCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQgJiYgcGFyZW50LnR5cGUgPT09ICJwcm9jZWR1cmVzX2RlZmluaXRpb24iKSB7CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm90byA9IHBhcmVudC5nZXRJbnB1dCgiY3VzdG9tX2Jsb2NrIik/LmNvbm5lY3Rpb24/LnRhcmdldEJsb2NrKCk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb3RvKSByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBzdG9yZSA9IHN0b3JlR2V0KHByb3RvLnByb2NDb2RlXyk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvY2s/LnR5cGUgPT09ICJwcm9jZWR1cmVzX3JldHVybiIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgdm1Qcm90byA9IHZtLmVkaXRpbmdUYXJnZXQuYmxvY2tzLmdldEJsb2NrKHByb3RvLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJldHVybnMpIHZtUHJvdG8ubXV0YXRpb24ucmV0dXJuID0gU0IuUHJvY2VkdXJlcy5nZXRCbG9ja1JldHVyblR5cGUocGFyZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB2bVByb3RvLm11dGF0aW9uLnJldHVybiA9IDA7CgogICAgICAgICAgICAgICAgICAgICAgICBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0b3JlLmdsb2JhbCkgc3RvcmUucmV0dXJuID0gdm1Qcm90by5tdXRhdGlvbi5yZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RvcmUuZ2xvYmFsKSByZXNldEdsb2JhbENvbXBpbGVyQ2FjaGUocHJvdG8ucHJvY0NvZGVfKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gcGFyZW50LmdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGNoYW5nZUdsb2JhbFJldHVybihwYXJlbnQsIHRydWUpOyAvLyBoYW5kbGUgbmV3IGRlZmluaXRpb24KICAgICAgICAgICAgICAgIGlmIChlLm9sZFBhcmVudElkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgY29uc3Qgb2xkUGFyZW50ID0gbWFpbldvcmtzcGFjZS5nZXRCbG9ja0J5SWQoZS5vbGRQYXJlbnRJZCk7CiAgICAgICAgICAgICAgICAgIGNoYW5nZUdsb2JhbFJldHVybihvbGRQYXJlbnQsIGZhbHNlKTsgLy8gaGFuZGxlIG9sZCBkZWZpbml0aW9uCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICBtYWluV29ya3NwYWNlLmFkZENoYW5nZUxpc3RlbmVyKHdvcmtzcGFjZUV2ZW50cyk7CiAgICB9KTsKICB9CiAgZnVuY3Rpb24gc3RhcnRCbG9ja0xpc3RlbmVyKCkgewogICAgcnVudGltZS5vbigiQkxPQ0tfRFJBR19FTkQiLCAobmV3U3RhY2ssIG9sZElEKSA9PiB7CiAgICAgIC8vIGFwcGVuZCBvbGQgZGF0YSB0byBuZXcgYmxvY2tzCiAgICAgIGlmIChuZXdTdGFja1swXS5vcGNvZGUgIT09ICJwcm9jZWR1cmVzX2RlZmluaXRpb24iKSByZXR1cm47CiAgICAgIGNvbnN0IHByb2Njb2RlID0gbmV3U3RhY2tbMV0ubXV0YXRpb24ucHJvY2NvZGU7CiAgICAgIGNvbnN0IHRoaXNUYXJnZXQgPSB2bS5lZGl0aW5nVGFyZ2V0OwogICAgICBjb25zdCBjb3B5U3RvcmUgPSBzdG9yZUdldChwcm9jY29kZSwgdGhpc1RhcmdldCk7CiAgICAgIGlmIChjb3B5U3RvcmUpIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIC8vIHRpbWVvdXQgd29ya3MgYmV0dGVyIHRoYW4gcXVldWVNaWNyb3Rhc2sgZm9yIHRoaXM/CiAgICAgICAgZm9yIChjb25zdCB0YXJnZXQgb2YgcnVudGltZS50YXJnZXRzKSB7CiAgICAgICAgICBpZiAoIXRhcmdldC5pc09yaWdpbmFsIHx8IHRhcmdldC5pZCA9PT0gdGhpc1RhcmdldC5pZCkgY29udGludWU7CiAgICAgICAgICBjb25zdCBkZWYgPSB0YXJnZXQuYmxvY2tzLmdldFByb2NlZHVyZURlZmluaXRpb24ocHJvY2NvZGUpOwogICAgICAgICAgaWYgKGRlZikgc3RvcmVTZXQocHJvY2NvZGUsIHN0cnVjdHVyZWRDbG9uZShjb3B5U3RvcmUpLCB0YXJnZXQpOwogICAgICAgIH0KICAgICAgfSwgMTApOwogICAgfSk7CgogICAgY29uc3QgY2hlY2tJbkVkaXRvciA9ICgpID0+ICFSZWR1eFN0b3JlLmdldFN0YXRlKCkuc2NyYXRjaEd1aS5tb2RlLmlzUGxheWVyT25seTsKICAgIGxldCBpbkVkaXRvciA9IGNoZWNrSW5FZGl0b3IoKTsKICAgIGlmIChpbkVkaXRvcikgaW5pdEJsb2NrRXZlbnRzKCk7CiAgICBSZWR1eFN0b3JlLnN1YnNjcmliZSgoKSA9PiB7CiAgICAgIGNvbnN0IGN1cnJlbnRJbkVkaXRvciA9IGNoZWNrSW5FZGl0b3IoKTsKICAgICAgaWYgKGluRWRpdG9yICE9PSBjdXJyZW50SW5FZGl0b3IpIHsKICAgICAgICBpbkVkaXRvciA9IGN1cnJlbnRJbkVkaXRvcjsKICAgICAgICBpZiAoaW5FZGl0b3IpIGluaXRCbG9ja0V2ZW50cygpOwogICAgICB9CiAgICB9KTsKICB9CiAgaWYgKHR5cGVvZiBzY2FmZm9sZGluZyA9PT0gInVuZGVmaW5lZCIpIHN0YXJ0QmxvY2tMaXN0ZW5lcigpOwoKICAvLyBDdXN0b20gQmxvY2tzIEludGVybmFscwogIGZ1bmN0aW9uIHN0b3JlR2V0KG5hbWUsIHRhcmdldCA9IG51bGwpIHsKICAgIC8vIGZpcnN0IGNoZWNrIGlmIGl0cyBhIGdsb2JhbCBibG9jayBwcm9jY29kZQogICAgY29uc3QgZ2xvYmFsU3RvcmUgPSBnbG9iYWxCbG9ja3NDYWNoZVtuYW1lXTsKICAgIGlmIChnbG9iYWxTdG9yZSAhPT0gdW5kZWZpbmVkKSByZXR1cm4gc3RvcmFnZVtnbG9iYWxTdG9yZS5pZF0/LltuYW1lXSA/PyB7fTsKCiAgICBjb25zdCBpZCA9ICh0YXJnZXQgfHwgdm0uZWRpdGluZ1RhcmdldCk/LmlkOwogICAgcmV0dXJuIHN0b3JhZ2VbaWRdPy5bbmFtZV0gPz8ge307CiAgfQogIGZ1bmN0aW9uIHN0b3JlRGVsKG5hbWUsIHRhcmdldCA9IG51bGwpIHsKICAgIGNvbnN0IGlkID0gKHRhcmdldCB8fCB2bS5lZGl0aW5nVGFyZ2V0KS5pZDsKICAgIGRlbGV0ZSBzdG9yYWdlW2lkXVtuYW1lXTsKICB9CiAgZnVuY3Rpb24gc3RvcmVTZXQobmFtZSwgdmFsdWUsIHRhcmdldCA9IG51bGwpIHsKICAgIGNvbnN0IGlkID0gKHRhcmdldCB8fCB2bS5lZGl0aW5nVGFyZ2V0KS5pZDsKICAgIGlmICghc3RvcmFnZVtpZF0pIHN0b3JhZ2VbaWRdID0ge307CiAgICBzdG9yYWdlW2lkXVtuYW1lXSA9IHZhbHVlOwogICAgcnVudGltZS5TUG1icENTVE9sZFN0b3JhZ2UgPSBzdG9yYWdlOwogIH0KCiAgZnVuY3Rpb24gc3RvcmVJbWFnZSh1cmwpIHsKICAgIGNvbnN0IHVybEV4aXN0cyA9IE9iamVjdC52YWx1ZXMoaW1nU3RvcmFnZSkuaW5kZXhPZih1cmwpOwogICAgaWYgKHVybEV4aXN0cyA+IC0xKSByZXR1cm4gdXJsRXhpc3RzICsgMTsKCiAgICBpbWdTdG9yZVNpemUrKzsKICAgIGltZ1N0b3JhZ2VbaW1nU3RvcmVTaXplXSA9IHVybDsKICAgIHJldHVybiBpbWdTdG9yZVNpemU7CiAgfQogIGZ1bmN0aW9uIGdldFN0b3JlZEltYWdlKGluZGV4KSB7CiAgICByZXR1cm4gaW1nU3RvcmFnZVtpbmRleF0gPz8gIiI7CiAgfQoKICBmdW5jdGlvbiBkZXNlcmlhbGl6ZVN0b3JhZ2UoZGF0YSkgewogICAgaWYgKGlzUE0pIHsKICAgICAgc3RvcmFnZSA9IGRhdGEuU1BtYnBDU1QgfHwge307CiAgICAgIGltZ1N0b3JhZ2UgPSBkYXRhLlNQbWJwQ1NULmltZ1N0b3JhZ2UgPz8ge307CiAgICAgIGltZ1N0b3JlU2l6ZSA9IE9iamVjdC5rZXlzKGltZ1N0b3JhZ2UpLmxlbmd0aDsKICAgICAgc3RhcnRFZGl0b3JMaXN0ZW5lcigpOwogICAgICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHsKICAgICAgICBydW50aW1lLm9uY2UoIlBST0pFQ1RfTE9BREVEIiwgKCkgPT4gewogICAgICAgICAgaWYgKFNCLm1haW5Xb3Jrc3BhY2UucmVuZGVyZWQpIFNCLlByb2NlZHVyZXMuZmx5b3V0Q2F0ZWdvcnkoU0IubWFpbldvcmtzcGFjZSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgc3VzcGVuZFJlbW92YWwgPSB0cnVlOwoKICAgICAgaW1nU3RvcmFnZSA9IHJ1bnRpbWUuZXh0ZW5zaW9uU3RvcmFnZVsiU1BtYnBDU1QiXS5pbWdTdG9yYWdlID8/IHt9OwogICAgICBpbWdTdG9yZVNpemUgPSBPYmplY3Qua2V5cyhpbWdTdG9yYWdlKS5sZW5ndGg7CiAgICAgIHN0b3JhZ2UgPSB7fTsgLy8gdGFyZ2V0IElEJ3MgY2hhbmdlIHdoZW4gc2F2aW5nIDooCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcnVudGltZS50YXJnZXRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgdGFyZ2V0ID0gcnVudGltZS50YXJnZXRzW2ldOwogICAgICAgIGNvbnN0IHN0b3JlID0gdGFyZ2V0LmV4dGVuc2lvblN0b3JhZ2U/LlNQbWJwQ1NUOwogICAgICAgIGlmIChzdG9yZSAhPT0gdW5kZWZpbmVkKSBzdG9yYWdlW3RhcmdldC5pZF0gPSB7IC4uLnN0b3JlIH07CiAgICAgIH0KICAgICAgY29uc3QgdGVtcFN0b3JlID0gc3RydWN0dXJlZENsb25lKHN0b3JhZ2UpOwogICAgICBydW50aW1lLlNQbWJwQ1NUT2xkU3RvcmFnZSA9IHRlbXBTdG9yZTsKICAgICAgc3RhcnRFZGl0b3JMaXN0ZW5lcigpOwogICAgICB2bS5vbmNlKCJ3b3Jrc3BhY2VVcGRhdGUiLCAoKSA9PiB7IHN0b3JhZ2UgPSB0ZW1wU3RvcmUgfSk7CiAgICAgIHZtLmVtaXRXb3Jrc3BhY2VVcGRhdGUoKTsKICAgICAgaWYgKFNjcmF0Y2guZ3VpKSBTY3JhdGNoLmd1aS5nZXRCbG9ja2x5KCkudGhlbihTQiA9PiB7CiAgICAgICAgU0IuUHJvY2VkdXJlcy5mbHlvdXRDYXRlZ29yeShTQi5tYWluV29ya3NwYWNlKTsKICAgICAgfSk7CiAgICB9CiAgfQogIC8vIHVzZSBleGlzdGluZyBzdG9yYWdlIHdoZW4gbG9hZGVkIHR3aWNlCiAgc3RvcmFnZSA9IHJ1bnRpbWUuU1BtYnBDU1RPbGRTdG9yYWdlIHx8IHt9OwogIGlmICghaXNQTSkgcnVudGltZS5vbmNlKCJQUk9KRUNUX0xPQURFRCIsICgpID0+IGRlc2VyaWFsaXplU3RvcmFnZSgpKTsKCiAgZnVuY3Rpb24gcmVmcmVzaEdsb2JhbEJsb2Nrc0NhY2hlKCkgewogICAgZ2xvYmFsQmxvY2tzQ2FjaGUgPSB7fTsKICAgIHZtLmdsb2JhbEJsb2Nrc0NhY2hlID0gZ2xvYmFsQmxvY2tzQ2FjaGU7CiAgICBmb3IgKGNvbnN0IHRhcmdldElkIG9mIE9iamVjdC5rZXlzKHN0b3JhZ2UpKSB7CiAgICAgIGNvbnN0IHRhcmdldCA9IHJ1bnRpbWUuZ2V0VGFyZ2V0QnlJZCh0YXJnZXRJZCk7CiAgICAgIGlmICghdGFyZ2V0KSBjb250aW51ZTsKICAgICAgZm9yIChjb25zdCBwcm9jY29kZSBvZiBPYmplY3Qua2V5cyhzdG9yYWdlW3RhcmdldElkXSA/PyB7fSkpIHsKICAgICAgICBpZiAoc3RvcmFnZVt0YXJnZXRJZF1bcHJvY2NvZGVdPy5nbG9iYWwpIGdsb2JhbEJsb2Nrc0NhY2hlW3Byb2Njb2RlXSA9IHRhcmdldDsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gZ2V0QmxvY2tQcm90b3R5cGUodGFyZ2V0LCBwcm9jY29kZSkgewogICAgZm9yIChjb25zdCBpZCBpbiB0YXJnZXQuYmxvY2tzLl9ibG9ja3MpIHsKICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGFyZ2V0LmJsb2Nrcy5fYmxvY2tzLCBpZCkpIGNvbnRpbnVlOwogICAgICBjb25zdCBibG9jayA9IHRhcmdldC5ibG9ja3MuX2Jsb2Nrc1tpZF07CiAgICAgIGlmIChibG9jay5vcGNvZGUgPT09ICJwcm9jZWR1cmVzX3Byb3RvdHlwZSIgJiYgYmxvY2subXV0YXRpb24gJiYgYmxvY2subXV0YXRpb24ucHJvY2NvZGUgPT09IHByb2Njb2RlKSB7CiAgICAgICAgcmV0dXJuIGJsb2NrOwogICAgICB9CiAgICB9CiAgICByZXR1cm47CiAgfQoKICBmdW5jdGlvbiBjb21waWxlUHJvY2VkdXJlcyh4bWxMaXN0LCB3b3Jrc3BhY2UsIHV0aWxzKSB7CiAgICBpZiAoIWxpc3ROZWVkc1JlZnJlc2gpIHJldHVybjsKICAgIGNvbnN0IHJldHVybmFibGVzID0gaXNQTSA/IHt9IDogdXRpbHMuZ2V0QWxsUHJvY2VkdXJlUmV0dXJuVHlwZXMod29ya3NwYWNlKTsKICAgIHJlZnJlc2hHbG9iYWxCbG9ja3NDYWNoZSgpOwoKICAgIC8vIGdldCBwcml2YXRlIHByb2NlZHVyZXMKICAgIHByb2NlZHVyZXNYTUwgPSAiIjsKICAgIGNvbnN0IGdsb2JhbFByb2NzID0gbmV3IFNldChPYmplY3Qua2V5cyhnbG9iYWxCbG9ja3NDYWNoZSkpOwogICAgY29uc3QgdGVtcENhY2hlID0ge307CiAgICBvbGRMaXN0TGVuZ3RoID0geG1sTGlzdC5sZW5ndGg7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG9sZExpc3RMZW5ndGg7IGkrKykgewogICAgICBjb25zdCBwcm9jID0geG1sTGlzdFtpXTsKICAgICAgaWYgKHByb2MuZ2V0QXR0cmlidXRlKCJ0eXBlIikgPT09ICJwcm9jZWR1cmVzX2NhbGwiKSB7CiAgICAgICAgY29uc3QgcHJvY2NvZGUgPSBwcm9jLmZpcnN0Q2hpbGQuZ2V0QXR0cmlidXRlKCJwcm9jY29kZSIpOwogICAgICAgIGlmIChnbG9iYWxQcm9jcy5oYXMocHJvY2NvZGUpKSB0ZW1wQ2FjaGVbcHJvY2NvZGVdID0gcHJvYy5vdXRlckhUTUw7CiAgICAgICAgZWxzZSBwcm9jZWR1cmVzWE1MICs9IHByb2Mub3V0ZXJIVE1MOwogICAgICB9CiAgICB9CgogICAgaWYgKGdsb2JhbFByb2NzLnNpemUgPiAwKSB7CiAgICAgIGxldCB0ZW1wTGlzdCA9IGA8c2VwIGdhcD0iMTIiLz48bGFiZWwgdGV4dD0iR2xvYmFsIEJsb2NrcyIvPjxzZXAgZ2FwPSI2Ii8+YDsKICAgICAgZm9yIChjb25zdCBwcm9jY29kZSBvZiBnbG9iYWxQcm9jcykgewogICAgICAgIGNvbnN0IHRhcmdldCA9IGdsb2JhbEJsb2Nrc0NhY2hlW3Byb2Njb2RlXTsKICAgICAgICBpZiAodGFyZ2V0LmlkID09PSB2bS5lZGl0aW5nVGFyZ2V0Py5pZCkgewogICAgICAgICAgdGVtcExpc3QgKz0gdGVtcENhY2hlW3Byb2Njb2RlXTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KCiAgICAgICAgY29uc3QgcHJvdG8gPSBnZXRCbG9ja1Byb3RvdHlwZSh0YXJnZXQsIHByb2Njb2RlKTsKICAgICAgICBpZiAocHJvdG8pIHsKICAgICAgICAgIGlmIChwcm90by5tdXRhdGlvbi5yZXR1cm4gPT09IHVuZGVmaW5lZCkgcHJvdG8ubXV0YXRpb24ucmV0dXJuID0gc3RvcmVHZXQocHJvY2NvZGUpLnJldHVybjsKICAgICAgICAgIGNvbnN0IG5ld011dGF0aW9uID0gey4uLnByb3RvLm11dGF0aW9ufTsKICAgICAgICAgIG5ld011dGF0aW9uLmdlbmVyYXRlc2hhZG93cyA9IHRydWU7CiAgICAgICAgICB0ZW1wTGlzdCArPSBgPGJsb2NrIHR5cGU9InByb2NlZHVyZXNfY2FsbCIgZ2FwPSIxMiI+JHt0YXJnZXQuYmxvY2tzLm11dGF0aW9uVG9YTUwobmV3TXV0YXRpb24pfTwvYmxvY2s+YDsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGVtcExpc3QgKz0gYDxzZXAgZ2FwPSI2Ii8+PGxhYmVsIHRleHQ9IlByaXZhdGUgQmxvY2tzIi8+PHNlcCBnYXA9IjYiLz5gOwogICAgICBwcm9jZWR1cmVzWE1MID0gdGVtcExpc3QgKyBwcm9jZWR1cmVzWE1MOwogICAgfQogICAgdm0uZXh0ZW5zaW9uTWFuYWdlci5yZWZyZXNoQmxvY2tzKCJTUG1icENTVCIpOwogICAgbGlzdE5lZWRzUmVmcmVzaCA9IGZhbHNlOwogIH0KCiAgZnVuY3Rpb24gcmVtb3ZlRXh0ZW5zaW9uKCkgewogICAgZXh0ZW5zaW9uUmVtb3ZhYmxlID0gdHJ1ZTsKICAgIHNob3VsZFNjcm9sbFRvTUJQID0gZmFsc2U7IC8vIGp1c3QgaW4gY2FzZQogICAgZm9yIChjb25zdCB0YXJnZXQgb2YgcnVudGltZS50YXJnZXRzKSB7CiAgICAgIGZvciAoY29uc3QgYmxvY2sgb2YgT2JqZWN0LnZhbHVlcyh0YXJnZXQuYmxvY2tzLl9ibG9ja3MpKSB7CiAgICAgICAgaWYgKGJsb2NrLm9wY29kZS5zdGFydHNXaXRoKCJTUG1icENTVF8iKSkgZGVsZXRlQmxvY2sodGFyZ2V0LCBibG9jay5pZCk7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3Qga2V5IGluIHN0b3JhZ2UpIGRlbGV0ZSBzdG9yYWdlW2tleV07CiAgICBmb3IgKGNvbnN0IGtleSBpbiB0ZW1wU3RvcmUpIGRlbGV0ZSB0ZW1wU3RvcmVba2V5XTsKICAgIHJ1bnRpbWUuU1BtYnBDU1RPbGRTdG9yYWdlID0gc3RvcmFnZTsKICAgIHZtLnJlZnJlc2hXb3Jrc3BhY2UoKTsKICAgIGFsZXJ0KCJTYXZlIGFuZCByZWxvYWQgdGhlIHByb2plY3QgZm9yIHRoZSBleHRlbnNpb24gdG8gZnVsbHkgYmUgcmVtb3ZlZC4iKTsKICB9CgogIGZ1bmN0aW9uIGRlbGV0ZUJsb2NrKHRhcmdldCwgYmxvY2tJZCkgewogICAgaWYgKHRhcmdldCA9PT0gdm0uZWRpdGluZ1RhcmdldCAmJiBTY3JhdGNoLmd1aSkgewogICAgICBTY3JhdGNoLmd1aS5nZXRCbG9ja2x5KCkudGhlbihTQiA9PiB7CiAgICAgICAgU0IuZ2V0TWFpbldvcmtzcGFjZSgpLmdldEJsb2NrQnlJZChibG9ja0lkKT8uZGlzcG9zZSh0cnVlLCBmYWxzZSk7CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgdGFyZ2V0LmJsb2Nrcy5kZWxldGVCbG9jayhibG9ja0lkKTsKICAgIH0KICB9CgogIGNvbnN0IG9nRHVwU3ByaXRlID0gdm0uZHVwbGljYXRlU3ByaXRlOwogIHZtLmR1cGxpY2F0ZVNwcml0ZSA9IGZ1bmN0aW9uKHRhcmdldElkKSB7CiAgICByZXR1cm4gb2dEdXBTcHJpdGUuY2FsbCh0aGlzLCB0YXJnZXRJZCkudGhlbigoKSA9PiB7CiAgICAgIGNvbnN0IG5ld1RhcmdldCA9IHRoaXMucnVudGltZS50YXJnZXRzW3RoaXMucnVudGltZS50YXJnZXRzLmxlbmd0aCAtIDFdOwogICAgICBpZiAoIXN0b3JhZ2VbbmV3VGFyZ2V0LmlkXSkgewogICAgICAgIHN0b3JhZ2VbbmV3VGFyZ2V0LmlkXSA9IHN0cnVjdHVyZWRDbG9uZShzdG9yYWdlW3RhcmdldElkXSk7CiAgICAgICAgdGhpcy5lbWl0V29ya3NwYWNlVXBkYXRlKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ld1RhcmdldDsKICAgIH0pOwogIH0KCiAgLyogQmFja3BhY2sgU3VwcG9ydCAoQkxPQ0tTKSAqLwogIGNvbnN0IGhhbmRsZUN1c3RvbUlucHV0RXhwb3J0cyA9IChpbnB1dHMpID0+IHsKICAgIC8vIFRPRE8gZXhwb3J0IGltYWdlcyB0b28KICAgIGlmICghcnVudGltZS5leHRlbnNpb25NYW5hZ2VyLmlzRXh0ZW5zaW9uTG9hZGVkKCJTUDB6TWVudU1ha2VyIikpIHJldHVybjsKCiAgICBjb25zdCBtZW51TWFrZXIgPSBydW50aW1lLmV4dF9TUDB6TWVudU1ha2VyOwogICAgY29uc3QgYWxsTWVudXMgPSBtZW51TWFrZXIuZ2V0TWVudXMoKTsKICAgIGNvbnN0IHZhbHVlcyA9IE9iamVjdC52YWx1ZXMoaW5wdXRzKTsKCiAgICBsZXQgb3V0cHV0ID0geyBtZW51czoge30gfTsKICAgIGZvciAoY29uc3QgaW5wdXQgb2YgdmFsdWVzKSB7CiAgICAgIC8qIGN1c3RvbSBtZW51IHN1cHBvcnQgKi8KICAgICAgaWYgKGlucHV0LmlzRHJvcCAmJiBpbnB1dC50eXBlLnN0YXJ0c1dpdGgoQ1VTVE9NX01FTlVfSUQpKSB7CiAgICAgICAgY29uc3QgbmFtZSA9IGlucHV0LnR5cGUuc3Vic3RyaW5nKENVU1RPTV9NRU5VX0lELmxlbmd0aCwgaW5wdXQudHlwZS5sZW5ndGgpOwogICAgICAgIG91dHB1dC5tZW51c1tuYW1lXSA9IGFsbE1lbnVzW25hbWVdLml0ZW1zOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIG91dHB1dDsKICB9OwogIGNvbnN0IG9nRXhwb3J0QmxvY2tzID0gdm0uZXhwb3J0U3RhbmRhbG9uZUJsb2NrczsKICB2bS5leHBvcnRTdGFuZGFsb25lQmxvY2tzID0gZnVuY3Rpb24oYmxvY2tPYmplY3RzKSB7CiAgICBjb25zdCBleHBvcnRlZCA9IG9nRXhwb3J0QmxvY2tzLmNhbGwodGhpcywgYmxvY2tPYmplY3RzKTsKICAgIGxldCBzdGFjazsKCiAgICAvLyBhcHBlbmQgY3VzdG9tIGJsb2NrIGRhdGEgZm9yIGltcG9ydGluZyBpZiB0aGVyZXMgYSBkZWZpbml0aW9uCiAgICBpZiAoZXhwb3J0ZWQuY29uc3RydWN0b3I/Lm5hbWUgPT09ICJPYmplY3QiKSBzdGFjayA9IGV4cG9ydGVkLmJsb2NrczsKICAgIGVsc2Ugc3RhY2sgPSBleHBvcnRlZDsKICAgIGZvciAoY29uc3QgYmxvY2sgb2Ygc3RhY2spIHsKICAgICAgaWYgKGJsb2NrLm9wY29kZSAhPT0gInByb2NlZHVyZXNfcHJvdG90eXBlIikgY29udGludWU7CiAgICAgIGNvbnN0IHN0b3JlID0gc3RvcmVHZXQoYmxvY2subXV0YXRpb24ucHJvY2NvZGUpOwogICAgICBpZiAoIXN0b3JlKSBjb250aW51ZTsKICAgICAgYmxvY2suTXlCbG9ja3NQbHVzRGF0YSA9IHN0b3JlOwogICAgICBibG9jay5NeUJsb2Nrc1BsdXNFeHRlcm5hbHMgPSBoYW5kbGVDdXN0b21JbnB1dEV4cG9ydHMoc3RvcmUuaW5wdXRzKTsKICAgIH0KICAgIHJldHVybiBleHBvcnRlZDsKICB9CgogIGNvbnN0IGhhbmRsZUN1c3RvbUlucHV0SW1wb3J0cyA9IChleHRlcm5hbHMpID0+IHsKICAgIGlmICghcnVudGltZS5leHRlbnNpb25NYW5hZ2VyLmlzRXh0ZW5zaW9uTG9hZGVkKCJTUDB6TWVudU1ha2VyIikpIHJldHVybjsKCiAgICBjb25zdCBtZW51TWFrZXIgPSBydW50aW1lLmV4dF9TUDB6TWVudU1ha2VyOwogICAgY29uc3QgbWVudXMgPSBPYmplY3QuZW50cmllcyhleHRlcm5hbHMubWVudXMpOwogICAgZm9yIChjb25zdCBbbmFtZSwgaXRlbXNdIG9mIG1lbnVzKSB7CiAgICAgIG1lbnVNYWtlci5zZXRNZW51cyhuYW1lLCBpdGVtcyk7CiAgICB9CgogICAgbWVudU1ha2VyLnJlZnJlc2hDYXRlZ29yeSgpOwogIH07CiAgY29uc3Qgb2dTaGFyZUJsb2NrcyA9IHZtLnNoYXJlQmxvY2tzVG9UYXJnZXQ7CiAgdm0uc2hhcmVCbG9ja3NUb1RhcmdldCA9IGZ1bmN0aW9uKGJsb2NrcywgdGFyZ2V0SWQsIG9wdEZyb21UYXJnZXRJZCkgewogICAgLy8gbG9hZCBwb3RlbnRpYWwgY3VzdG9tIGJsb2NrIGRhdGEKICAgIGxldCByZWFsQmxvY2tzOwogICAgaWYgKGJsb2Nrcy5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gIk9iamVjdCIpIHJlYWxCbG9ja3MgPSBibG9ja3MuYmxvY2tzOwogICAgZWxzZSByZWFsQmxvY2tzID0gYmxvY2tzOwoKICAgIGxldCBoYXNQcm9jQmxvY2sgPSBmYWxzZTsKICAgIGZvciAoY29uc3QgYmxvY2sgb2YgcmVhbEJsb2NrcykgewogICAgICBpZiAoYmxvY2sub3Bjb2RlICE9PSAicHJvY2VkdXJlc19wcm90b3R5cGUiKSBjb250aW51ZTsKICAgICAgY29uc3QgbWJwRGF0YSA9IGJsb2NrPy5NeUJsb2Nrc1BsdXNEYXRhOwogICAgICBpZiAobWJwRGF0YSkgewogICAgICAgIGNvbnN0IHRhcmdldCA9IHJ1bnRpbWUuZ2V0VGFyZ2V0QnlJZCh0YXJnZXRJZCk7CiAgICAgICAgc3RvcmVTZXQoYmxvY2subXV0YXRpb24ucHJvY2NvZGUsIG1icERhdGEsIHRhcmdldCk7CiAgICAgICAgaGFuZGxlQ3VzdG9tSW5wdXRJbXBvcnRzKGJsb2NrLk15QmxvY2tzUGx1c0V4dGVybmFscyk7CiAgICAgICAgaGFzUHJvY0Jsb2NrID0gdHJ1ZTsKICAgICAgfQogICAgfQoKICAgIGNvbnN0IHNoYXJlZCA9IG9nU2hhcmVCbG9ja3MuY2FsbCh0aGlzLCBibG9ja3MsIHRhcmdldElkLCBvcHRGcm9tVGFyZ2V0SWQpOwogICAgaWYgKGhhc1Byb2NCbG9jayAmJiBTY3JhdGNoLmd1aSkgU2NyYXRjaC5ndWkuZ2V0QmxvY2tseSgpLnRoZW4oU0IgPT4gewogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBjb25zdCB3b3Jrc3BhY2UgPSBTQi5tYWluV29ya3NwYWNlOwogICAgICAgIGxpc3ROZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgICAgIFNCLlByb2NlZHVyZXMuZmx5b3V0Q2F0ZWdvcnkod29ya3NwYWNlKTsKICAgICAgfSwgMTApOwogICAgfSk7CiAgICByZXR1cm4gc2hhcmVkOwogIH0KICAvKiBCYWNrcGFjayBTdXBwb3J0IChTUFJJVEVTKSAqLwogIGNvbnN0IG9nRXhwb3J0U3ByaXRlID0gdm0uZXhwb3J0U3ByaXRlOwogIHZtLmV4cG9ydFNwcml0ZSA9IGZ1bmN0aW9uKC4uLmFyZ3MpIHsKICAgIC8vIGluamVjdCBvdXIgZHVtbXkgYmxvY2sgdG8gcHJldmVudCBleHRlbnNpb24gZGVsZXRpb24KICAgIGNvbnN0IHRhcmdldElEID0gYXJnc1swXTsKICAgIGlmIChzdG9yYWdlW3RhcmdldElEXSkgewogICAgICBjb25zdCB0YXJnZXQgPSBydW50aW1lLmdldFRhcmdldEJ5SWQodGFyZ2V0SUQpOwogICAgICB0YXJnZXQuYmxvY2tzLl9ibG9ja3NbVEVNUF9CTE9DS19PUENPREVdID0gewogICAgICAgIG9wY29kZTogVEVNUF9CTE9DS19PUENPREUsIGlkOiBURU1QX0JMT0NLX09QQ09ERSwgZmllbGRzOiB7fSwKICAgICAgICBuZXh0OiBudWxsLCBwYXJlbnQ6IG51bGwsIHNoYWRvdzogdHJ1ZSwgdG9MZXZlbDogdHJ1ZSwKICAgICAgICB4OiB1bmRlZmluZWQsIHk6IHVuZGVmaW5lZAogICAgICB9OwogICAgfQogICAgcmV0dXJuIG9nRXhwb3J0U3ByaXRlLmNhbGwodGhpcywgLi4uYXJncyk7CiAgfQogIHdpbmRvdy50ZXN0ID0gc3RvcmFnZTsKICB3aW5kb3cudGVzdDIgPSAoKSA9PiB7bGlzdE5lZWRzUmVmcmVzaCA9IHRydWV9OwogIGNvbnN0IG9nSW1wb3J0U3ByaXRlID0gdm0uX2FkZFNwcml0ZTM7CiAgdm0uX2FkZFNwcml0ZTMgPSBmdW5jdGlvbiguLi5hcmdzKSB7CiAgICBjb25zdCBpbXBvcnRUYXJnZXQgPSBhcmdzWzBdOwogICAgLy8gcmVtb3ZlIGR1bW15IGJsb2NrIGlmIHByZXNlbnQsIHRoaXMgaXMgbmV2ZXIgdGhlIHN0YWdlICh3aGVyZSBpdHMgc2F2ZWQpIHNvIG5vdGhpbmcgYmFkIHNob3VsZCBoYXBwZW4KICAgIGRlbGV0ZSBpbXBvcnRUYXJnZXQuYmxvY2tzW1RFTVBfQkxPQ0tfT1BDT0RFXTsKCiAgICAvLyBleHRyYWN0IHN0b3JhZ2UgdG8gY29weSBvdmVyCiAgICBsZXQgc3RvcmVkOwogICAgaWYgKGlzUE0pIHsKICAgICAgc3RvcmVkID0gaW1wb3J0VGFyZ2V0LmV4dGVuc2lvbkRhdGFbIlNQbWJwQ1NUIl0uU1BtYnBDU1Q7CiAgICAgIGlmIChzdG9yZWQpIHsKICAgICAgICBydW50aW1lLm9uY2UoInRhcmdldFdhc0NyZWF0ZWQiLCAodGFyZ2V0KSA9PiB7CiAgICAgICAgICBpZiAoU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBzdG9yYWdlW3RhcmdldC5pZF0gPSBzdG9yZWRbaW1wb3J0VGFyZ2V0LmlkXTsKICAgICAgICAgICAgbGlzdE5lZWRzUmVmcmVzaCA9IHRydWU7CiAgICAgICAgICAgIFNCLlByb2NlZHVyZXMuZmx5b3V0Q2F0ZWdvcnkoU0IubWFpbldvcmtzcGFjZSk7CiAgICAgICAgICAgIHF1ZXVlTWljcm90YXNrKCgpID0+IHZtLmVtaXRXb3Jrc3BhY2VVcGRhdGUoKSk7CiAgICAgICAgICB9LCAxMDApKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcnVudGltZS5vbmNlKCJ0YXJnZXRXYXNDcmVhdGVkIiwgKHRhcmdldCkgPT4gcXVldWVNaWNyb3Rhc2soKCkgPT4gewogICAgICAgIHN0b3JlZCA9IHRhcmdldC5leHRlbnNpb25TdG9yYWdlWyJTUG1icENTVCJdOwogICAgICAgIGlmIChzdG9yZWQpIHsKICAgICAgICAgIHN0b3JhZ2VbdGFyZ2V0LmlkXSA9IHN0b3JlZDsKICAgICAgICAgIGxpc3ROZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgICAgICAgbGV0IGhhc0dsb2JhbCA9IGZhbHNlOwogICAgICAgICAgZm9yIChjb25zdCBwcm9jIG9mIE9iamVjdC52YWx1ZXMoc3RvcmVkKSkgewogICAgICAgICAgICBpZiAocHJvYy5nbG9iYWwgPT09IHRydWUpIHsKICAgICAgICAgICAgICBoYXNHbG9iYWwgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9IAogICAgICAgICAgfQoKICAgICAgICAgIGlmIChoYXNHbG9iYWwgJiYgU2NyYXRjaC5ndWkpIFNjcmF0Y2guZ3VpLmdldEJsb2NrbHkoKS50aGVuKFNCID0+IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICBsaXN0TmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgICAgU0IuUHJvY2VkdXJlcy5mbHlvdXRDYXRlZ29yeShTQi5tYWluV29ya3NwYWNlKTsKICAgICAgICAgIH0sIDEwMCkpOwogICAgICAgIH0KICAgICAgfSkpOwogICAgfQoKICAgIHJldHVybiBvZ0ltcG9ydFNwcml0ZS5jYWxsKHRoaXMsIC4uLmFyZ3MpOwogIH0KCiAgY2xhc3MgU1BtYnBDU1QgewogICAgZ2V0SW5mbygpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBpZDogIlNQbWJwQ1NUIiwKICAgICAgICBuYW1lOiAiTXkgQmxvY2tzKyIsCiAgICAgICAgY29sb3IxOiAiI0ZGNjY4MCIsCiAgICAgICAgbWVudUljb25VUkksCiAgICAgICAgYmxvY2tzOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIGZ1bmM6ICJjcmVhdGVCbG9jayIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQlVUVE9OLAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IGV4dGVuc2lvblJlbW92YWJsZSwKICAgICAgICAgICAgdGV4dDogIk1ha2UgYSBCbG9jaysiLAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgZnVuYzogInJlbW92ZUV4dCIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQlVUVE9OLAogICAgICAgICAgICBoaWRlRnJvbVBhbGV0dGU6IGV4dGVuc2lvblJlbW92YWJsZSwKICAgICAgICAgICAgdGV4dDogIlJlbW92ZSBUaGlzIEV4dGVuc2lvbiIsCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJzZXRQYXJhbSIsCiAgICAgICAgICAgIGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuQ09NTUFORCwKICAgICAgICAgICAgdGV4dDogInNldCBbUEFSQU1dIHRvIFtWQUxVRV0iLAogICAgICAgICAgICBleHRlbnNpb25zOiBbIlNQbWJwQ1NUX2RlZmluZUNvbG9yZWQiXSwKICAgICAgICAgICAgaGlkZUZyb21QYWxldHRlOiBleHRlbnNpb25SZW1vdmFibGUsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIFBBUkFNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogInByb2NlZHVyZVBhcmFtTWVudSIgfSwKICAgICAgICAgICAgICBWQUxVRTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogInZhbHVlIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJldmFsUGFyYW0iLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJyZWV2YWx1YXRlIFtQQVJBTV0iLAogICAgICAgICAgICBleHRlbnNpb25zOiBbIlNQbWJwQ1NUX2RlZmluZUNvbG9yZWQiXSwKICAgICAgICAgICAgaGlkZUZyb21QYWxldHRlOiBleHRlbnNpb25SZW1vdmFibGUsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIFBBUkFNOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLlNUUklORywgbWVudTogInByb2NlZHVyZVBhcmFtTWVudSIgfQogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICAgIHsKICAgICAgICAgICAgb3Bjb2RlOiAiZ2V0UGFyYW0iLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlJFUE9SVEVSLAogICAgICAgICAgICB0ZXh0OiAiZ2V0IFtQQVJBTV0iLAogICAgICAgICAgICBleHRlbnNpb25zOiBbIlNQbWJwQ1NUX2RlZmluZUNvbG9yZWQiXSwKICAgICAgICAgICAgYWxsb3dEcm9wQW55d2hlcmU6IHRydWUsCiAgICAgICAgICAgIGhpZGVGcm9tUGFsZXR0ZTogZXh0ZW5zaW9uUmVtb3ZhYmxlLAogICAgICAgICAgICBhcmd1bWVudHM6IHsKICAgICAgICAgICAgICBQQVJBTTogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5TVFJJTkcsIGRlZmF1bHRWYWx1ZTogInBhcmFtZXRlciBuYW1lIiB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJydW5CcmFuY2giLAogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLkNPTU1BTkQsCiAgICAgICAgICAgIHRleHQ6ICJzdGFydCBicmFuY2ggW0lOREVYXSBbSUNPTl0iLAogICAgICAgICAgICBleHRlbnNpb25zOiBbIlNQbWJwQ1NUX2RlZmluZUNvbG9yZWQiXSwKICAgICAgICAgICAgaGlkZUZyb21QYWxldHRlOiBleHRlbnNpb25SZW1vdmFibGUsCiAgICAgICAgICAgIGFyZ3VtZW50czogewogICAgICAgICAgICAgIElOREVYOiB7IHR5cGU6IFNjcmF0Y2guQXJndW1lbnRUeXBlLk5VTUJFUiwgZGVmYXVsdFZhbHVlOiAxIH0sCiAgICAgICAgICAgICAgSUNPTjogeyB0eXBlOiBTY3JhdGNoLkFyZ3VtZW50VHlwZS5JTUFHRSwgZGF0YVVSSTogZ3VpVVJJcygiYnJhbmNoU3RhcnQiKSB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBvcGNvZGU6ICJzdG9wQ2FsbGVyU2NyaXB0IiwKICAgICAgICAgICAgYmxvY2tUeXBlOiBTY3JhdGNoLkJsb2NrVHlwZS5DT01NQU5ELAogICAgICAgICAgICB0ZXh0OiAic3RvcCBjYWxsZXIgc2NyaXB0IiwKICAgICAgICAgICAgZXh0ZW5zaW9uczogWyJTUG1icENTVF9kZWZpbmVDb2xvcmVkIl0sCiAgICAgICAgICAgIGlzVGVybWluYWw6IHRydWUsCiAgICAgICAgICAgIGhpZGVGcm9tUGFsZXR0ZTogZXh0ZW5zaW9uUmVtb3ZhYmxlCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICBibG9ja1R5cGU6IFNjcmF0Y2guQmxvY2tUeXBlLlhNTCwKICAgICAgICAgICAgaGlkZUZyb21QYWxldHRlOiBleHRlbnNpb25SZW1vdmFibGUsCiAgICAgICAgICAgIHhtbDogYDxibG9jayB0eXBlPSJwcm9jZWR1cmVzX3JldHVybiI+PHZhbHVlIG5hbWU9IiR7aXNQTSA/ICJyZXR1cm4iIDogIlZBTFVFIn0iPjxzaGFkb3cgdHlwZT0idGV4dCI+PGZpZWxkIG5hbWU9IlRFWFQiPjwvZmllbGQ+PC9zaGFkb3c+PC92YWx1ZT48L2Jsb2NrPmAsCiAgICAgICAgICB9LAogICAgICAgICAgIi0tLSIsCiAgICAgICAgICB7IGJsb2NrVHlwZTogU2NyYXRjaC5CbG9ja1R5cGUuWE1MLCB4bWw6IHByb2NlZHVyZXNYTUwsIGhpZGVGcm9tUGFsZXR0ZTogZXh0ZW5zaW9uUmVtb3ZhYmxlIH0KICAgICAgICBdLAogICAgICAgIG1lbnVzOiB7CiAgICAgICAgICBwcm9jZWR1cmVQYXJhbU1lbnU6IHsKICAgICAgICAgICAgYWNjZXB0UmVwb3J0ZXJzOiBmYWxzZSwgaXRlbXM6ICJnZXRQcm9jZWR1cmVQYXJhbU1lbnUiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgfTsKICAgIH0KCiAgICBjcmVhdGVCbG9jaygpIHsKICAgICAgY29uc3Qgd29ya3NwYWNlID0gU2NyYXRjaEJsb2Nrcy5tYWluV29ya3NwYWNlOwogICAgICBTY3JhdGNoQmxvY2tzLlByb2NlZHVyZXMuY3JlYXRlUHJvY2VkdXJlRGVmQ2FsbGJhY2tfKHdvcmtzcGFjZSk7CiAgICB9CgogICAgcmVtb3ZlRXh0KCkgewogICAgICBpZiAoY29uZmlybSgiUmVtb3ZlIHRoaXMgZXh0ZW5zaW9uPyBUaGlzIHdpbGwgcmVtb3ZlIGFsbCBuZXcgZmVhdHVyZXMgYXR0cmlidXRlZCB0byBNeSBCbG9ja3MrIikpCiAgICAgICAgcmVtb3ZlRXh0ZW5zaW9uKCk7CiAgICB9CgogICAgZ2V0UHJvY2VkdXJlUGFyYW1NZW51KCkgewogICAgICBpZiAoCiAgICAgICAgIVNjcmF0Y2hCbG9ja3MgfHwgIVNjcmF0Y2hCbG9ja3Muc2VsZWN0ZWQgfHwgU2NyYXRjaEJsb2Nrcy5zZWxlY3RlZC5pc0luRmx5b3V0IHx8CiAgICAgICAgKFNjcmF0Y2hCbG9ja3Muc2VsZWN0ZWQudHlwZSAhPT0gIlNQbWJwQ1NUX3NldFBhcmFtIiAmJiBTY3JhdGNoQmxvY2tzLnNlbGVjdGVkLnR5cGUgIT09ICJTUG1icENTVF9ldmFsUGFyYW0iKQogICAgICApIHJldHVybiBbInBhcmFtZXRlciBuYW1lIl07CiAgICAgIGxldCB0b3BCbG9jayA9IFNjcmF0Y2hCbG9ja3Muc2VsZWN0ZWQsIHBhcmVudCA9IG51bGw7CiAgICAgIHdoaWxlICgocGFyZW50ID0gdG9wQmxvY2s/LmdldFBhcmVudCgpKSkgeyB0b3BCbG9jayA9IHBhcmVudCB9CiAgICAgIGlmICghdG9wQmxvY2sgfHwgIXRvcEJsb2NrLnR5cGUuc3RhcnRzV2l0aCgicHJvY2VkdXJlc19kZWZpbml0aW9uIikpIHJldHVybiBbIihub3QgaW4gYSBkZWZpbmUgc2NyaXB0ISkiXTsKICAgICAgY29uc3QgaW5uZXJCbG9jayA9IHRvcEJsb2NrLmdldElucHV0KCJjdXN0b21fYmxvY2siKT8uY29ubmVjdGlvbj8udGFyZ2V0QmxvY2soKTsKICAgICAgaWYgKCFpbm5lckJsb2NrIHx8ICFpbm5lckJsb2NrLnR5cGUgPT0gInByb2NlZHVyZXNfcHJvdG90eXBlIikgcmV0dXJuIFsiKGludmFsaWQgZGVmaW5lIGJsb2NrISkiXTsKCiAgICAgIGlmIChpbm5lckJsb2NrLmRpc3BsYXlOYW1lc18ubGVuZ3RoKSB7CiAgICAgICAgY29uc3Qgc3RvcmUgPSBzdG9yZUdldChpbm5lckJsb2NrLnByb2NDb2RlXyk7CiAgICAgICAgaWYgKCFzdG9yZSB8fCAhc3RvcmUuaW5wdXRzKSByZXR1cm4gaW5uZXJCbG9jay5kaXNwbGF5TmFtZXNfOwogICAgICAgIGVsc2UgewogICAgICAgICAgY29uc3QgbmFtZXMgPSBzdHJ1Y3R1cmVkQ2xvbmUoaW5uZXJCbG9jay5kaXNwbGF5TmFtZXNfKTsKICAgICAgICAgIGNvbnN0IGFsbElucHV0cyA9IE9iamVjdC5lbnRyaWVzKHN0b3JlLmlucHV0cyk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsbElucHV0cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAoYWxsSW5wdXRzW2ldWzFdLnR5cGUgPT09ICJicmMiKSB7CiAgICAgICAgICAgICAgY29uc3QgaW5kZXggPSBpbm5lckJsb2NrLmFyZ3VtZW50SWRzXy5pbmRleE9mKGFsbElucHV0c1tpXVswXSk7CiAgICAgICAgICAgICAgbmFtZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5hbWVzLmxlbmd0aCA/IG5hbWVzIDogWyIiXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIFsiIl07CiAgICB9CgogICAgc2V0UGFyYW0oYXJncywgdXRpbCkgewogICAgICBjb25zdCB0aHJlYWQgPSB1dGlsLnRocmVhZDsKICAgICAgY29uc3QgcGFyYW0gPSBTY3JhdGNoLkNhc3QudG9TdHJpbmcoYXJncy5QQVJBTSk7CiAgICAgIGZvciAobGV0IGkgPSB0aHJlYWQuc3RhY2tGcmFtZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICBjb25zdCBmcmFtZSA9IHRocmVhZC5zdGFja0ZyYW1lc1tpXTsKICAgICAgICBpZiAoZnJhbWUucGFyYW1zID09PSBudWxsKSBjb250aW51ZTsKICAgICAgICBmcmFtZS5wYXJhbXNbcGFyYW1dID0gYXJncy5WQUxVRTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8gUGFyYW1ldGVycyBub3QgcHJlc2VudC4gUHJvYmFibHkgYSBsb25lIHNjcmlwdCBvciBhIHN0YWNrLWNsaWNrZWQgZGVmaW5lIGJsb2NrLgogICAgICAvLyBJbiB0aGlzIGNhc2UsIGFkZCB0aGUgcGFyYW1zIHRvIHRoZSBib3R0b20gb2YgdGhlIHN0YWNrCiAgICAgIC8vIChhbmQgcHVzaCB0aGUgY3VycmVudCBibG9jayB0byBpdCBzbyB0aGV5IGFyZW4ndCByZXNldCBmb3Igc29tZSByZWFzb24pCiAgICAgIHRocmVhZC5zdGFja0ZyYW1lc1swXS5wYXJhbXMgPSB7IFtwYXJhbV06IGFyZ3MuVkFMVUUgfTsKICAgICAgdGhyZWFkLnB1c2hTdGFjayh0aHJlYWQucGVla1N0YWNrKCkpOwogICAgICAvLyBNYWtlIHRoZSBib3R0b20gb2YgdGhlIHN0YWNrIHBvaW50IHRvIGEgbm9uZXhpc3RlbnQgYmxvY2sgc28gdGhlIHNjcmlwdCBqdXN0IGVuZHMKICAgICAgLy8gaW5zdGVhZCBvZiBydW5uaW5nIHBhcnQgb2YgaXQgYWdhaW4KICAgICAgdGhyZWFkLnN0YWNrWzBdID0gIiI7CiAgICB9CgogICAgZXZhbFBhcmFtKGFyZ3MsIHV0aWwpIHsKICAgICAgaWYgKCFUaHJlYWQgfHwgIWV4ZWN1dGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCJNeSBCbG9ja3MrIGNvdWxkIG5vdCBhY2Nlc3MgRXhwb3J0cyEiKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHRocmVhZCA9IHV0aWwudGhyZWFkOwogICAgICBpZiAoIXRocmVhZFt0YXJnZXRQcm9jRGF0YV0pIHJldHVybjsKCiAgICAgIGNvbnN0IHsgcGFyYW1zLCBibG9jaywgZnJhbWUgfSA9IHRocmVhZFt0YXJnZXRQcm9jRGF0YV07CiAgICAgIGNvbnN0IHBhcmFtID0gU2NyYXRjaC5DYXN0LnRvU3RyaW5nKGFyZ3MuUEFSQU0pOwogICAgICBjb25zdCBpbmRleCA9IHBhcmFtc1swXS5pbmRleE9mKHBhcmFtKTsKICAgICAgaWYgKGluZGV4ID09PSAtMSkgcmV0dXJuOwoKICAgICAgY29uc3QgYmxvY2tWYWx1ZSA9IGJsb2NrLmlucHV0c1twYXJhbXNbMV1baW5kZXhdXTsKICAgICAgaWYgKCFibG9ja1ZhbHVlKSByZXR1cm47CgogICAgICBjb25zdCB0ZW1wVGhyZWFkID0gbmV3IFRocmVhZDsKICAgICAgdGVtcFRocmVhZC50b3BCbG9jayA9IGJsb2NrVmFsdWUuYmxvY2s7CiAgICAgIHRlbXBUaHJlYWQucHVzaFN0YWNrKGJsb2NrVmFsdWUuYmxvY2spCiAgICAgIHRlbXBUaHJlYWQuYmxvY2tDb250YWluZXIgPSB0aHJlYWQuYmxvY2tDb250YWluZXI7CiAgICAgIHRlbXBUaHJlYWQudGFyZ2V0ID0gdGhyZWFkLnRhcmdldDsKICAgICAgdGVtcFRocmVhZC5wdXNoUmVwb3J0ZWRWYWx1ZSA9ICh2YWx1ZSkgPT4geyBmcmFtZS5wYXJhbXNbcGFyYW1dID0gdmFsdWUgfTsKICAgICAgZXhlY3V0ZShydW50aW1lLnNlcXVlbmNlciwgdGVtcFRocmVhZCk7CiAgICB9CgogICAgZ2V0UGFyYW0oYXJncywgdXRpbCkgewogICAgICBjb25zdCBwYXJhbSA9IHV0aWwudGhyZWFkLmdldFBhcmFtKFNjcmF0Y2guQ2FzdC50b1N0cmluZyhhcmdzLlBBUkFNKSk7CiAgICAgIHJldHVybiBwYXJhbSA/PyAiIjsKICAgIH0KCiAgICBzdG9wQ2FsbGVyU2NyaXB0KF8sIHV0aWwpIHsKICAgICAgLy8gc3RvcHMgdGhyZWFkcyBlbnRpcmVseSwgaW5jbHVkaW5nIGN1c3RvbSBibG9ja3MgY29udGV4dHMKICAgICAgLy8gbW9yZSBwb3dlcmZ1bCB0aGFuICd1dGlsLnN0b3BUaGlzU2NyaXB0KCknCiAgICAgIHV0aWwudGhyZWFkLnN0YXR1cyA9IDQ7CiAgICB9CgogICAgcnVuQnJhbmNoKGFyZ3MsIHV0aWwpIHsKICAgICAgY29uc3QgdGhyZWFkID0gdXRpbC50aHJlYWQ7CiAgICAgIGlmICghdXRpbC50aHJlYWRbdGFyZ2V0UHJvY0RhdGFdKSByZXR1cm47CgogICAgICBjb25zdCBwcm9jQmxvY2sgPSB1dGlsLnRocmVhZFt0YXJnZXRQcm9jRGF0YV0uYmxvY2s7CiAgICAgIGNvbnN0IHN0b3JlID0gc3RvcmVHZXQocHJvY0Jsb2NrLm11dGF0aW9uLnByb2Njb2RlLCB0aHJlYWQudGFyZ2V0KTsKICAgICAgaWYgKCFzdG9yZSB8fCAhc3RvcmUuaW5wdXRzKSByZXR1cm47CgogICAgICBjb25zdCBhbGxJbnB1dHMgPSB1dGlsLnRocmVhZFt0YXJnZXRQcm9jRGF0YV0ucGFyYW1zWzFdOwogICAgICBjb25zdCBicmFuY2hlcyA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFsbElucHV0cy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmIChzdG9yZS5pbnB1dHNbYWxsSW5wdXRzW2ldXT8udHlwZSA9PT0gImJyYyIpIGJyYW5jaGVzLnB1c2goYWxsSW5wdXRzW2ldKTsKICAgICAgfQoKICAgICAgaWYgKGJyYW5jaGVzLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCBpbmRleCA9IFNjcmF0Y2guQ2FzdC50b051bWJlcihhcmdzLklOREVYKSAtIDE7CiAgICAgICAgY29uc3QgcmVhbFByb2NCbG9jayA9IHRocmVhZC5ibG9ja0NvbnRhaW5lci5nZXRCbG9jayhwcm9jQmxvY2suaWQpOwogICAgICAgIGNvbnN0IGJyYW5jaCA9IHJlYWxQcm9jQmxvY2suaW5wdXRzW2JyYW5jaGVzW2luZGV4XV0/LmJsb2NrOwogICAgICAgIGlmIChicmFuY2gpIHV0aWwudGhyZWFkLnB1c2hTdGFjayhicmFuY2gpOwogICAgICB9CiAgICB9CgogICAgLy8gU3RvcmFnZSBzZXQvZ2V0CiAgICBzZXJpYWxpemUoKSB7CiAgICAgIGlmIChpc1BNKSB7CiAgICAgICAgc3VzcGVuZFJlbW92YWwgPSBmYWxzZTsKICAgICAgICByZW1vdmVVbnVzZWRQcm9jcygpOwogICAgICAgIHJlbW92ZVVudXNlZEltYWdlcygpOwogICAgICAgIHJldHVybiB7IFNQbWJwQ1NUOiB7IC4uLnN0b3JhZ2UsIGltZ1N0b3JhZ2UgfSB9OwogICAgICB9IGVsc2UgewogICAgICAgIC8vIHRhcmdldCBJRCdzIGNoYW5nZSB3aGVuIHNhdmluZyA6KAogICAgICAgIHJ1bnRpbWUuZXh0ZW5zaW9uU3RvcmFnZVsiU1BtYnBDU1QiXSA9IHsgbG9hZGVkOiB0cnVlLCBpbWdTdG9yYWdlIH07CiAgICAgICAgZm9yIChjb25zdCBbaWQsIHByb2NzXSBvZiBPYmplY3QuZW50cmllcyhzdG9yYWdlKSkgewogICAgICAgICAgY29uc3QgdGFyZ2V0ID0gcnVudGltZS5nZXRUYXJnZXRCeUlkKGlkKTsKICAgICAgICAgIGlmICghdGFyZ2V0KSBjb250aW51ZTsKICAgICAgICAgIHRhcmdldC5leHRlbnNpb25TdG9yYWdlWyJTUG1icENTVCJdID0geyAuLi5wcm9jcyB9OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZGVzZXJpYWxpemUoZGF0YSkgewogICAgICBkZXNlcmlhbGl6ZVN0b3JhZ2UoZGF0YSk7CiAgICB9CiAgfQoKICBleHQgPSBuZXcgU1BtYnBDU1QoKTsKICBTY3JhdGNoLmV4dGVuc2lvbnMucmVnaXN0ZXIoZXh0KTsKfSkoU2NyYXRjaCk7Cg==","localstorage":"https://extensions.turbowarp.org/local-storage.js","lmsData":"https://extensions.turbowarp.org/Lily/ListTools.js","lmscomments":"https://extensions.turbowarp.org/Lily/CommentBlocks.js","lmsSoundExpanded":"https://extensions.turbowarp.org/Lily/SoundExpanded.js","lmsclonesplus":"https://extensions.turbowarp.org/Lily/ClonesPlus.js","text":"https://extensions.turbowarp.org/lab/text.js","jeremygamerTweening":"https://extensions.turbowarp.org/JeremyGamer13/tween.js"},"meta":{"semver":"3.0.0","platform":{"name":"TurboWarp","url":"https://turbowarp.org/"}}}